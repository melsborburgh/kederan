<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        <meta name="author" content="APEX R&D">
        
        <link rel="shortcut icon" href="./img/favicon.ico">
        <title>APEX Office Print</title>
        <link href="./css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="./css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="./css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
	
	<script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.0.3.min.js"></script>
        <script src="./js/highlight.pack.js"></script> 
    </head>

    <body class="homepage">

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <a class="navbar-brand" href=".">APEX Office Print</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#apex-office-print-aop-user-manual">APEX Office Print (AOP) - User Manual</a></li>
        <li class="main "><a href="#1-about-aop">1 About AOP</a></li>
            <li><a href="#11-goal">1.1 Goal</a></li>
            <li><a href="#12-aop-main-features">1.2 AOP Main Features</a></li>
            <li><a href="#13-aop-architecture">1.3 AOP Architecture</a></li>
            <li><a href="#14-how-it-works-overview">1.4 How it works (overview)</a></li>
            <li><a href="#15-how-it-works-technical">1.5 How it works (technical)</a></li>
            <li><a href="#16-cloud-vs-on-premise">1.6  Cloud vs On-Premise</a></li>
            <li><a href="#17-license">1.7 License</a></li>
            <li><a href="#18-signup-and-download">1.8 Signup and Download</a></li>
            <li><a href="#19-quick-install-guide">1.9 Quick Install Guide</a></li>
            <li><a href="#110-quick-upgrade-guide">1.10 Quick Upgrade Guide</a></li>
        <li class="main "><a href="#2-aop-apex-sample-application">2 AOP APEX Sample Application</a></li>
            <li><a href="#21-prerequisites">2.1 Prerequisites</a></li>
            <li><a href="#22-import-the-aop-sample-application">2.2 Import the AOP Sample Application</a></li>
            <li><a href="#23-trying-the-aop-sample-application">2.3 Trying the AOP Sample Application</a></li>
            <li><a href="#231-aop-sample-application-for-apex-50">2.3.1 AOP Sample Application for APEX 5.0</a></li>
            <li><a href="#232-aop-sample-application-for-apex-51">2.3.2 AOP Sample Application for APEX 5.1</a></li>
            <li><a href="#233-aop-sample-application-for-apex-18x">2.3.3 AOP Sample Application for APEX 18.x</a></li>
        <li class="main "><a href="#3-apex-plug-in">3 APEX Plug-in</a></li>
            <li><a href="#31-pre-requisites">3.1 Pre-requisites</a></li>
            <li><a href="#32-import-and-plug-in-attributes">3.2 Import and plug-in Attributes</a></li>
            <li><a href="#33-how-to-use-the-aop-plug-in">3.3 How to use the AOP Plug-in</a></li>
            <li><a href="#34-quick-start-demo">3.4 Quick Start Demo</a></li>
            <li><a href="#35-plug-in-options">3.5 Plug-in options</a></li>
        <li class="main "><a href="#4-plsql-api">4 PL/SQL API</a></li>
            <li><a href="#41-pre-requisites">4.1 Pre-requisites</a></li>
            <li><a href="#42-install-in-the-database">4.2 Install in the Database</a></li>
            <li><a href="#43-how-to-use">4.3 How to use</a></li>
            <li><a href="#44-parameters">4.4 Parameters</a></li>
            <li><a href="#45-example">4.5 Example</a></li>
            <li><a href="#46-plsql-api-documentation">4.6 PL/SQL API Documentation</a></li>
        <li class="main "><a href="#5-manual-rest-call">5 Manual (REST) call</a></li>
            <li><a href="#51-overview">5.1 Overview</a></li>
            <li><a href="#52-json-file">5.2 JSON File</a></li>
        <li class="main "><a href="#6-templates">6 Templates</a></li>
            <li><a href="#60-tag-overview">6.0 Tag Overview</a></li>
            <li><a href="#61-word-docx-template">6.1 Word (docx) template</a></li>
            <li><a href="#62-powerpoint-pptx-template">6.2 Powerpoint (pptx) template</a></li>
            <li><a href="#63-excel-xlsx-template">6.3 Excel (xlsx) template</a></li>
            <li><a href="#64-qrcode-image-replacing">6.4 QRCode Image Replacing</a></li>
            <li><a href="#65-converter">6.5 Converter</a></li>
        <li class="main "><a href="#7-sql-structure">7 SQL Structure</a></li>
            <li><a href="#71-how-to-write-sql-queries-and-map-them-to-template-documents">7.1 How to write SQL queries and map them to template documents</a></li>
        <li class="main "><a href="#8-server-only-on-premise">8 Server (only On-Premise)</a></li>
            <li><a href="#81-installation">8.1 Installation</a></li>
            <li><a href="#82-configuration">8.2 Configuration</a></li>
            <li><a href="#83-unlock-trial-version">8.3 Unlock Trial version</a></li>
            <li><a href="#84-server-options">8.4 Server Options</a></li>
            <li><a href="#85-running-as-service-in-windows">8.5 Running as Service in Windows</a></li>
            <li><a href="#86-run-apex-office-print-at-startup-or-as-service-in-linux">8.6 Run APEX Office Print at startup or as service in Linux</a></li>
            <li><a href="#87-startstop-apex-office-print-on-linux-7-with-systemctl">8.7 Start/Stop APEX Office Print on Linux 7 with systemctl</a></li>
            <li><a href="#88-step-by-step-how-to-install-libreoffice-on-linux">8.8 Step-by-step how to install LibreOffice on Linux</a></li>
            <li><a href="#89-https-configuration">8.9 HTTPS Configuration</a></li>
            <li><a href="#810-installation-errors">8.10 Installation errors</a></li>
            <li><a href="#811-docker-image">8.11 Docker image</a></li>
        <li class="main "><a href="#9-tutorials">9 Tutorials</a></li>
        <li class="main "><a href="#10-troubleshooting">10 Troubleshooting</a></li>
            <li><a href="#101-output-generates-invalid-office-documents">10.1 Output generates invalid Office documents</a></li>
            <li><a href="#102-invalid-json-generated-by-apex95web95servicemake95rest95request">10.2 Invalid JSON generated by apex_web_service.make_rest_request</a></li>
            <li><a href="#103-invalid-json-generated-by-apex_json">10.3 Invalid JSON generated by apex_json</a></li>
            <li><a href="#104-running-on-oracle-cloud">10.4 Running on Oracle Cloud</a></li>
            <li><a href="#105-invalid-pdf-file">10.5 Invalid PDF file</a></li>
            <li><a href="#106-ora-29273-http-request-failed">10.6 ORA-29273: HTTP request failed</a></li>
            <li><a href="#107-ora-29024-certificate-validation-failure">10.7 ORA-29024: Certificate validation failure</a></li>
            <li><a href="#108-error-generating-excel-and-powerpoint-with-aop-trial">10.8 Error generating Excel and Powerpoint with AOP Trial</a></li>
            <li><a href="#109-how-to-read-and-convert-documents-docx-xlsx-pptx-pdf-on-linux">10.9 How to read and convert documents (docx, xlsx, pptx, pdf) on Linux</a></li>
            <li><a href="#1010-ora-31011-xml-parsing-failed-ora-19202-error-occurred-in-xml-processing-lpx-00651-vm-stack-overflow">10.10 ORA-31011: XML parsing failed, ORA-19202: Error occurred in XML processing, LPX-00651: VM Stack overflow</a></li>
            <li><a href="#1011-error-occured-while-aquiring-license">10.11 Error occured while aquiring license</a></li>
            <li><a href="#1012-syntaxerror-unexpected-token-p-in-json-at-position-0">10.12 SyntaxError: unexpected token P in JSON at position 0</a></li>
            <li><a href="#1013-issues-with-oracle-xe">10.13 Issues with Oracle XE</a></li>
            <li><a href="#1014-chinese-and-other-language-and-font-support">10.14 Chinese and other language and font support</a></li>
            <li><a href="#1015-running-aop-installed-in-a-single-schema-but-shared-across-multiple-schemas">10.15 Running AOP installed in a single schema but shared across multiple schemas</a></li>
            <li><a href="#1016-running-on-premise-aop-under-https">10.16 Running on-premise AOP under HTTPS</a></li>
            <li><a href="#1017-the-requested-url-has-been-prohibited">10.17 The requested URL has been prohibited</a></li>
            <li><a href="#1018-pdf-output-suddenly-stopped-working">10.18 PDF output suddenly stopped working</a></li>
            <li><a href="#1019-map-or-gantt-or-other-div-not-in-output">10.19 Map or Gantt or Other div not in output</a></li>
            <li><a href="#1020-ora-29273-http-request-failed-ora-12535-tnsoperation-timed-out">10.20 ORA-29273: HTTP request failed ORA-12535: TNS:operation timed out</a></li>
            <li><a href="#1021-font-in-pdf-is-different-from-the-font-in-my-word-template">10.21 Font in PDF is different from the font in my Word template</a></li>
            <li><a href="#1022-the-generation-of-my-document-is-slow">10.22 The generation of my document is slow</a></li>
            <li><a href="#1023-invalid-multi-column-chart-or-unexpected-error">10.23 Invalid multi-column chart or Unexpected Error</a></li>
            <li><a href="#1023-safe-button-in-components-settings-not-available">10.23 Safe button in Components Settings not available</a></li>
            <li><a href="#1024-sqlerrm-ora-31011-xml-parsing-failed-ora-19202-error-occurred-in-xml-processing-lpx-00664-vm-node-stack-overflow">10.24 sqlerrm: ORA-31011: XML parsing failed ORA-19202: Error occurred in XML processing LPX-00664: VM Node-Stack overflow</a></li>
            <li><a href="#1025-how-to-get-a-download-to-excel-button-in-the-actions-menu-of-an-interactive-report">10.25 How to get a download to Excel button in the Actions menu of an Interactive Report?</a></li>
            <li><a href="#1026-ora-06550-pls-00201-identifier-aop_api_pkgxxx-must-be-declared">10.26 ORA-06550: PLS-00201: identifier 'AOP_API_PKG.xxx' must be declared</a></li>
        <li class="main "><a href="#11-debugging-in-apex">11 Debugging in APEX</a></li>
        <li class="main "><a href="#12-debugging-in-plsql">12 Debugging in PL/SQL</a></li>
        <li class="main "><a href="#13-remote-debugging">13 Remote Debugging</a></li>
        <li class="main "><a href="#14-local-debugging">14 Local Debugging</a></li>
        <li class="main "><a href="#15-debugging-connections-to-aop-server">15 Debugging connections to AOP Server</a></li>
        <li class="main "><a href="#16-faq">16 FAQ</a></li>
        <li class="main "><a href="#17-example-templates">17 Example Templates</a></li>
            <li><a href="#example-1">Example 1</a></li>
            <li><a href="#example-2">Example 2</a></li>
            <li><a href="#example-3">Example 3</a></li>
            <li><a href="#example-4">Example 4</a></li>
        <li class="main "><a href="#copyright">Copyright</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="apex-office-print-aop-user-manual">APEX Office Print (AOP) - User Manual</h1>
<p>Release 18.2 October 2018</p>
<p>Provided by:</p>
<p><a href="https://www.apexrnd.be"><img alt="APEX R&amp;D Logo" src="./media/image1.png" /></a></p>
<h1 id="1-about-aop">1 About AOP</h1>
<h2 id="11-goal">1.1 Goal</h2>
<p>APEX Office Print makes printing and exporting (docx, xlsx, pptx, pdf, html, md) in Oracle Application Express (APEX) or just in PL/SQL a lot easier.</p>
<p>Make a template in Office, HTML or Markdown, choose data from your database and merge them into one. You can easily print PDFs, Office documents, HTML or Markdown in no time. It saves you time and effort by creating templates in which you can easily integrate your data.</p>
<p>APEX Office Print (AOP) is a product of APEX R&amp;D, located in Leuven, Belgium.</p>
<p>We are an experienced partner that helps you facilitate, improve and accelerate your business through new and innovative solutions. Built on in-depth technical expertise, our company provides custom-made IT services for managing business data and processes.</p>
<h2 id="12-aop-main-features">1.2 AOP Main Features</h2>
<p>APEX Office Print focusses on following:</p>
<ol>
<li>
<p><strong>Simple Printing</strong>
    It is fast, easy and saves you money. It's the only solution on the market that is fully integrated with APEX. For example you can print or export your Interactive Reports and Grids data in a second.</p>
</li>
<li>
<p><strong>Quick and Easy Setup</strong>
    Simply Import the APEX Plug-in in your application</p>
</li>
<li>
<p><strong>Any Data Type Support</strong>
    Text, images, barcodes, formulas…. it is easy to merge your data with any template you create</p>
</li>
<li>
<p><strong>Scalable and Secure</strong>
    APEX Office Print is a scalable and secure product that fits your every printing requirement.</p>
</li>
<li>
<p><strong>PL/SQL API support</strong>
    It gives you ability to run and retrieve reports from AOP server directly from your PL/SQL code.</p>
</li>
<li>
<p><strong>Optimized for Performance</strong>
    Great design with finest details to enhance your business productivity.</p>
</li>
<li>
<p><strong>Flexible</strong>
    APEX Office Print is a print server allowing you to create templates in Word, Excel, and PowerPoint for any type of data.</p>
</li>
</ol>
<h2 id="13-aop-architecture">1.3 AOP Architecture</h2>
<p><img alt="AOP Architecture" src="./media/aop_architecture.png" /></p>
<p>It's the database (APEX Plug-in, PL/SQL API, REST WebService) that is doing a request to the AOP Server (either on-premise or our cloud). The template together with the data is send in JSON format to the AOP Server.
The browser doesn't need to have access to the AOP server.</p>
<h2 id="14-how-it-works-overview">1.4 How it works (overview)</h2>
<p><img alt="How it works" src="./media/image2.png" />
<img alt="How it works" src="./media/image3.png" /></p>
<h2 id="15-how-it-works-technical">1.5 How it works (technical)</h2>
<p>The APEX Office Print package consists of a server component, an Oracle APEX plug-in and PL/SQL API.</p>
<p>The server part returns generated documents upon receiving HTTP POST requests. These requests require a structured JSON file that for example can be inferred from a SQL database. The data from the database in combination with a template will generate relevant output files.</p>
<p>The Oracle Application Express (APEX) plug-in will generate the HTTP POST requests that the server part understands. The plug-in makes it easy to select a template, your data source and the output format straight from within your APEX application.</p>
<p>The PL/SQL API allows to print directly from the Oracle database. The PL/SQL API fits perfectly if you need to setup automatic printing through a job or do a mail merge.</p>
<p>A sample application comes with the download, so you see plenty of use cases in action.</p>
<h2 id="16-cloud-vs-on-premise">1.6  Cloud vs On-Premise</h2>
<p>There are two type of versions to buy:</p>
<ul>
<li>a cloud version, which will send the requests to APEX Office Print in the cloud</li>
<li>an on-premise version, which includes the server component of APEX Office Print. It's an executable you run on your own server and in the APEX Plug-in you reference your own local version of APEX Office Print. In this case nothing is sent to the AOP cloud.</li>
</ul>
<h2 id="17-license">1.7 License</h2>
<p>This is commercial software; you need to obtain a valid license in order to use this software and plug-in in your application. For the on-premise version a license is required per server (MAC address) you are running APEX Office Print of or you can go for an Enterprise License which is not tight to the MAC address.</p>
<p>Please visit our website <a href="https://www.apexofficeprint.com/">https://www.apexofficeprint.com/</a> for the different packages.</p>
<p>You can even sign up for a FREE Cloud account.</p>
<h2 id="18-signup-and-download">1.8 Signup and Download</h2>
<ol>
<li>
<p>Open <a href="https://www.apexofficeprint.com/">https://www.apexofficeprint.com/</a></p>
</li>
<li>
<p>Click on the "Sign Up" button</p>
<p><img alt=" " src="./media/image5.png" /></p>
</li>
<li>
<p>Enter your details</p>
<p><img alt=" " src="./media/image6.png" /></p>
</li>
<li>
<p>You'll receive an email with a confirmation link, please click that</p>
</li>
<li>
<p>At the same time you're logged into your AOP Dashboard. Select <strong>Downloads</strong></p>
<p><img alt=" " src="./media/image7.png" /></p>
</li>
<li>
<p>Choose the package you want and click to download it</p>
</li>
</ol>
<p><strong>Important – API key number activation</strong></p>
<p>In your AOP dashboard your unique <strong>API key number</strong> can be found under the Account Info region on the home page. This number will need to be added to your Plug-in settings in order for it to work. For more information on how to do this check the <a href="#apex-plugin-attributes">APEX Plugin Section</a>.</p>
<h2 id="19-quick-install-guide">1.9 Quick Install Guide</h2>
<ol>
<li>
<p>Unzip the file you downloaded from <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a></p>
</li>
<li>
<p>Run aop_db_pkg.sql (in the "db"-directory) in your Oracle Schema (SQL Workshop -&gt; SQL Scripts -&gt; Upload -&gt; Select file and hit Upload)</p>
</li>
<li>
<p>Import dynamic_action_plugin_be_apexrnd_aop_da.sql and process_type_plugin_be_apexrnd_aop.sql (in the "plugin"-directory) in Shared Components &gt; Plug-ins</p>
</li>
<li>
<p>On the page you want to use AOP, add the "APEX Office Print" Dynamic Action or Process</p>
</li>
</ol>
<h2 id="110-quick-upgrade-guide">1.10 Quick Upgrade Guide</h2>
<p>When you already have an older version of AOP installed.</p>
<ol>
<li>
<p>Unzip the file you downloaded from <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a></p>
</li>
<li>
<p>Run aop_db_pkg.sql (in the "db"-directory) in your Oracle Schema (SQL Workshop -&gt; SQL Scripts -&gt; Upload -&gt; Select file and hit Upload)</p>
</li>
<li>
<p>Import dynamic_action_plugin_be_apexrnd_aop_da.sql and process_type_plugin_be_apexrnd_aop.sql (in the "plugin"-directory) in Shared Components &gt; Plug-ins</p>
</li>
<li>
<p>Optional: run aop_db_sample_pkg.sql (in the "db"-directory) in your Oracle Schema (SQL Workshop -&gt; SQL Scripts -&gt; Upload -&gt; Select file and hit Upload), which will create some sample PL/SQL Scripts. We also recommend to install the latest AOP Sample App.</p>
</li>
<li>
<p>For on-premises versions of AOP, on the server stop AOP, copy the server directory and restart AOP with the new executable.</p>
</li>
</ol>
<h1 id="2-aop-apex-sample-application">2 AOP APEX Sample Application</h1>
<h2 id="21-prerequisites">2.1 Prerequisites</h2>
<p>APEX Office Print requires Oracle APEX 5.0.4 or higher.
Interactive Grid support is included in Oracle APEX 5.1 and above.
Remote Databases and Web Sources are support in Oracle APEX 18.1 and above.</p>
<p>Note that the higher the APEX version, the more samples the AOP Sample App will include. We recommend looking at the latest version of the AOP Sample App, even if you are not yet on the latest version of APEX. Many examples will work in previous versions of APEX too, but they don't necessarily exist in that version of the AOP Sample App.</p>
<p>In order to run the AOP Sample Application an Oracle APEX Packaged application called Sample Database Application has to be installed first. The reason is that the source and templates are using data from the tables (demo_orders, demo_order_items, demo_product_info, ….) which are installed by the packaged application.</p>
<p><img alt=" " src="./media/image4.png" /></p>
<p>Follow these steps to install the packaged application in your workspace:</p>
<ol>
<li>Access your target Workspace</li>
<li>Select the Application Builder</li>
<li>
<p>Select Create</p>
<p><img alt=" " src="./media/image59.png" /></p>
</li>
<li>
<p>Select Packaged Application</p>
<p><img alt=" " src="./media/image60.png" /></p>
</li>
<li>
<p>Select Sample Database Application and click Install Application button</p>
<p><img alt=" " src="./media/image61.png" /></p>
</li>
<li>
<p>Select to use existing Application ID
    <em>Note: When you selected Auto Reassign Application ID you need to make sure that you change the values of aop_api_pkg that uses APP_ID and AOP_URL as global variables.</em></p>
</li>
<li>Select to install Supporting Objects</li>
<li>Follow the wizard to complete the installation.</li>
</ol>
<h2 id="22-import-the-aop-sample-application">2.2 Import the AOP Sample Application</h2>
<ol>
<li>Access your target Workspace</li>
<li>Select the Application Builder</li>
<li>Select Import and select the file in apex/version/aop_sample_apex_app.sql</li>
<li>Follow the wizard to finish the import</li>
<li>The AOP Sample Application will also install all supporting objects, so after the import you can simply start using the application.</li>
</ol>
<h2 id="23-trying-the-aop-sample-application">2.3 Trying the AOP Sample Application</h2>
<p>The APEX application that comes with AOP shows different examples of how APEX Office Print can be used inside an application.</p>
<p><img alt=" " src="./media/image16.png" /></p>
<p>By inspecting elements of these pages you can quickly learn how to use AOP Plug-in.</p>
<p><strong>Note that the AOP Sample Application for APEX 5.0, 5.1 and 18.1 are different. The higher the APEX version, the more features you will find in the AOP Sample App.</strong></p>
<h2 id="231-aop-sample-application-for-apex-50">2.3.1 AOP Sample Application for APEX 5.0</h2>
<p><img alt=" " src="./media/aop_sample_app50_release.png" /></p>
<p>AOP Sample application consist out of 19 parts:</p>
<!-- Make sure TO UPDATE with every new release -->

<ol>
<li>
<p><strong>Sample Print</strong></p>
<p>This page contains different buttons all linked to different AOP processes and dynamic actions that show different use cases of the AOP plug-in.</p>
<p><img alt=" " src="./media/image18.png" /></p>
</li>
<li>
<p><strong>Top Features</strong></p>
<p>This section highlights some of the key differentiators of APEX Office Print compared to other print solutions.</p>
<p><img alt=" " src="./media/top_features.png" /></p>
</li>
<li>
<p><strong>Dynamic Print</strong></p>
<p>Dynamically you can select your template in Word, Excel or PowerPoint and output depending on the customer you selected.</p>
<p><img alt=" " src="./media/image19.png" /></p>
</li>
<li>
<p><strong>Reports Print</strong></p>
<p>This section shows examples where a classic and interactive report and grid is used as the source of the data. There is also an example to print labels.
You can even use a combination of multiple classic and interactive reports as your data source. This feature is one of the most impressive of AOP and not found in any other tool.</p>
<p><img alt=" " src="./media/image20.png" /></p>
</li>
<li>
<p><strong>Chart Print</strong></p>
<p>This section shows examples how to print charts: Line, Bar, Column, Pie, Radar, Area, ... The charts are native Office charts, so they can even be adapted after creation in Word, Excel and Powerpoint.</p>
<p><img alt=" " src="./media/image21.png" /></p>
</li>
<li>
<p><strong>Rich Text Editor</strong></p>
<p>You can also write your markup in a Rich Text Editor and AOP will understand and translate the markup (bold, color, etc.) into native Word markup. In your template you need to put an underscore in front of the tag name e.g. {_htmlcontent}</p>
<p><img alt=" " src="./media/aop_rich_text_editor.png" /></p>
</li>
<li>
<p><strong>Images</strong></p>
<p>APEX Office Print is able to print images in different formats. This screen shows an example how to configure it. In order to show images, you base64 encode those and put a % in your tag e.g. {%image}</p>
<p><img alt=" " src="./media/aop_images.png" /></p>
</li>
<li>
<p><strong>QR and Barcodes</strong></p>
<p>APEX Office Print is able to print different Bar- and QR codes. This screen shows an example how to configure it.</p>
<p><img alt=" " src="./media/aop_qr_code.png" /></p>
</li>
<li>
<p><strong>Inline PDF</strong></p>
<p>If you want to show the PDF inline in a modal dialog or in a certain div (region), this page shows exactly how to do that. The value of the tag data-aop-inline-pdf should be the name of dynamic action that calls AOP.</p>
<p><img alt=" " src="./media/aop_inline_pdf.png" /></p>
</li>
<li>
<p><strong>Complex Print</strong></p>
<p>The Complex Print section shows different use cases for Word, Excel and Powerpoint. There are different templates that show how to create more complex layouts. There are also some examples that show some specific features like how to use line breaks in your data or how to download two documents at the same time.</p>
<p><img alt=" " src="./media/aop_complex.png" /></p>
</li>
<li>
<p><strong>Mailings Print</strong></p>
<p>Word has a feature to create labels via the mailings option. This screen shows an example with some specific Avery size labels.</p>
<p><img alt=" " src="./media/print_mailings.png" /></p>
</li>
<li>
<p><strong>Email Print</strong></p>
<p>This examples shows how you can call a procedure and send an email as attachment. There is also an option to send the email but also downloading the file.</p>
<p><img alt=" " src="./media/image22.png" /></p>
</li>
<li>
<p><strong>PL/SQL API Sample</strong></p>
<p>Here you can see AOP PL/SQL API in action. It shows how to retrieve a document from AOP server and store it in custom table. This is extremely useful when you want to schedule your print jobs and send automated emails.</p>
<p><img alt=" " src="./media/image23.png" /></p>
</li>
<li>
<p><strong>Scheduled Print</strong></p>
<p>You can schedule a job to print every day, week, month etc. a specific report by using dbms_scheduler and the AOP PL/SQL API.</p>
<p><img alt=" " src="./media/image24.png" /></p>
</li>
<li>
<p><strong>Batch Print</strong></p>
<p>If you want to print documents in batch, this page shows you three ways of doing it.</p>
<p>First one will generate one document with the pages in here.
Second will generate multiple documents.
And last option will generate multiple documents but present it back as a zip file.</p>
<p><img alt=" " src="./media/image25.png" /></p>
</li>
<li>
<p><strong>Template and Data Types</strong></p>
<p>This page gives an overview and example of the different template and data types that are possible in the APEX Office Print (AOP) Plug-in and API.
The template type defines where your template in docx, xlsx or pptx is defined (table, filesystem, url, APEX, ...). The data type defines where the data can be found to be merged with the template (SQL, PL/SQL, JSON, REST, ...).</p>
<p><img alt=" " src="./media/different_template_data_types.png" /></p>
</li>
<li>
<p><strong>AOP Usage</strong></p>
<p>This page gives an overview of the pages where and how the APEX Office Print (AOP) Plug-in is used.</p>
<p><img alt=" " src="./media/aop_usage.png" /></p>
</li>
<li>
<p><strong>Automated Test</strong></p>
<p>You can automatically test all your documents in this screen and see if all of your defined templates and data sources merged correctly. This option is especially useful after an upgrade of AOP or Office.</p>
<p><img alt=" " src="./media/image26.png" /></p>
</li>
<li>
<p><strong>Templates</strong></p>
<p>Here you can upload your templates into a custom table.</p>
<p>The idea here is that in your own application, you allow people to create or update their own templates and upload them to the application without the need for developer to code other documents.</p>
<p><img alt=" " src="./media/image27.png" /></p>
</li>
</ol>
<h2 id="232-aop-sample-application-for-apex-51">2.3.2 AOP Sample Application for APEX 5.1</h2>
<p>For Oracle Application Express (APEX) 5.1 we wanted to take the AOP Sample App to another level and include more insight how AOP is working. We know reading documentation isn't the most fun, so we put a lot of information into the sample app, so by navigating through it you learn about AOP.</p>
<p><img alt=" " src="./media/aop_sample_app51_release.png" /></p>
<p>The different parts of the sample app:</p>
<ol>
<li>
<p><strong>Start</strong> walks you step-by-step how you can get AOP working in your own application.</p>
<p><img alt=" " src="./media/aop_51_start.png" /></p>
</li>
<li>
<p><strong>Tour</strong> shows the different techniques you can use and goes in more detail when to use which plug-in, the PL/SQL API or do a manual REST request.</p>
<p><img alt=" " src="./media/aop_51_tour.png" /></p>
</li>
<li>
<p><strong>Examples</strong> shows different use cases of AOP, so you can see exactly behind the scenes how AOP is used.</p>
<p><img alt=" " src="./media/aop_51_examples.png" /></p>
</li>
<li>
<p><strong>Doc</strong> is a link to the latest version of our online documentation.</p>
</li>
<li>
<p><strong>More</strong> is a link to our website where you find the release history, FAQ, Tutorials etc.</p>
</li>
<li>
<p><strong>Support</strong> will open your default email client so you can write us.</p>
</li>
</ol>
<h2 id="233-aop-sample-application-for-apex-18x">2.3.3 AOP Sample Application for APEX 18.x</h2>
<p>For Oracle Application Express (APEX) 18.1 and above we recreated the AOP Sample App from scratch. We really recommend going through this sample application. This app showcases the different features AOP has, both specific for APEX as what many people are looking for in a reporting solution. Where possible we added extra information so you have a thorough understanding how AOP works and how to create what you dream of.</p>
<p><img alt=" " src="./media/aop_181_sample_app.png" /></p>
<p>The different parts of the sample app:</p>
<ol>
<li>
<p><strong>Installation</strong> walks you step-by-step how you can get AOP working in your own application.</p>
<p><img alt=" " src="./media/aop_181_start.png" /></p>
</li>
<li>
<p><strong>Architecture</strong> shows the flow of the different components and techniques you can use and goes in more detail when to use which plug-in, the PL/SQL API or do a manual REST request.</p>
<p><img alt=" " src="./media/aop_181_tour.png" /></p>
</li>
<li>
<p><strong>APEX Features</strong> shows the integration of AOP with specific APEX features like Interactive Reports, Interactive Grid and Calendar.</p>
<p><img alt=" " src="./media/aop_181_apex_features.png" /></p>
</li>
<li>
<p><strong>Examples</strong> shows different possibilities of AOP, so you can see exactly behind the scenes how AOP is used.</p>
<p><img alt=" " src="./media/aop_181_aop_features.png" /></p>
</li>
<li>
<p><strong>Use Cases</strong> show different use cases people requested or had issues with (coming soon).</p>
</li>
<li>
<p><strong>Debugging</strong> includes how to debug and test AOP.</p>
<p><img alt=" " src="./media/aop_181_aop_server.png" /></p>
</li>
<li>
<p><strong>User Manual</strong> is a link to the latest version of our online documentation.</p>
</li>
<li>
<p><strong>Support</strong> will open your default email client so you can write us.</p>
</li>
<li>
<p><strong>Administration</strong> of the application as generated by APEX.</p>
</li>
</ol>
<h1 id="3-apex-plug-in">3 APEX Plug-in</h1>
<h2 id="31-pre-requisites">3.1 Pre-requisites</h2>
<p>The APEX Office Print APEX plug-in requires Oracle APEX 5.0.4 or higher.</p>
<p><strong>The AOP plug-ins are relying on a PL/SQL package (aop_api_pkg which is a synonym for aop_api18_pkg) that needs to be compiled first.</strong> </p>
<p>To make the package available, go into SQL Plus, SQLcl, SQL Developer or SQL Workshop and run the SQL Script aop_db_pkg.sql which you find in the db directory of the zip you downloaded.</p>
<p>Alternatively you can run the install.sql file which will install some additional packages which show case how to use AOP from PL/SQL.</p>
<p>If you imported the AOP Sample App and ran the the Supporting Objects, the packages are automatically installed.</p>
<h2 id="32-import-and-plug-in-attributes">3.2 Import and plug-in Attributes</h2>
<p><a name="apex-plugin-attributes"></a>
Follow these steps to import the plug-in in your application:</p>
<ol>
<li>Access your target Workspace</li>
<li>Select the Application Builder</li>
<li>Select the Application where you wish to import the plug-in &gt; (plug-ins belong to an application, not a workspace)</li>
<li>Access <strong>Shared Components &gt; Plug-Ins</strong></li>
<li>Click <strong>Import &gt;</strong></li>
<li>Browse and locate the installer files in apex/version/process_type_plugin_be_apexrnd_aop.sql)</li>
<li>Complete the wizard.</li>
<li>Do the same for the dynamic action plug-in in apex/version/dynamic_action_plugin_be_apexrnd_aop.sql)</li>
</ol>
<p>Follow these steps to finish your Plug-in installation by <strong>adding your Plug-in API key</strong>:</p>
<ol>
<li>Login into <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a></li>
<li>Copy your API key from the Dashboard</li>
<li>Access your target APEX Workspace</li>
<li>Select the Application Builder</li>
<li>Select the Application where you wish to import the plug-in (plug-ins belong to an application, not a workspace)</li>
<li>Access <strong>Shared Components &gt; Component Settings</strong></li>
<li>Here select APEX Office Print (AOP) [Plug-in]</li>
<li>
<p>Add you API key that you copied in step 2</p>
<p><img alt=" " src="./media/image9.png" /></p>
</li>
<li>
<p>Click Apply</p>
</li>
<li><strong>Installation is now completed</strong></li>
</ol>
<p><em>Installation note:
To use AOP PL/SQL API you may need to configure your ACL (Access Control List) settings to allow access to:</em>
<em>http(s)://api.apexofficeprint.com</em></p>
<p><em>For more details please refer to Oracle APEX installation guide:</em>
for <a href="https://docs.oracle.com/cd/E59726_01/install.50/e39144/listener.htm#HTMIG29160">APEX 5.0</a> or for <a href="http://docs.oracle.com/database/apex-5.1/HTMIG/enabling-network-services-in-Oracledb-11g-or-later.htm#HTMIG29160">APEX 5.1</a>
or for <a href="https://docs.oracle.com/database/apex-18.1/HTMIG/enabling-network-services-in-Oracle-db11g-or-later.htm#HTMIG29161">APEX 18.1</a></p>
<p>In case you want to update some plug-in settings, you find the plug-in settings in Shared Components &gt; Component Settings &gt; APEX Office Print (AOP) [Plug-in]</p>
<p><img alt=" " src="./media/apex_component_settings.png" /></p>
<p>You can change the AOP URL, AOP Failover URL (and Procedure which is being called on failover), API Key, Debug and specify a package where those settings are specified.
Since AOP 3.5 you can also specify a Log package which will be called on every request, so you can monitor directly from your Oracle database if prints are successful.
If you use the on-premise version of AOP you can also change the Converter.</p>
<p>To generate a PDF, APEX Office Print is using an external converter. By default LibreOffice is used (available on all platforms), but this can be changed to MS Office (Windows only).</p>
<h2 id="33-how-to-use-the-aop-plug-in">3.3 How to use the AOP Plug-in</h2>
<p>Simply add a new process called AOP (plug-in) on your APEX page once you completed steps in 3.2.</p>
<p><img alt=" " src="./media/image10.png" /></p>
<h2 id="34-quick-start-demo">3.4 Quick Start Demo</h2>
<p>Once the plug-in has been imported into your APEX 5 application navigate to the Sample Database Application – Page 4.</p>
<p>1) Create a new button called PRINT and place it right of the RESET button.</p>
<p>2) Create a new process (APEX 5.0) or dynamic action (APEX 5.1) called AOP and select as type AOP [Plug-in]</p>
<p>3) Set the Data Type option of the plug-in to SQL and paste following select in the Data Source. Please note the use of cursor <strong>data</strong>. The tags that you use in the template should be inside this <strong>data</strong> cursor.</p>
<pre><code>```sql
select
'file1' as "filename",
cursor(
    select
    c.cust_first_name as "cust_first_name",
    c.cust_last_name as "cust_last_name",
    c.cust_city as "cust_city",
    cursor(
        select
        o.order_total as "order_total",
        'Order ' || rownum as "order_name",
        cursor(
            select
            p.product_name as "product_name",
            i.quantity as "quantity",
            i.unit_price as "unit_price",
            APEX_WEB_SERVICE.BLOB2CLOBBASE64(p.product_image) as "image"
            from
            demo_order_items i, demo_product_info p
            where
            o.order_id = i.order_id
            and i.product_id = p.product_id
                ) "product"
        from
        demo_orders o
        where
        c.customer_id = o.customer_id
            ) "orders"
    from
    demo_customers c
    where
    customer_id = 1
        ) as "data"
from dual
```
</code></pre>
<p>4) As Output Type select docx.</p>
<p>5) Add as Condition for the process set only to run when button clicked PRINT.</p>
<p>6) Hit Save and Run the page.</p>
<p>When clicking on the Print button you should now get your first Word document.
   This document represents a starting template based on your data. You'll see all tags that you can use and some more explanations how to use expressions and certain features of AOP.
   You can now create your template in MS Word (or Excel or Powerpoint) and use the tags in your template. Follow the next steps to do this.</p>
<p>7) Create your template in Word and use the tags that came in the first document you got.</p>
<p>8) Go to Shared Components &gt; Static Application Files and upload your template</p>
<p>9) Go back to your page and select the AOP process</p>
<p>10) Change the Template Type to "Static Application Files"</p>
<p>11) In Template Source enter your document you uploaded in step 8 e.g. my_template.docx</p>
<p>12) Run your page again</p>
<p>When clicking on the Print button you should now get your Word document based on your template with the tags replaced by the data coming from the database.</p>
<h2 id="35-plug-in-options">3.5 Plug-in options</h2>
<p>Since AOP v2.3 there are two plug-ins included: a process type plug-in and a dynamic action plug-in. If you are using APEX 5.1, the Dynamic Action plug-in will always work, whereas the Process plug-in only works if the “Reload on Submit” attribute (of the page) is set to “Always” (note this attribute is new in 5.1). This is due to a change how APEX 5.1 is handling Page Processing. If you would import an APEX 5.0 app in 5.1 by default it’s set to Always reload on submit, but if you create a brand new app in 5.1 it’s set to “Only for Success” and then the process plug-in is not working.</p>
<p>There are different configuration options that can be used in AOP.</p>
<p>In subsections to follow you can find more details for each of them.</p>
<h3 id="351-template-type">3.5.1 Template Type</h3>
<p>It stands for what will the source of your templates be.</p>
<p>AOP Plug-in allows you to:</p>
<ul>
<li>
<p>Use AOP default templates</p>
</li>
<li>
<p>Use static files kept on a server or as Application/Workspace files
(acting as as global templates)</p>
</li>
<li>
<p>Dynamically define your templates</p>
</li>
</ul>
<p><strong><em>AOP Template</em></strong></p>
<p>Will generate a Word document with a starting template based on the data
(JSON) that is submitted.</p>
<p><strong><em>Static Application Files</em></strong></p>
<p>Will reference files you find in Shared Components &gt; Static
Application Files</p>
<p><strong><em>Static Workspace Files</em></strong></p>
<p>Will reference files you find in Shared Components &gt; Static Workspace
Files</p>
<p><strong><em>SQL</em></strong></p>
<p>Query that returns two columns: template_type and file (in this order)</p>
<ul>
<li>template_type can be: docx,xlsx,pptx</li>
<li>while file column supports: clob base64 of the blob (hint: use apex_web_service.blob2clobbase64 to convert blob to clob).</li>
</ul>
<p><strong><em>PL/SQL Function (returning SQL)</em></strong></p>
<p>Return a select statement as with SQL.</p>
<p><strong><em>PL/SQL Function (returning JSON)</em></strong></p>
<p>Return JSON object with following format:</p>
<pre><code class="json">{
&quot;file&quot;:&quot;clob base64 data&quot;,
&quot;template_type&quot;:&quot;docx,xlsx,pptx&quot;
}
</code></pre>

<p><strong><em>Filename (with path relative to AOP server)</em></strong></p>
<p>Enter the path and filename of the template which is stored on the same
server AOP is running at.</p>
<p><strong><em>URL (returning file)</em></strong></p>
<p>Enter the url to your template in docx, xlsx or pptx.</p>
<h3 id="352-template-source">3.5.2 Template Source</h3>
<p>All types except the default AOP Template type will allow you to configure this setting. It can represent a name of your file or contain code for your SQL and PL/SQL.</p>
<p><img alt=" " src="./media/image11.png" /></p>
<p>Some Template Source examples can be found here:</p>
<p><strong><em>Static Application Files</em></strong></p>
<p>aop_simple_letter.docx</p>
<p><strong><em>Static Workspace Files</em></strong></p>
<p>aop_simple_letter.docx</p>
<p><strong><em>SQL</em></strong></p>
<pre><code class="sql">select
  a.TEMPLATE_TYPE as template_type,
  apex_web_service.blob2clobbase64(a.TEMPLATE_BLOB) as file
 from aop_template a
where id = 1
</code></pre>

<p><strong><em>PL/SQL Function (returning SQL)</em></strong></p>
<pre><code class="sql">declare
  l_return clob;
begin
  l_return := q'[
    select
      a.TEMPLATE_TYPE as template_type,
      apex_web_service.blob2clobbase64(a.TEMPLATE_BLOB) as file
     from aop_template a
    where id = 1
  ]';
  return l_return;
end;
</code></pre>

<p><strong><em>PL/SQL Function (returning JSON)</em></strong></p>
<pre><code class="sql">declare
  l_return clob;

begin
  l_return := '{ &quot;file&quot;: &quot;&quot;, &quot;template_type&quot;: &quot;docx&quot; }';
  return l_return;
end;

declare
  l_return clob;
  l_template clob;
  l_template_type aop_template.template_type%type;

begin
  select template_type, apex_web_service.blob2clobbase64(template_blob) template
    into l_template_type, l_template
    from aop_template
   where id = :p4_template;

  l_return := '{ &quot;file&quot;: &quot;' || replace(l_template,'&quot;', '\u0022') || '&quot;,'
           || ' &quot;template_type&quot;: &quot;' || replace(l_template_type,'&quot;', '\u0022')
           || '&quot; }';
  return l_return;
end;
</code></pre>

<p>You can use this technique to load html as template. Please have  a look at page 114 of the sample application. </p>
<p><strong><em>Filename (with path relative to AOP server)</em></strong></p>
<p>aop_template.docx</p>
<p><em>Note: Filename supports Substitutions like Application Items, Page Items and System Variables</em></p>
<p><strong><em>URL (returning file)</em></strong></p>
<p>http://apexofficeprint.com/templates/aop_template_d01.docx</p>
<h3 id="353-data-type">3.5.3 Data Type</h3>
<p>Data Type states what kind of data source you will be using.</p>
<p>Available options include:</p>
<p><strong><em>SQL</em></strong></p>
<p>Select statement in which you can use cursor to do nested records. Use "" as alias column names to force lower case column names. 
The data you select should be inside the data cursor. AOP plug-in expects two columns: filename and data.</p>
<pre><code>select
    'file1' as &quot;filename&quot;,
    cursor
    (
        ***Your select statement***
    ) as &quot;data&quot;
from dual
</code></pre>

<p><strong><em>PL/SQL Function (returning SQL)</em></strong></p>
<p>Return a select statement as with SQL.</p>
<p><strong><em>PL/SQL Function (returning JSON)</em></strong></p>
<p>Return JSON defined in URL example above.</p>
<p><strong><em>URL (returning JSON)</em></strong></p>
<p>Source should point to URL that returns JSON object with following format: { "filename": "file1", "data":[{...}] } If the URL is using an APEX ORDS REST call it will automatically be wrapped with additional JSON: {"items":[...]} All of this will be handled for you by AOP Plug-in.</p>
<p><strong><em>Region(s): Classic and/or Interactive Report(s) and/or Interactive Grid(s) and/or Charts</em></strong></p>
<p>One or more classic and/or interactive reports and/or interactive grids will be used as the source for your data. The Dynamic Action plug-in also has the possibility to take a screenshot of for example a JET chart or any other div (svg/canvas).</p>
<p><em>Note that you can use bind variables like :PX_ITEM as well in your SQL-statement. You find examples when you click on Help in the APEX Plug-in when you're on the Data Source field</em></p>
<h3 id="354-data-source">3.5.4 Data Source</h3>
<p>Depends on selected Data Type and it can be:</p>
<p><strong><em>SQL</em></strong></p>
<pre><code class="sql">select
  'file1' as &quot;filename&quot;,
  cursor(
    select
      c.cust_first_name as &quot;cust_first_name&quot;,
      c.cust_last_name as &quot;cust_last_name&quot;,
      c.cust_city as &quot;cust_city&quot;,
      cursor(
        select
          o.order_total as &quot;order_total&quot;,
          'Order ' || rownum as &quot;order_name&quot;,
          cursor(
            select
              p.product_name as &quot;product_name&quot;,
              i.quantity as &quot;quantity&quot;,
              i.unit_price as &quot;unit_price&quot;,
              APEX_WEB_SERVICE.BLOB2CLOBBASE64(p.product_image) as &quot;image&quot;
            from
              demo_order_items i, demo_product_info p
            where
              o.order_id = i.order_id
              and i.product_id = p.product_id
                ) &quot;product&quot;
        from
          demo_orders o
        where
          c.customer_id = o.customer_id
            ) &quot;orders&quot;
    from
      demo_customers c
    where
      customer_id = :P4_CUSTOMER_ID
        ) as &quot;data&quot;
from dual
</code></pre>

<p>Be sure to put the the returned data inside the <strong>data</strong> cursor.</p>
<pre><code class="sql">select
  'file1' as &quot;filename&quot;,
  cursor(
      ***Your Select Statement***
  )
   as &quot;data&quot;
from dual
</code></pre>

<p><strong><em>PL/SQL Function (returning SQL)</em></strong></p>
<p>The returned SQL should contain the data inside data cursor like above.</p>
<pre><code class="sql">declare
  l_return clob;
begin
  l_return := q'[
    select
      'file1' as &quot;filename&quot;,
      cursor(
        select
          c.cust_first_name as &quot;cust_first_name&quot;,
          c.cust_last_name as &quot;cust_last_name&quot;,
          c.cust_city as &quot;cust_city&quot;,
          cursor(
            select
              o.order_total as &quot;order_total&quot;,
              'Order ' || rownum as &quot;order_name&quot;,
              cursor(
                select
                  p.product_name as &quot;product_name&quot;,
                  i.quantity as &quot;quantity&quot;,
                  i.unit_price as &quot;unit_price&quot;,
                  APEX_WEB_SERVICE.BLOB2CLOBBASE64(p.product_image) as &quot;image&quot;
                from
                  demo_order_items i, demo_product_info p
                where
                  o.order_id = i.order_id
                  and i.product_id = p.product_id
                    ) &quot;product&quot;
            from
              demo_orders o
            where
              c.customer_id = o.customer_id
                ) &quot;orders&quot;
        from
          demo_customers c
        where
          customer_id = :P4_CUSTOMER_ID
            ) as &quot;data&quot;
    from dual
  ]';
  return l_return;
end;
</code></pre>

<p><strong><em>PL/SQL Function (returning JSON)</em></strong></p>
<p>Note how the JSON contains the data object with the actual data inside it.</p>
<pre><code class="sql">declare
  l_cursor sys_refcursor;
  l_return clob;
begin
  apex_json.initialize_clob_output(dbms_lob.call, true, 2) ;
  open l_cursor for
    select 'file1' as &quot;filename&quot;,
      cursor
        (select
         c.cust_first_name as &quot;cust_first_name&quot;,
         c.cust_last_name as &quot;cust_last_name&quot; ,
         c.cust_city as &quot;cust_city&quot; ,
         cursor
           (select
              o.order_total as &quot;order_total&quot;,
              'Order ' || rownum as &quot;order_name&quot; ,
              cursor
              (select
                 p.product_name as &quot;product_name&quot;,
                 i.quantity as &quot;quantity&quot; ,
                 i.unit_price as &quot;unit_price&quot; ,
                 apex_web_service.blob2clobbase64(p.product_image) as &quot;image&quot;
               from
                 demo_order_items i,
                 demo_product_info p
               where
                 o.order_id = i.order_id
                 and i.product_id = p.product_id
               ) &quot;product&quot;
            from
              demo_orders o
            where
              c.customer_id = o.customer_id
                and rownum &lt; 2
           )&quot;orders&quot;
         from
           demo_customers c
         where
           customer_id = :P4_CUSTOMER_ID
        ) as &quot;data&quot;
    from dual;
  apex_json.write(l_cursor);
  l_return := apex_json.get_clob_output;
  return l_return;
 end;
</code></pre>

<p><strong><em>URL with ORDS RESTful Web Service</em></strong></p>
<p>For this you need to create a new Webservice following these steps:</p>
<ol>
<li>
<p>Open SQL Workshop -&gt; RESTful services.</p>
<p>Click Create button and follow the wizard. For RESTful Services Module set</p>
<p><img alt=" " src="./media/image13.png" /></p>
<p>Name can be of your preference.</p>
</li>
<li>
<p>For Resource Template enter:</p>
<p><img alt=" " src="./media/image14.png" /></p>
</li>
<li>
<p>For Resource Handler enter:</p>
<p><img alt=" " src="./media/image15.png" /></p>
<p>The statement we used in this example is:</p>
</li>
</ol>
<pre><code class="sql">select
  file1' as &quot;filename&quot;,
  cursor(
    select
      c.cust_first_name,
      c.cust_last_name,
      c.cust_city,
      cursor(
        select
          o.order_total,
          'Order ' || rownum as order_name,
          cursor(
            select
              p.product_name,
              i.quantity,
              i.unit_price,
              APEX_WEB_SERVICE.BLOB2CLOBBASE64(p.product_image) as image
            from
              demo_order_items i,
              demo_product_info p
            where
              o.order_id = i.order_id
              and i.product_id = p.product_id
                ) product
        from
          demo_orders o
        where
          c.customer_id = o.customer_id
          and rownum &lt; 2
            ) orders
    from
      demo_customers c
    where
      customer_id = :id
        ) as &quot;data&quot;
from dual
</code></pre>

<p>4.Finally click Create Module button.</p>
<p><em>Note: For Resource Handler: GET setting after you created your RESTful service you may need to change Requires Secure Access setting from default Yes to No.</em></p>
<p><strong><em>Classic and/or Interactive Report(s) and/or Interactive Grid(s)</em></strong></p>
<p>not defined in Data Source but in Region Static ID(s) (see 3.5.5)</p>
<h3 id="355-region-static-ids">3.5.5 Region Static ID(s)</h3>
<p>Define one or more Static Id(s) of the report region (Classic or Interactive Report or Interactive Grid). Static ids should be separated by a comma. e.g. classic1,ir1,ir2
You can set the Static ID of the region in the region attributes.
You can call a specific Interactive Report by adding a pipe next to it e.g. ir1|my_saved_report.</p>
<h3 id="356-special">3.5.6 Special</h3>
<p>Specific features of APEX Office Print which become available when the data type is SQL or Classic and/or Interactive Report(s)</p>
<p>Available options include:</p>
<p><strong>Treat all numbers as strings</strong>
There's a limitation in APEX with the cursor() statement in SQL that it doesn't remember which datatype the column is in. So when doing to_char(0.9,'990D00') it will return 0.9 as number instead of as string '0.90'. To resolve this, enable this checkbox and concatenate your number with '!FMT!' e.g. '!FMT!'||to_char(35, '990D00') - !FMT! stands for format.</p>
<p>Alternatively if you format your number with the currency sign to_char(35,'FML990D00') Oracle will recognise it as a string and you don't need to use this checkbox.</p>
<p><strong>Report as Labels</strong>
Check this box in case you want to use the Classic or Interactive Report data source but print them as Labels (using the Mailings feature in Word). * this option is deprecated since AOP 3.0 as AOP understands labels depending the template.</p>
<p><strong>IR/IG: Show Filters on top</strong>
When there're filters applied to the Interactive Report/Grid, this checkbox will print them above the report.</p>
<p><strong>IR/IG: Show Highlights on top</strong>
When there're highlights applied to the Interactive Report/Grid, this checkbox will print them above the report.</p>
<p><strong>IR/IG: Show header with filter (Excel)</strong>
When checked AOP will make the header of the Interactive Report/Grid in Excel a filter.</p>
<p><strong>IR/IG: Use Saved Report instead of Report in Session</strong>
If you want to make sure you always call a specific Interactive Report/Grid, without taking into account what the person is doing with it, you can check this box and the named (saved) Interactive Report will be taken. e.g. ir1|my_saved_report would be in your source.</p>
<p><strong>IR/IG: Repeat header on every page</strong>
When the table spans multiple pages, the header row will be repeated on every page.</p>
<h3 id="357-output-filename-only-in-the-process-plug-in">3.5.7 Output Filename (only in the Process Plug-in)</h3>
<p>The filename can be a hard coded string or reference an APEX item. It does not need to include the file extension. If a file extension is defined that is different than the output type selected, a new file extension will be appended to the filename.
See further how to specify the output filename in the Dynamic Action plug-in (Init PL/SQL Code).</p>
<p><strong>Filename examples</strong></p>
<p>Static: my_file</p>
<p>APEX Item: &amp;P1_FILENAME.</p>
<h3 id="358-init-plsql-code-only-in-the-dynamic-action-plug-in">3.5.8 Init PL/SQL Code (only in the Dynamic Action Plug-in)</h3>
<p>You can define global variables of the aop_api_pkg in this area.</p>
<p>For example you can set the output filename or a font:</p>
<pre><code class="plsql">aop_api_pkg.g_output_filename      := 'output';
aop_api_pkg.g_output_filename      := v('P1_FILENAME');
aop_api_pkg.g_rpt_header_font_size := '12';
</code></pre>

<h3 id="359-output-type">3.5.9 Output Type</h3>
<p>Available options include:</p>
<ul>
<li>Word (docx)</li>
<li>Excel (xlsx)</li>
<li>Powerpoint (pptx)</li>
<li>PDF (pdf)</li>
<li>HTML (html)</li>
<li>Markdown (md)</li>
<li>Word (rtf)</li>
<li>Defined by APEX Item</li>
</ul>
<h3 id="3510-output-to">3.5.10 Output To</h3>
<p>Available options include:</p>
<p><strong>Browser</strong></p>
<p>The browser will download the file to your Downloads folder.</p>
<p><strong>Procedure</strong></p>
<p>This option will call a procedure in a specific format e.g. send_email_prc. This option is useful in case you do not need the file on your own hard drive, but for example you want to mail the document automatically. In that case you can create a procedure that adds the generated document as an attachment to your apex_mail.send.</p>
<p>In the database the procedure needs to have following parameters:</p>
<pre><code>procedure send_email_prc(
    p_output_blob in blob,
    p_output_filename in varchar2,
    p_output_mime_type in varchar2)
</code></pre>
<p><strong>Procedure and Browser</strong></p>
<p>This option allows you to call a procedure first and next download the file to your hard drive. An example is when you first want to store the generated document in a table before letting the browser to download it.</p>
<p><strong>Inline Region (pdf/html/md only)</strong></p>
<p>If you want to output a PDF in a certain region or as a pop-up modal dialog, use this option. See section: 2.3.1.9 for more info.</p>
<p><strong>Directory (on AOP Server)</strong></p>
<p>Save the file to a directory specified with g_output_directory. The default directory on the AOP Server is outputfiles. If you point this to a directory on a shared server or to a directory known by Google Drive or Dropbox, you can easily generate and share documents. Note that the AOP server should enable this option by using the <strong>--enable_save</strong> argument. It goes without saying that this option is not available while using cloud subscription.</p>
<h1 id="4-plsql-api">4 PL/SQL API</h1>
<h2 id="41-pre-requisites">4.1 Pre-requisites</h2>
<p>APEX 5.0.4 or higher needs to be installed in the database as the PL/SQL API uses some packages that come with APEX e.g. apex_json</p>
<h2 id="42-install-in-the-database">4.2 Install in the Database</h2>
<p>Go into SQL Plus, SQLcl, SQL Developer or SQL Workshop and make sure following packages exist aop_api18_pkg and aop_plsql18_pkg and the synonyms aop_api_pkg and aop_plsql_pkg. As part of the installation those packages should have been compiled.</p>
<h2 id="43-how-to-use">4.3 How to use</h2>
<p>You can call AOP straight from PL/SQL. APEX Office Print comes with two different ways of calling AOP; one package is aop_api_pkg which is also used behind the scenes in the APEX Plug-in and the other on is aop_plsql_pkg.
aop_plsql_pkg is especially useful when you just want to do the call to the AOP server component or cloud.</p>
<p>Next to the above two packages we also provide two additional packages that show how to do the pl/sql calls. See the packages aop_sample18_pkg and aop_test18_pkg.</p>
<h2 id="44-parameters">4.4 Parameters</h2>
<p><strong>aop_api_pkg</strong></p>
<p>Global variables which can be set</p>
<pre><code>-- Logger
g_logger_enabled            boolean := true;        -- In case you use Logger (https://github.com/OraOpenSource/Logger), you can compile this package to enable Logger output:
                                                    -- SQL&gt; ALTER PACKAGE aop_api18_pkg COMPILE PLSQL_CCFLAGS = 'logger_on:TRUE'; 
                                                    -- When compiled and this global variable is set to true, debug will be written to logger too
-- Call to AOP
g_aop_url                   varchar2(100) := null;  -- AOP Server url
g_api_key                   varchar2(50)  := null;  -- AOP API Key; only needed when AOP Cloud is used (http(s)://www.apexofficeprint.com/api)
g_failover_aop_url          varchar2(100) := null;  -- AOP Server url in case of failure of AOP url
g_failover_procedure        varchar2(200) := null;  -- When the failover url is used, the procedure specified in this variable will be called
g_output_converter          varchar2(50)  := null;  -- Set the converter to go to PDF (or other format different from template) e.g. officetopdf or libreoffice
g_proxy_override            varchar2(300) := null;  -- null=proxy defined in the application attributes
g_transfer_timeout          number(6)     := 1800;  -- default of APEX is 180
g_wallet_path               varchar2(300) := null;  -- null=defined in Manage Instance &gt; Instance Settings
g_wallet_pwd                varchar2(300) := null;  -- null=defined in Manage Instance &gt; Instance Settings
g_output_filename           varchar2(100) := null;  -- output
g_cloud_provider            varchar2(30)  := null;  -- dropbox, gdrive, onedrive, aws_s3
g_cloud_location            varchar2(300) := null;  -- directory in dropbox, gdrive, onedrive, aws_s3 (with bucket)
g_cloud_access_token        varchar2(500) := null;  -- access token for dropbox, gdrive, onedrive, aws_s3 (needs json)
g_language                  varchar2(2)   := 'en';  -- Language can be: en, fr, nl, de, used for the translation of filters applied etc. (translation build-in AOP)
g_app_language              varchar2(20)  := null;  -- Language specified in the APEX app (primary language, translated language), when left to null, apex_util.get_session_lang is being used
g_logging                   clob          := '';    -- ability to add your own logging: e.g. "request_id":"123", "request_app":"APEX", "request_user":"RND"
g_debug                     varchar2(10)  := null;  -- set to 'Local' when only the JSON needs to be generated, 'Remote' for remore debug
g_debug_procedure           varchar2(4000):= null;  -- when debug in APEX is turned on, next to the normal APEX debug, this procedure will be called
                                                    --   e.g. to write to your own debug table. The definition of the procedure needs to be the same as aop_debug
-- APEX Page Items
g_apex_items                varchar2(4000):= null;  -- colon separated list of APEX items e.g. P1_X:P1_Y, which can be referenced in a template using {Pxx_ITEM}                                                    
-- Layout for IR 
g_rpt_header_font_name      varchar2(50)  := '';    -- Arial - see https://www.microsoft.com/typography/Fonts/product.aspx?PID=163
g_rpt_header_font_size      varchar2(3)   := '';    -- 14
g_rpt_header_font_color     varchar2(50)  := '';    -- #071626
g_rpt_header_back_color     varchar2(50)  := '';    -- #FAFAFA
g_rpt_header_border_width   varchar2(50)  := '';    -- 1 ; '0' = no border
g_rpt_header_border_color   varchar2(50)  := '';    -- #000000
g_rpt_data_font_name        varchar2(50)  := '';    -- Arial - see https://www.microsoft.com/typography/Fonts/product.aspx?PID=163
g_rpt_data_font_size        varchar2(3)   := '';    -- 14
g_rpt_data_font_color       varchar2(50)  := '';    -- #000000
g_rpt_data_back_color       varchar2(50)  := '';    -- #FFFFFF
g_rpt_data_border_width     varchar2(50)  := '';    -- 1 ; '0' = no border
g_rpt_data_border_color     varchar2(50)  := '';    -- #000000
g_rpt_data_alt_row_color    varchar2(50)  := '';    -- #FFFFFF for no alt row color, use same color as g_rpt_data_back_color
/* see also Printing attributes in Interactive Report */
-- Settings for Calendar
g_cal_type                  varchar2(10)  := 'month'; -- can be month (default), week, day, list
g_start_date                date          := null;    -- start date of calendar
g_end_date                  date          := null;    -- end date of calendar
g_weekdays                  varchar2(300) := null;    -- translation for weekdays e.g. Monday:Tuesday:Wednesday etc.
g_months                    varchar2(300) := null;    -- translation for months   e.g. January:February etc.  
g_color_days_sql            varchar2(4000):= null;    -- color the background of certain days. 
                                                    --   e.g. select 1 as "id", sysdate as "date", 'FF8800' as "color" from dual
-- HTML template to Word/PDF
g_orientation               varchar2(50)  := '';      -- empty is portrait, other option is 'landscape'
-- Call to URL data source
g_url_username              varchar2(300) := null;
g_url_password              varchar2(300) := null;
g_url_proxy_override        varchar2(300) := null;
g_url_transfer_timeout      number        := 180;
g_url_body                  clob          := empty_clob();
g_url_body_blob             blob          := empty_blob();
g_url_parm_name             apex_application_global.vc_arr2; --:= empty_vc_arr;
g_url_parm_value            apex_application_global.vc_arr2; --:= empty_vc_arr;
g_url_wallet_path           varchar2(300) := null;
g_url_wallet_pwd            varchar2(300) := null;
g_url_https_host            varchar2(300) := null;    -- parameter for apex_web_service, not used, please apply APEX patch if issues
-- Web Source Module (APEX &gt;= 18.1)
g_web_source_first_row      pls_integer   := null;    -- parameter for apex_exec.open_web_source_query
g_web_source_max_rows       pls_integer   := null;    -- parameter for apex_exec.open_web_source_query
g_web_source_total_row_cnt  boolean       := false;   -- parameter for apex_exec.open_web_source_query
-- REST Enabled SQL (APEX &gt;= 18.1)
g_rest_sql_auto_bind_items  boolean       := true;    -- parameter for apex_exec.open_remote_sql_query
g_rest_sql_first_row        pls_integer   := null;    -- parameter for apex_exec.open_remote_sql_query
g_rest_sql_max_rows         pls_integer   := null;    -- parameter for apex_exec.open_remote_sql_query
g_rest_sql_total_row_cnt    boolean       := false;   -- parameter for apex_exec.open_remote_sql_query
g_rest_sql_total_row_limit  pls_integer   := null;    -- parameter for apex_exec.open_remote_sql_query
-- IP Printer support
g_ip_printer_location       varchar2(300) := null;
g_ip_printer_version        varchar2(300) := '1';
g_ip_printer_requester      varchar2(300) := nvl(apex_application.g_user, USER);
g_ip_printer_job_name       varchar2(300) := 'AOP';
g_ip_printer_return_output  varchar2(5)   := null;   -- null or 'Yes' or 'true'
-- Convert characterset
g_convert                   varchar2(1)   := c_n;    -- set to Y (c_y) if you want to convert the JSON that is send over; necessary for Arabic support
g_convert_source_charset    varchar2(20)  := null;   -- default of database 
g_convert_target_charset    varchar2(20)  := 'AL32UTF8';  
-- Output
g_output_directory          varchar2(200) := '.';    -- set output directory on AOP Server
                                                    -- if . is specified the files are saved in the default directory: outputfiles
g_output_split              varchar2(5)   := null;   -- split file: one file per page: true/false

-- Files
g_prepend_files_sql         clob := null;    -- format: select filename, mime_type, [file_blob, file_base64, url_call_from_db, url_call_from_aop, file_on_aop_server]
g_append_files_sql          clob := null;    --           from my_table

-- Sub-Templates
g_sub_templates_sql         clob := null;    -- format: select filename, mime_type, [file_blob, file_base64, url_call_from_db, url_call_from_aop, file_on_aop_server] from my_table

-- Password protected PDF
g_output_read_password      varchar2(200) := null;  -- protect PDF to read
g_output_modify_password    varchar2(200) := null;  -- protect PDF to write (modify)
g_output_pwd_protection_flag number(4)    := null;  -- optional; default is 4.
</code></pre>
<p>Function call</p>
<pre><code>function plsql_call_to_aop(
  p_data_type             in varchar2 default c_source_type_sql,
  p_data_source           in clob,
  p_template_type         in varchar2 default c_source_type_apex,
  p_template_source       in clob,
  p_output_type           in varchar2,
  p_output_filename       in out nocopy varchar2,
  p_output_type_item_name in varchar2 default null,
  p_output_to             in varchar2 default null,
  p_procedure             in varchar2 default null,
  p_binds                 in wwv_flow_plugin_util.t_bind_list default c_binds,
  p_special               in varchar2 default null,
  p_aop_remote_debug      in varchar2 default 'No',
  p_output_converter      in varchar2 default null,
  p_aop_url               in varchar2,
  p_api_key               in varchar2,
  p_app_id                in number default null,
  p_page_id               in number default null,
  p_user_name             in varchar2 default null,
  p_init_code             in clob default 'null;',
  p_output_encoding       in varchar2 default c_output_encoding_raw,
  p_failover_aop_url      in varchar2 default null,
  p_failover_procedure    in varchar2 default null,
  p_log_procedure         in varchar2 default null,
  p_prepend_files_sql     in clob     default null,
  p_append_files_sql      in clob     default null,
  p_sub_templates_sql     in clob     default null)
  return blob;
</code></pre>
<p>Note that some other procedures and functions are available in the package which could be helpful.</p>
<p><strong>aop_plsql_pkg</strong></p>
<pre><code>function make_aop_request(
  p_aop_url          in varchar2 default g_aop_url,
  p_api_key          in varchar2 default g_api_key,
  p_json             in clob,
  p_template         in blob,
  p_output_encoding  in varchar2 default 'raw', -- change to raw to have binary, change to base64 to have base64 encoded
  p_output_type      in varchar2 default null,
  p_output_filename  in varchar2 default 'output',
  p_aop_remote_debug in varchar2 default 'No')
  return blob;
</code></pre>
<h2 id="45-example">4.5 Example</h2>
<p>Example with <strong>aop_api_pkg</strong></p>
<pre><code>declare
  l_binds           wwv_flow_plugin_util.t_bind_list;
  l_return          blob;
  l_output_filename varchar2(100) := 'output';
begin
  -- define bind variables
  l_binds(1).name := 'p_id';
  l_binds(1).value := '1';

  l_return := aop_api_pkg.plsql_call_to_aop (
                p_data_type       =&gt; 'SQL',
                p_data_source     =&gt; q'[
                  select
                    'file1' as "filename",
                    cursor(
                      select
                        c.cust_first_name as "cust_first_name",
                        c.cust_last_name as "cust_last_name",
                        c.cust_city as "cust_city",
                        cursor(select o.order_total as "order_total",
                                      'Order ' || rownum as "order_name",
                                  cursor(select p.product_name as "product_name",
                                                i.quantity as "quantity",
                                                i.unit_price as "unit_price", APEX_WEB_SERVICE.BLOB2CLOBBASE64(p.product_image) as "image"
                                           from demo_order_items i, demo_product_info p
                                          where o.order_id = i.order_id
                                            and i.product_id = p.product_id
                                        ) "product"
                                 from demo_orders o
                                where c.customer_id = o.customer_id
                              ) "orders"
                      from demo_customers c
                      where customer_id = :p_id
                    ) as "data"
                  from dual
                ]',
                p_template_type   =&gt; 'SQL',
                p_template_source =&gt; q'[
                   select template_type, template_blob
                    from aop_template
                   where id = 1
                ]',
                p_output_type     =&gt; 'docx',
                p_output_filename =&gt; l_output_filename,
                p_binds           =&gt; l_binds,
                p_aop_url         =&gt; 'http://api.apexofficeprint.com/',
                p_api_key         =&gt; '1C511A58ECC73874E0530100007FD01A',
                p_app_id          =&gt; 232);
end;
</code></pre>
<p>Example with <strong>aop_plsql_pkg</strong></p>
<pre><code>declare
  l_template        blob;
  l_output_file     blob;
begin
  select template_blob
    into l_template
    from aop_template
   where id = 1;

  l_output_file := aop_plsql_pkg.make_aop_request(
                     p_json        =&gt; '[{ "filename": "file1", "data": [{ "cust_first_name": "APEX Office Print" }] }]',
                     p_template    =&gt; l_template,
                     p_output_type =&gt; 'docx',
                     p_aop_remote_debug =&gt; 'Yes');
end;
</code></pre>
<p>In <strong>aop_sample18_pkg</strong> you find the above examples and you can run them with following command:</p>
<pre><code>begin
    aop_sample18_pkg.call_aop_plsql_pkg;
    aop_sample18_pkg.call_aop_api_pkg;
end;
</code></pre>
<p>Note that there are more examples in the <strong>aop_sample18_pkg</strong>, so it's worthwhile to check it out.</p>
<h2 id="46-plsql-api-documentation">4.6 PL/SQL API Documentation</h2>
<p>The complete reference can be found in the <a href="./plsql/index.html">AOP PL/SQL API documentation</a>.</p>
<h1 id="5-manual-rest-call">5 Manual (REST) call</h1>
<h2 id="51-overview">5.1 Overview</h2>
<p>Behind the scenes the APEX plug-in is creating a JSON file that will be sent to the AOP server. Below you find more details about the JSON structure that is used. By understanding this JSON structure you can manually interact with the AOP server in case you wanted to code in PL/SQL or other languages.</p>
<h2 id="52-json-file">5.2 JSON File</h2>
<p>The JSON file is a file that follows the standard JSON structure (<a href="http://json.org/">http://json.org/</a>).</p>
<p>This JSON file contains an JSON object meaning it starts with { and ends with }. This JSON object contains four compulsory JSON objects namely "template", "output", "files", "api_key" and a few optional object "version", "logging", "apex_version", "aop_remote_debug" and "ipp". The purpose of each object will now be explained.</p>
<h3 id="521-version-object">5.2.1 "version" object</h3>
<p>This object contains the version of AOP JSON format used. The current version is 18.1 and backwards compatible thus optional. This will be used for future upgrades and if the newer version is not backwards compatible.</p>
<h3 id="522-template-object">5.2.2 "template" object</h3>
<p>This object has the necessary information about the template. It contains:</p>
<table>
<thead>
<tr>
<th>JSON</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>"file"</td>
<td>This contains the template to be used, encoded in base64.</td>
</tr>
<tr>
<td>"filename"</td>
<td>This option is for on-premise users. The template defined by this object will be used for processing. Note that the filename either contains a relative path from where the server is running from (or the folder/directory containing application) or an absolute path.</td>
</tr>
<tr>
<td>"template_type"</td>
<td>This states what kind of template is being used. It must be either "docx", "pptx", "xlsx", "html" or "md".</td>
</tr>
<tr>
<td>"html_template_content"</td>
<td>Since AOP 3.4 it is possible to just pass html as template. This is equivalent as using {_html} tag in word to create the template which is then again passed to the AOP with the data for rendering.</td>
</tr>
<tr>
<td>"orientation"</td>
<td>nothing or "landscape". If landscape is provided then the html template content will be rendered in a landscape A4 word template. Taken only into account when html_template_content is provided.</td>
</tr>
<tr>
<td>If "file" and "filename" objects are not present in the "template" object then the server will respond with a custom template file of "template_type" made from this given JSON file. Currently only Word, Excel and Powerpoint template generation is supported.</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="523-output-object">5.2.3 "output" object</h3>
<p>This object has the necessary information for producing an output file from the given JSON file. It contains:</p>
<table>
<thead>
<tr>
<th>JSON</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>"output_type"</td>
<td>This states what kind of output file type is required. It can be either the same as template_type ("docx", "pptx", "xlsx", "html", "md"), "pdf" or any other output file supported by libreoffice/openoffice. Special output type: "onepagepdf", this will cause the ouptut to be converted to pdf and all the pages will be merged into one single page.  Default: the same as template_type.</td>
</tr>
<tr>
<td>"output_encoding"</td>
<td>This states what kind of output encoding is wished for the output file. It must be either "raw" or "base64".</td>
</tr>
<tr>
<td>"output_converter"</td>
<td>This states which software should be used to convert to pdf. The ApexOfficePrint server usages LibreOffice. On premise users may use MS Office but will need to do some configuration first. Available values: "officetopdf" (Windows only) or "libreoffice" (Windows, Linux, OSX) or anyother custom defined converters in aop_config.json file (see setting up AOP) if you are using On Premise Version.</td>
</tr>
<tr>
<td>"output_directory"</td>
<td>If save on disk is enabled, then the document will be saved on the path resulted by combining this given path with the specified directory.</td>
</tr>
<tr>
<td>"output_modify_password"</td>
<td>Requires output pdf, the password needed to modify the pdf. Optional. Read password, if given, will be used if this field is empty.</td>
</tr>
<tr>
<td>"output_read_password"</td>
<td>Requires output pdf, the password needed to open the pdf. Optional.</td>
</tr>
<tr>
<td>"output_password_protection_flag"</td>
<td>Requires output pdf,  bit field explained in the PDF specs in table 3.20 in section 3.5.2, should be given in decimal <a href="http://pdfhummus.com/post/147451287581/hummus-1058-and-pdf-writer-updates-encryption">more info</a>. Optional. Default (4).</td>
</tr>
</tbody>
</table>
<h3 id="523-api_key">5.2.3 "api_key"</h3>
<p>The value of this key is the api key given by ApexOfficePrint. Only applicable for service users.</p>
<h3 id="524-file-array">5.2.4 "file" array</h3>
<p>This array contains the data that will be used for the given template.
If this array contains more than one object then the output files, which are generated using the same template for each item, will be returned in a zip file. This array contains JSON objects with following fields:</p>
<table>
<thead>
<tr>
<th>JSON</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>"filename"</td>
<td>This field contains the name of the output file.</td>
</tr>
<tr>
<td>"data"</td>
<td>This array (containing one object) or object contains the data that will be replaced in the template.</td>
</tr>
</tbody>
</table>
<p>Example showing a basic JSON file which should be populated with data:</p>
<pre><code class="json">{
    &quot;template&quot;: {
           &quot;filename&quot;               :&quot;template.docx&quot;,
           &quot;template_type&quot;          :&quot;docx&quot;
    },
    &quot;output&quot;: {
           &quot;output_encoding&quot;        :&quot;raw&quot;,
           &quot;output_type&quot;            :&quot;docx&quot;,
           &quot;output_directory&quot;       :&quot;.&quot;
    },
    &quot;files&quot;: [{
             &quot;filename&quot;             :&quot;file1&quot;,
             &quot;data&quot;                 : [{...}]
    }]
}
</code></pre>

<h3 id="525-logging-object">5.2.5 "logging" object</h3>
<p>When AOP is started with --enable_printlog, it will create a file on the server called server_printjob.log.
You can add additional logging information next to the one AOP is logging by default, by adding additional keys and values in the logging object.</p>
<p>For example:</p>
<pre><code class="json">    &quot;logging&quot;: {
        &quot;template_filename&quot;: &quot;AOP template&quot;,
        &quot;output_filename&quot;: &quot;output.docx&quot;
    }
</code></pre>

<h3 id="526-ipp-object">5.2.6 "ipp" object</h3>
<p>AOP supports to print directly to an IP Printer by using this setting. If your IPP printer supports pdf files, your documents will be converter to pdf and sent to IPP printer. If your printer does not support PDF and supports Postscript then the pdf generated is converter to pdf using pdftops. You need download xpdf tools from: https://www.xpdfreader.com/download.html. Make sure that the binary pdftops is on PATH variable. You can download executables from apexofficeprint.com to check whether or not your IPP printer supports PDF/postscript.
The structure is:</p>
<pre><code class="json">&quot;ipp&quot;: {
        &quot;location&quot;: &quot;http://10.0.14.223:631/&quot;,
        &quot;version&quot;: &quot;1.1&quot;,
        &quot;requester&quot;: &quot;YOUR NAME&quot;,
        &quot;job_name&quot;: &quot;AOP&quot;
    }
</code></pre>

<h1 id="6-templates">6 Templates</h1>
<p>The templates are standard office files in which tags will be replaced by structured data from the JSON file. These tags are quite standardized for either <strong>.docx</strong>, <strong>.pptx</strong> or <strong>.xlsx</strong>, however there are some subtle differences. They are all able to handle <strong>JavaScript angular expressions</strong>, on which some of the basics will follow.</p>
<h2 id="60-tag-overview">6.0 Tag Overview</h2>
<p>In the table below is an overview of the available tags and their support in Word, Excel and PowerPoint respectively. For more information on each tag, see the sections that follow.</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Word</th>
<th>Excel</th>
<th>PowerPoint</th>
<th>HTML</th>
<th>Markdown</th>
<th>Txt</th>
</tr>
</thead>
<tbody>
<tr>
<td>{data_string}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>{data_string_with_cell_markup$}</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>N.A</td>
</tr>
<tr>
<td>{-labels}</td>
<td>Yes</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
</tr>
<tr>
<td>{_htmlcontent}</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes (by default)</td>
<td>Yes (by default)</td>
<td>N.A</td>
</tr>
<tr>
<td>{!slide_loop}</td>
<td>N.A</td>
<td>N.A</td>
<td>Yes</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
</tr>
<tr>
<td>{!excelsheet_loop}</td>
<td>N.A</td>
<td>Yes</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
</tr>
<tr>
<td>{#data_loop} … {/data_loop}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>{:data_loop_horizontal} … {/data_loop_horizontal}</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
</tr>
<tr>
<td>{=table_row_loop} … {/table_row_loop}</td>
<td>N.A</td>
<td>N.A</td>
<td>Yes</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
</tr>
<tr>
<td>{%imageKey}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>N.A</td>
</tr>
<tr>
<td>{&#124;barcode}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>N.A</td>
</tr>
<tr>
<td>{&#124;qrcode}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>N.A</td>
</tr>
<tr>
<td>{$chart}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>N.A</td>
</tr>
<tr>
<td>{&amp;interactive_report}</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>N.A</td>
</tr>
<tr>
<td>{&amp;interactive_grid&amp;}</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>N.A</td>
</tr>
<tr>
<td>{&lt;rightToLeft}</td>
<td>Yes</td>
<td>Not Necessary</td>
<td>Not Necessary</td>
<td>Not Necessary</td>
<td>Not Necessary</td>
<td>N.A</td>
</tr>
<tr>
<td>{+footnote}</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>N.A</td>
</tr>
<tr>
<td>{*hyperlink}</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Not Necessary</td>
<td>Not Necessary</td>
<td>N.A</td>
</tr>
<tr>
<td>{~}</td>
<td>Yes</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
<td>N.A</td>
</tr>
</tbody>
</table>
<p>Note: tags can't start with a number and should start with an alphabetical character (a-z,A-Z)</p>
<h2 id="61-word-docx-template">6.1 Word (docx) template</h2>
<p>These templates can contain the following tags:</p>
<h3 id="611-data95string-tags">6.1.1 {data_string} tags</h3>
<p>This tag, <strong>{data_string},</strong> will be replaced by the value of the key <strong>"data_string"</strong> in the JSON file.</p>
<h4 id="6111-data-string-example">6.1.1.1 Data string example</h4>
<p>Given the JSON file with following content:</p>
<pre><code class="json">    {
        &quot;template&quot;: {
               &quot;filename&quot;               :&quot;template.docx&quot;,
               &quot;template_type&quot;          :&quot;docx&quot;
        },
        &quot;output&quot;: {
               &quot;output_encoding&quot;        :&quot;raw&quot;,
               &quot;output_type&quot;            :&quot;docx&quot;
        },
        &quot;files&quot;: [{
                 &quot;filename&quot;             :&quot;output&quot;,
                 &quot;data&quot;: [{
                         &quot;first_name&quot;   :&quot;DemoName&quot;,
                         &quot;last_name&quot;    :&quot;DemoLastName&quot;,
                         &quot;city&quot;         :&quot;DemoCity&quot;
                  }]
        }]
    }
</code></pre>

<p>and template.docx with following content:</p>
<pre><code>                                             {last_name} {first_name}
                                             {city}
</code></pre>
<p>will result in:</p>
<pre><code>                                              DemoLastName DemoName
                                              DemoCity
</code></pre>
<p>Since the template and the output objects from the json will not change, these will be omitted from the examples given below.</p>
<h3 id="612-imagekey-tags">6.1.2 {%imagekey} tags</h3>
<p>This tag is the same as {data_string} but instead getting replaced by a string this tag is replaced by an image that is placed in the value of key "imagekey" after base64 encoding. Note that imagekey is just a variable. An image tag is represented by "%" after curly bracket.
You can also specify a fixed width and the height by adding following values "imagekey_width" and "imagekey_height". If you want to scale your image proportionally you can use the "imagekey_max_width" and "imagekey_max_height" tags. An example is created in the AOP Sample Application which shows how it works. The imagekey is pic, so we can use pic_max_width for example.
The given data can be a base64 encoded image or a URL pointing to an image(the url must have image extension) or a ftp server image. </p>
<h4 id="6121-image-tag-example">6.1.2.1 Image tag example</h4>
<p>Replace /...code..../ for the base64 encoded string of the image</p>
<pre><code class="json">    {
        ...
        &quot;files&quot;:[{
                 &quot;filename&quot;        :&quot;output&quot;,
            &quot;data&quot;:[{
                  &quot;product_name&quot;   :&quot;Wallet&quot;,
                  &quot;price&quot;          :&quot;$500.00&quot;,
                  &quot;pic&quot;            :&quot;/...code..../&quot;,
                  &quot;pic_max_width&quot;  : 100,
                  &quot;pic_max_height&quot; : 100
            }]
        }]
    }
</code></pre>

<p>with template:</p>
<table>
<thead>
<tr>
<th>Product</th>
<th>Image</th>
<th>Price</th>
</tr>
</thead>
<tbody>
<tr>
<td>{product_name}</td>
<td>{%pic}</td>
<td>{price}</td>
</tr>
</tbody>
</table>
<p>will result in:</p>
<p><img alt=" " src="./media/image34.png" /></p>
<p><img alt="" src="./media/image_example_aop.gif" /></p>
<p>Tip: in case you want to make your images equal in size, you can use PL/SQL to resize your images. Here's an example to put the size of the image to a maximum of 200px.</p>
<pre><code class="sql">declare
  l_img blob;
begin
  select image
    into l_img
    from my_table
   where id = 1 for update;
  ordsys.ordimage.process(l, 'maxscale=200 200');
  update my_table
     set image = l
   where id = 1;
end;
</code></pre>

<h3 id="613-barcode-qrcode-tags">6.1.3 {|barcode} / {|qrcode} tags</h3>
<p>This tag will be replaced by the barcode or QR code created using the data of the key named <strong>"barcode"</strong> or <strong>"qrcode"</strong>. Notice that these are also variable. Barcode or qrcode tags are represented by | after
curly bracket. If this tag is found in the document there must be additional supporting keys containing the options for these tags. These options are:</p>
<ol>
<li>
<p>key_type, e.g. "barcode_type" if the key used is "barcode".
   This field contains the type of barcode required.
   The options are:
    <code>codabar
    code128
    code128a
    code128b
    code128c
    code39
    ean13
    ean2
    ean5
    ean8
    itf
    itf14
    msi
    msi10
    msi1010
    msi11
    msi1110
    pharmacode
    upc
    upce</code></p>
</li>
<li>
<p>key_height, e.g. "barcode_height" if the key used is "barcode".
   This field contains the height for the generated image.
   Default is 200 for QR, 50 for the rest.</p>
</li>
<li>
<p>key_width, e.g. "barcode_width" if they key used is "barcode".
   This field contains the width for the generated image.
   Default is 200.</p>
</li>
<li>
<p>key_errorcorrectlevel (only for QR code), e.g. "qrcode_errorcorrectlevel" if the key used is "qrcode". This field contains the level of which the QR code should be recoverable.
   The options are:
   "L" (up to 7% damage)
   "M" (up to 15% damage)
   "Q" (up to 25% damage)
   "H" (up to 30% damage)
   Extra info: <a href="http://www.qrcode.com/en/about/error_correction.html">http://www.qrcode.com/en/about/error_correction.html</a></p>
</li>
<li>
<p>key_cellsize (only for QR code), e.g.  "qrcode_cellsize". This field contains the dot size of a module.
   Default is 4.
   Extra info: <a href="http://www.qrcode.com/en/howto/cell.html">http://www.qrcode.com/en/howto/cell.html</a></p>
</li>
</ol>
<h4 id="6131-barcode-tag-example">6.1.3.1 Barcode tag example</h4>
<p>Given the JSON file:</p>
<pre><code class="json">    {
        ...
        &quot;files&quot;:[{
                 &quot;filename&quot;           :&quot;output&quot;,
            &quot;data&quot;:[{
                  &quot;product_name&quot;      :&quot;Wallet&quot;,
                  &quot;product_code&quot;      :&quot;1896547832148&quot;,
                  &quot;product_code_type&quot; :&quot;ean13&quot;,
                  &quot;product_link&quot;      :&quot;https://www.google.be/search?q=wallet&quot;,
                  &quot;product_link_type&quot; :&quot;qrcode&quot;
            }]
        }]
    }
</code></pre>

<p>and template as:</p>
<p><img alt=" " src="./media/image36.png" /></p>
<p>will result in:</p>
<p><img alt=" " src="./media/image37.png" /></p>
<p><img alt=" " src="./media/barcode_example_aop.gif" /></p>
<p>For barcodes, instead of doing the above, you could also choose to install a barcode font, for example <a href="https://www.barcodesinc.com/free-barcode-font/">Free 3of9</a> or <a href="http://www.dafont.com/3of9-barcode.font">http://www.dafont.com/3of9-barcode.font</a>. Barcode fonts are more performant than images. See the other section for more information about language and font support.</p>
<h3 id="614-chart-tags">6.1.4 {$chart} tags</h3>
<p>This tag will be replaced by chart created using the data of the key named <strong>"chart"</strong>. Notice that this key is a variable. Charts are represented by $ after curly bracket. If this tag is found in the document the chart object in the json must follow certain structure. Firstly an optional object with key <strong>"options"</strong> to determine the options for the chart. The default options are:</p>
<pre><code class="json">    defaultOptions = {
            width: 5486400 / 9525, // width of the chart
            height: 3200400 / 9525, // height of the chart
            grid: true, // if a grid should be shown
            border: true, // if a border should be shown
            title: false,
            legend: {
                showLegend: true, // if the legend should be shown
                position: 'r'  // 'l' for left, 'r' right, 'b' bottom, 't' top
            },
            axis: {
                x: {
                    orientation: 'minMax', // or &quot;maxMin&quot;
                    min: undefined, // a specific number
                    max: undefined, // a specific number
                    type: undefined, // or &quot;date&quot;
                    date: { //date options
                        format: 'unix',
                        code: 'mm/yy',
                        unit: 'months',
                        step: '1'
                    },
                    showValues: true //options to disable showing the values in axis

                },
                y: {
                    orientation: 'minMax',
                    mix: undefined,
                    max: undefined,
                    showValues: true // options to disable showing the values in axis
                 },
                y2: { //If using multiple charts and axis on the right side
                orientation: 'minMax',
                mix: undefined,
                max: undefined,
                showValues: true // options to disable showing the values in axis
                }
            }
        }
</code></pre>

<p>Secondly the type of chart should be determined by "type" key. The generation of following types of charts is supported:</p>
<h3 id="6141-line">6.1.4.1 Line</h3>
<p>This is a normal chart where the data's are connected with lines. Multiple lines can be generated.  The chart key should contain lines array inside with the data of the lines that should be generated and the name of the line. E.g.:</p>
<pre><code class="json">    &quot;chart&quot;: {
            &quot;lines&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;4.3&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;2.5&quot;
                        },
                        {s
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;3.5&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;line 1&quot;,
                    &quot;smooth&quot;: true, //Can be false
                    &quot;symbol&quot;: &quot;square&quot; // can be diamond triangle
                },
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;2.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;4.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;1.8&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;line 2&quot;
                }
            ],
            &quot;type&quot;: &quot;line&quot;
        }
</code></pre>

<p>will result in :</p>
<p><img alt=" " src="./media/imageChartLine.png" /></p>
<h3 id="6142-bar">6.1.4.2 bar</h3>
<p>In order to generate the bar chart, the chart object should then contains array names bars. This array contains the objects with data about the bar and the name of the bar. For example, given the following:</p>
<pre><code class="json">    ...
    &quot;chart&quot;: {
        &quot;bars&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 1&quot;
            },
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;2.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;4.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;1.8&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 2&quot;
            }
        ],
        &quot;type&quot;: &quot;bar&quot;
    }
    ...
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartBar.png" /></p>
<p>Single bar chart is generated as follows:</p>
<pre><code class="json">    ...
    &quot;chart&quot;: {
        &quot;bars&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 1&quot;
            }
        ],
        &quot;type&quot;: &quot;bar&quot;
    }
    ...
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartBarSingle.png" /></p>
<h3 id="6143-barstacked">6.1.4.3 barStacked</h3>
<p>This is like bar chart but the bars from same category will be stacked. For example, given the following:</p>
<pre><code class="json">    ...
    &quot;chart&quot;: {
        &quot;bars&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 1&quot;
            },
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;2.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;4.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;1.8&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 2&quot;
            }
        ],
        &quot;type&quot;: &quot;barStacked&quot;
    }
    ...
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartBarStacked.png" /></p>
<h3 id="6144-barstackedpercent">6.1.4.4 barStackedPercent</h3>
<p>This is like bar stacked chart but the x axis will be in expressed in percentage.
For example, given the following:</p>
<pre><code class="json">    ...
    &quot;chart&quot;: {
        &quot;bars&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 1&quot;
            },
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;2.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;4.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;1.8&quot;
                    }
                ],
                &quot;name&quot;: &quot;bar 2&quot;
            }
        ],
        &quot;type&quot;: &quot;barStacked&quot;
    }
    ...
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartBarStackedPercent.png" /></p>
<h3 id="6145-column">6.1.4.5 column</h3>
<p>This will produce a normal column chart. The chart object should then contain an array named columns with objects containing the data and name of the column. E.g.:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;columns&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;4.3&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;2.5&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;3.5&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 1&quot;
                },
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;2.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;4.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;1.8&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 2&quot;
                }
            ],
            &quot;type&quot;: &quot;column&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartColumn.png" /></p>
<p>A single column chart can be generated by following json:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;columns&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;4.3&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;2.5&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;3.5&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 1&quot;
                }
            ],
            &quot;type&quot;: &quot;column&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartColumnSingle.png" /></p>
<h3 id="6146-columnstacked">6.1.4.6 columnStacked</h3>
<p>This will produce a column stacked chart. The chart object should then contain an array named columns with objects containing the data and the name of the column. E.g:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;columns&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;4.3&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;2.5&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;3.5&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 1&quot;
                },
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;2.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;4.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;1.8&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 2&quot;
                }
            ],
            &quot;type&quot;: &quot;columnStacked&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartColumnStacked.png" /></p>
<h3 id="6147-columnstackedpercent">6.1.4.7 columnStackedPercent</h3>
<p>This will product a column stacked percent chart. The chart object should then contain an array named columns with objects containing the data and the name of the column.  E.g:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;columns&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;4.3&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;2.5&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;3.5&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 1&quot;
                },
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;day 1&quot;,
                            &quot;y&quot;: &quot;2.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 2&quot;,
                            &quot;y&quot;: &quot;4.4&quot;
                        },
                        {
                            &quot;x&quot;: &quot;day 3&quot;,
                            &quot;y&quot;: &quot;1.8&quot;
                        }
                    ],
                    &quot;name&quot;: &quot;column 2&quot;
                }
            ],
            &quot;type&quot;: &quot;columnStackedPercent&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartColumnStackedPercent.png" /></p>
<h3 id="6148-pie">6.1.4.8 pie</h3>
<p>This will produce a pie chart. The chart object should then contain an array named pies with one element containing the data and name of the pie chart. E.g:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;pies&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;Order 1&quot;,
                            &quot;y&quot;: 1890
                        },
                        {
                            &quot;x&quot;: &quot;Order 2&quot;,
                            &quot;y&quot;: 2380
                        },
                        {
                            &quot;x&quot;: &quot;Order 3&quot;,
                            &quot;y&quot;: 1640
                        },
                        {
                            &quot;x&quot;: &quot;Order 4&quot;,
                            &quot;y&quot;: 1090
                        },
                        {
                            &quot;x&quot;: &quot;Order 5&quot;,
                            &quot;y&quot;: 950
                        },
                        {
                            &quot;x&quot;: &quot;Order 6&quot;,
                            &quot;y&quot;: 1515
                        },
                        {
                            &quot;x&quot;: &quot;Order 7&quot;,
                            &quot;y&quot;: 905
                        },
                        {
                            &quot;x&quot;: &quot;Order 8&quot;,
                            &quot;y&quot;: 1060
                        },
                        {
                            &quot;x&quot;: &quot;Order 9&quot;,
                            &quot;y&quot;: 730
                        },
                        {
                            &quot;x&quot;: &quot;Order 10&quot;,
                            &quot;y&quot;: 870
                        }
                    ],
                    &quot;name&quot;: &quot;pie 1&quot;
                }
            ],
            &quot;type&quot;: &quot;pie&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/imageChartPie.png" /></p>
<h3 id="6149-radar">6.1.4.9 radar</h3>
<p>This will produce a radar chart. The chart object should then contain an array named radars with one element containing the data and name of the radar chart. E.g:</p>
<pre><code class="json">        &quot;chart&quot;: {
            &quot;radars&quot;: [
                {
                    &quot;data&quot;: [
                        {
                            &quot;x&quot;: &quot;Order 1&quot;,
                            &quot;y&quot;: 1240
                        },
                        {
                            &quot;x&quot;: &quot;Order 2&quot;,
                            &quot;y&quot;: 380
                        },
                        {
                            &quot;x&quot;: &quot;Order 3&quot;,
                            &quot;y&quot;: 840
                        },
                        {
                            &quot;x&quot;: &quot;Order 4&quot;,
                            &quot;y&quot;: 490
                        },
                        {
                            &quot;x&quot;: &quot;Order 5&quot;,
                            &quot;y&quot;: 1230
                        }
                    ],
                    &quot;name&quot;: &quot;radar 1&quot;
                }
            ],
            &quot;type&quot;: &quot;radar&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/radar.png" /></p>
<h3 id="61410-area">6.1.4.10 area</h3>
<p>This will produce an area chart. The chart object should then contain an array named areas with one element containing the data and name of the area chart. E.g:</p>
<pre><code class="json">    &quot;chart&quot;: {
        &quot;areas&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;
                    }
                ],
                &quot;name&quot;: &quot;area 1&quot;
            },
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;2.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;4.4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;1.8&quot;
                    }
                ],
                &quot;name&quot;: &quot;area 2&quot;
            }
        ],
        &quot;type&quot;: &quot;area&quot;
    }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/area.png" /></p>
<h3 id="61411-scatter">6.1.4.11 scatter</h3>
<p>This will produce an scatter chart. The chart object should then contain an array named scatters with one element containing the data and name of the scatter chart. Similar to previous charts however the x axis should contain only numbers.</p>
<h3 id="61413-bubble">6.1.4.13 bubble</h3>
<p>This will produce an bubble chart. The chart object should then contain an array named bubbles with one element containing the data and name of the bubble chart. It is similar to previous charts however, the data should can now contain size value to determine the size of a bubble. Example JSON:</p>
<pre><code class="JSON">{
    &quot;chart&quot;: {
        &quot;bubbles&quot;: [
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;4.3&quot;,
                        &quot;size&quot;:&quot;1&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;2.5&quot;,
                        &quot;size&quot;:&quot;3&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;3.5&quot;,
                        &quot;size&quot;:&quot;2&quot;
                    }
                ],
                &quot;name&quot;: &quot;Bubble series 1&quot;
            },
            {
                &quot;data&quot;: [
                    {
                        &quot;x&quot;: &quot;day 1&quot;,
                        &quot;y&quot;: &quot;2.4&quot;,
                        &quot;size&quot;:&quot;4&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 2&quot;,
                        &quot;y&quot;: &quot;4.4&quot;,
                        &quot;size&quot;:&quot;5&quot;
                    },
                    {
                        &quot;x&quot;: &quot;day 3&quot;,
                        &quot;y&quot;: &quot;1.8&quot;,
                        &quot;size&quot;:&quot;1&quot;
                    }
                ],
                &quot;name&quot;: &quot;Bubble series 2&quot;
            }
        ],
        &quot;type&quot;: &quot;bubble&quot;
    }
}
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/bubble.png" /></p>
<h3 id="61414-stock">6.1.4.14 stock</h3>
<p>This will produce an stock chart. The chart object should then contain an array named stocks with one element containing the data and name of the stock chart. Here instead of y value: volume, open, close, high and low value should be given. The format of the x axis can also be given.
The x axis contains the date starting using 1900 notation, i.e 1 will represent January 1 1900 <a href="https://support.office.com/en-us/article/Change-the-date-system-format-or-two-digit-year-interpretation-aaa2159b-4ae8-4651-8bce-d4707bc9fb9f">more info</a>.</p>
<p>Example:</p>
<pre><code class="JSON"> {
          &quot;chart&quot;: {
            &quot;stocks&quot;: [
              {
                &quot;data&quot;: [
                  {
                    &quot;x&quot;: &quot;1&quot;,
                    &quot;volume&quot;: &quot;70&quot;,
                    &quot;open&quot;: &quot;44&quot;,
                    &quot;high&quot;: &quot;55&quot;,
                    &quot;low&quot;: &quot;11&quot;,
                    &quot;close&quot;: &quot;25&quot;
                  },
                  {
                    &quot;x&quot;: &quot;2&quot;,
                    &quot;volume&quot;: &quot;120&quot;,
                    &quot;open&quot;: &quot;25&quot;,
                    &quot;high&quot;: &quot;57&quot;,
                    &quot;low&quot;: &quot;12&quot;,
                    &quot;close&quot;: &quot;38&quot;
                  },
                  {
                    &quot;x&quot;: &quot;3&quot;,
                    &quot;volume&quot;: &quot;150&quot;,
                    &quot;open&quot;: &quot;38&quot;,
                    &quot;high&quot;: &quot;57&quot;,
                    &quot;low&quot;: &quot;13&quot;,
                    &quot;close&quot;: &quot;50&quot;
                  },
                  {
                    &quot;x&quot;: &quot;4&quot;,
                    &quot;volume&quot;: &quot;135&quot;,
                    &quot;open&quot;: &quot;50&quot;,
                    &quot;high&quot;: &quot;58&quot;,
                    &quot;low&quot;: &quot;11&quot;,
                    &quot;close&quot;: &quot;35&quot;
                  },
                  {
                    &quot;x&quot;: &quot;5&quot;,
                    &quot;volume&quot;: &quot;148&quot;,
                    &quot;open&quot;: &quot;34&quot;,
                    &quot;high&quot;: &quot;58&quot;,
                    &quot;low&quot;: &quot;25&quot;,
                    &quot;close&quot;: &quot;43&quot;
                  }
                ],
                &quot;name&quot;: &quot;s&quot;
              }
            ],
            &quot;type&quot;: &quot;stock&quot;,
            &quot;options&quot;:{
              &quot;axis&quot;:{
                &quot;x&quot;:{
                  &quot;date&quot;:{
                    &quot;unit&quot;:&quot;days&quot;,
                    &quot;step&quot;:1,
                    &quot;code&quot;:&quot;dd&quot;
                  }
                }
              }
            }
          },
          &quot;name&quot;: &quot;Stocks&quot;
        }
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/stock.png" /></p>
<h3 id="61411-combining-charts">6.1.4.11 Combining Charts</h3>
<p>It is possible to combine multiple charts. For example a column and a line chart. If a second value axis is wished on the right side then the values should be given as y2 instead of y. The type should be "multiple" and the chart should contain a multiples array which contains the different charts defined previously. It is possible to combine more than 2 types of chart but there can only be two value axis. An example is given below:</p>
<pre><code class="json">    &quot;chart&quot;: {
        &quot;multiples&quot;: [
            {
                &quot;columns&quot;: [
                    {
                        &quot;data&quot;: [
                            {
                                &quot;x&quot;: &quot;day 1&quot;,
                                &quot;y&quot;: &quot;4.3&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 2&quot;,
                                &quot;y&quot;: &quot;2.5&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 3&quot;,
                                &quot;y&quot;: &quot;3.5&quot;
                            }
                        ],
                        &quot;name&quot;: &quot;bar 1&quot;
                    },
                    {
                        &quot;data&quot;: [
                            {
                                &quot;x&quot;: &quot;day 1&quot;,
                                &quot;y&quot;: &quot;2.4&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 2&quot;,
                                &quot;y&quot;: &quot;4.4&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 3&quot;,
                                &quot;y&quot;: &quot;1.8&quot;
                            }
                        ],
                        &quot;name&quot;: &quot;bar 2&quot;
                    }
                ],
                &quot;type&quot;: &quot;column&quot;
            },
            {
                &quot;lines&quot;: [
                    {
                        &quot;data&quot;: [
                            {
                                &quot;x&quot;: &quot;day 1&quot;,
                                &quot;y2&quot;: &quot;43&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 2&quot;,
                                &quot;y2&quot;: &quot;25&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 3&quot;,
                                &quot;y2&quot;: &quot;35&quot;
                            }
                        ],
                        &quot;name&quot;: &quot;line 1&quot;
                    },
                    {
                        &quot;data&quot;: [
                            {
                                &quot;x&quot;: &quot;day 1&quot;,
                                &quot;y2&quot;: &quot;24&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 2&quot;,
                                &quot;y2&quot;: &quot;44&quot;
                            },
                            {
                                &quot;x&quot;: &quot;day 3&quot;,
                                &quot;y2&quot;: &quot;18&quot;
                            }
                        ],
                        &quot;name&quot;: &quot;line 2&quot;
                    }
                ],
                &quot;type&quot;: &quot;line&quot;
            }
        ],
        &quot;options&quot;: {
            &quot;border&quot;: true,
            &quot;grid&quot;: true,
            &quot;height&quot;: 700,
            &quot;legend&quot;: {
                &quot;position&quot;: &quot;r&quot;,
                &quot;showLegend&quot;: true
            },
            &quot;title&quot;: false,
            &quot;width&quot;: 500
        },
        &quot;type&quot;: &quot;multiple&quot;
    }

</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/chartcombination.png" /></p>
<p>The following SQL can be used:</p>
<pre><code class="sql">select
    'file1' as &quot;filename&quot;,
    cursor(select  
             cursor(select
                      c.cust_first_name || ' ' || c.cust_last_name as &quot;customer&quot;,
                      c.cust_city                                  as &quot;city&quot;    ,
                      o.order_total                                as &quot;total&quot;   ,
                      o.order_timestamp                            as &quot;timestamp&quot;
                      from demo_customers c, demo_orders o
                     where c.customer_id = o.customer_id
                     order by c.cust_first_name || ' ' || c.cust_last_name
             ) as &quot;report&quot;,
             cursor(select
                      'multiple' as &quot;type&quot;,
                      'My Combo: Column with Line Chart' as &quot;name&quot;,   
                      cursor(select
                               576     as &quot;width&quot; ,
                               336     as &quot;height&quot;,
                               'Title' as &quot;title&quot; ,
                               'true'  as &quot;grid&quot;,
                               'true'  as &quot;border&quot;,
                               cursor(select
                                 'true' as &quot;showLegend&quot;,
                                 'r' as &quot;position&quot;
                                 from dual
                               ) as &quot;legend&quot;
                             from dual
                      ) as &quot;options&quot;,
                      cursor(select
                               tp as &quot;type&quot;,
                               cursor(select
                                 nm as &quot;name&quot;,
                                 cursor(select to_char(o.order_timestamp, 'MON RRRR') &quot;label&quot;, 
                                               to_char(o.order_timestamp, 'MON RRRR') &quot;x&quot;,
                                               sum (decode(p.category,nm,oi.quantity * oi.unit_price,0)) &quot;y&quot;
                                          from demo_product_info p, demo_order_items oi, demo_orders o
                                         where oi.product_id = p.product_id
                                           and o.order_id = oi.order_id
                                         group by to_char(o.order_timestamp, 'MON RRRR'), to_char(o.order_timestamp, 'RRRR MM')
                                         order by to_char(o.order_timestamp, 'RRRR MM')
                                 ) as &quot;data&quot;
                                 from (select 'Mens' nm from dual union all select 'Womens' nm from dual )
                                 where tp = 'column'
                               ) as &quot;columns&quot;,
                               cursor(select
                                 nm as &quot;name&quot;,
                                 cursor(select to_char(o.order_timestamp, 'MON RRRR') &quot;label&quot;, 
                                               to_char(o.order_timestamp, 'MON RRRR') &quot;x&quot;,
                                               sum (decode(p.category,nm,oi.quantity * oi.unit_price,0)) &quot;y&quot;
                                          from demo_product_info p, demo_order_items oi, demo_orders o
                                         where oi.product_id = p.product_id
                                           and o.order_id = oi.order_id
                                         group by to_char(o.order_timestamp, 'MON RRRR'), to_char(o.order_timestamp, 'RRRR MM')
                                         order by to_char(o.order_timestamp, 'RRRR MM')
                                 ) as &quot;data&quot;
                                 from (select 'Accessories' nm from dual)
                                 where tp = 'line'
                               ) as &quot;lines&quot;
                             from (select 'column' tp from dual   union all   select 'line' tp from dual)
                       ) as &quot;multiples&quot;
                     from dual
             ) as &quot;chart&quot;
           from dual
    ) as &quot;data&quot;
  from dual
  ```

### 6.1.5 D3 (Data Driven Documents) images

With Word/Excel/PowerPoint documents, it's possible to let AOP execute some JavaScript code to generate a D3 image.

Given the JSON file with following content:

```json
{
    ...
    &quot;files&quot;: [{
            &quot;filename&quot;: &quot;output&quot;,
            &quot;data&quot;: {
                &quot;test&quot;: &quot;CODE&quot;
            }
    }]
}
</code></pre>

<p>With as (JSON-encoded) code:</p>
<pre><code class="js">// Based on https://bl.ocks.org/mbostock/7f5f22524bd1d824dd53c535eda0187f
const d3 = require('d3');
const D3Node = require('d3-node')
const d3n = new D3Node()

const svg = d3n.createSVG(512, 512);
const [width, height] = [512, 512];
const margin = { top: 20, right: 30, bottom: 30, left: 40 };

var x = d3.scaleLog().domain([2e-1, 5e0])
  .rangeRound([margin.left, width - margin.right]);
var y = d3.scaleLog().domain([3e2, 2e4])
  .rangeRound([height - margin.bottom, margin.top]);
var color = d3.scaleSequential(d3.interpolateYlGnBu).domain([0, 1.8]); // Points per square pixel.

svg.append(&quot;g&quot;)
  .attr(&quot;transform&quot;, &quot;translate(0,&quot; + (height - margin.bottom) + &quot;)&quot;)
  .call(d3.axisBottom(x).ticks(null, &quot;.1f&quot;))
  .select(&quot;.tick:last-of-type text&quot;)
  .select(function () { return this.parentNode.appendChild(this.cloneNode()); })
  .attr(&quot;y&quot;, -3).attr(&quot;dy&quot;, null)
  .attr(&quot;font-weight&quot;, &quot;bold&quot;).text(&quot;Carats&quot;);

svg.append(&quot;g&quot;)
  .attr(&quot;transform&quot;, &quot;translate(&quot; + margin.left + &quot;,0)&quot;)
  .call(d3.axisLeft(y).ticks(null, &quot;.1s&quot;))
  .select(&quot;.tick:last-of-type text&quot;)
  .select(function () { return this.parentNode.appendChild(this.cloneNode()); })
  .attr(&quot;x&quot;, 3).attr(&quot;text-anchor&quot;, &quot;start&quot;)
  .attr(&quot;font-weight&quot;, &quot;bold&quot;).text(&quot;Price (USD)&quot;);

d3.tsv(&quot;https://bl.ocks.org/mbostock/raw/7f5f22524bd1d824dd53c535eda0187f/diamonds.tsv&quot;, d =&gt; ({ carat: +d.carat, price: +d.price }), (error, diamonds) =&gt; {
  if (error) throw error;
  if (diamonds[0] instanceof Error) throw diamonds[0];
  svg.insert(&quot;g&quot;, &quot;g&quot;).attr(&quot;fill&quot;, &quot;none&quot;)
    .attr(&quot;stroke&quot;, &quot;#000&quot;).attr(&quot;stroke-width&quot;, 0.5)
    .attr(&quot;stroke-linejoin&quot;, &quot;round&quot;).selectAll(&quot;path&quot;)
    .data(d3.contourDensity()
      .x(d =&gt; x(d.carat)).y(d =&gt; y(d.price))
      .size([width, height]).bandwidth(10)
      (diamonds))
    .enter().append(&quot;path&quot;)
    .attr(&quot;fill&quot;, d =&gt; color(d.value))
    .attr(&quot;d&quot;, d3.geoPath());
  finish(d3n);
});
</code></pre>

<p>And a Word document containing <code>{?d3 test}</code> would produce the following result:
<img alt=" " src="./media/d3radial.png" /></p>
<p>Should a field <code>"test_data": [1,2,3]</code> be present in the JSON (at the same place as <code>"test": "CODE"</code>), then the code will have access to the global <code>data</code> which would be <code>[1,2,3]</code>, or whatever <code>"test_data"</code> is. String, booleans, nunbers and objects are also possible.</p>
<h4 id="6151-code-structure">6.1.5.1 Code structure</h4>
<p>This is how the code is supposed to be organized:</p>
<pre><code class="js">// Import D3
const d3 = require('d3');
// Import D3-Node
const D3Node = require('d3-node');
// Instantiate a new D3Node, which will provide the SVG and will be required to finish
const d3n = new D3Node();
// Create a SVG (instead of selecting one from the (here non-existing) document)
const svg = d3n.createSVG(512, 512); // Different sizes are possible
// Start working on the SVG
svg.append('g').text('Test');
//  etc
// We can access the _data field if it was given:
svg.append('g').text(data ? data.toString() : 'No data passed!');
// When the SVG is finished, call the global finish() with the used D3Node object
finish(d3n);
// We can also call the global fail() (or throw an error) should something fail:
fail(new Error('We are missing something!'));
</code></pre>

<h4 id="6152-specifications-and-limitations">6.1.5.2 Specifications and limitations</h4>
<ul>
<li>The d3 library is version 4.12.0</li>
<li>d3-contour and d3-scale-chromatic (along with all default 4.12.0 submodules) are preloaded, e.g. <code>d3.contour()</code> is available</li>
<li>The code is run in an async environment, meaning <code>await</code> is available</li>
<li>The code has to either have a return statement with a D3Node object, or call finish() with one</li>
<li>After the code has succesfully finished, the SVG will be extracted from the D3Node, converted to PNG and pasted in the Word/Excel/...</li>
<li>ES2015, ES2016 and ES2017 are supported, run inside a Node environment</li>
<li>Only d3 libraries (including sub-libraries like d3-polygon) can be returned by require()</li>
<li>d3-request can only use http:// and https:// URLs</li>
<li>There are time limitations, e.g. the whole script will time out after 30s, even when it's still fetching data over HTTP(S)</li>
<li>All errors are caught and will cause the whole PrintJob to fail. The stacktrace will be shown</li>
</ul>
<h3 id="616-data95loop-data95loop-tags">6.1.6 {#data_loop} … {/data_loop} tags</h3>
<p>Using the opening tag <strong>{#data_loop}</strong> and closing tag <strong>{/data_loop}</strong>, we can loop inside the JSON array named "data_loop", meaning the items that are inside the tags will be repeated for each array element. Again like in image tag "data_loop" is a variable. A loop tag is represented by "#" after the curly bracket.</p>
<h4 id="6161-general-data-loop-example">6.1.6.1 General Data loop example</h4>
<p>Given the JSON file with following content:</p>
<pre><code class="json">    {
        ...
        &quot;files&quot;:[{
               &quot;filename&quot;           :&quot;output&quot;,
                &quot;data&quot;:[{
                       &quot;people&quot;:[{
                              &quot;first_name&quot; :&quot;DemoName1&quot;,
                              &quot;last_name&quot;  :&quot;DemoLastName1&quot;,
                              &quot;city&quot;       :&quot;DemoCity1&quot;},
                       {
                              &quot;first_name&quot; :&quot;DemoName2&quot;,
                              &quot;last_name&quot;  :&quot;DemoLastName2&quot;,
                              &quot;city&quot;       :&quot;DemoCity2&quot;},
                       {
                              &quot;first_name&quot; :&quot;DemoName3&quot;,
                              &quot;last_name&quot;  :&quot;DemoLastName3&quot;,
                              &quot;city&quot;       :&quot;DemoCity3&quot;}
                       ]
                }]
        }]
    }
</code></pre>

<p>and template.docx with following content:</p>
<p>The name of the employees are:
{#people}{first_name}{last_name} from city {city}.
{/people}</p>
<p>will result in:</p>
<p>The name of the employees are:
DemoName1 DemoLastName1 from City DemoCity1.
DemoName2 DemoLastName2 from City DemoCity2.
DemoName3 DemoLastName3 from City DemoCity3.</p>
<h4 id="6162-loops-in-table-example">6.1.6.2 Loops in table example</h4>
<p>Using the previous data, if the template is changed to:</p>
<p><img alt=" " src="./media/image41.png" /></p>
<p>the result will then be:</p>
<p><img alt=" " src="./media/image42.png" /></p>
<h4 id="6163-loops-with-numbering-example">6.1.6.3 Loops with numbering example</h4>
<p>Using the previous data, if the template is changed to:</p>
<p><img alt=" " src="./media/image43.png" /></p>
<p>the result will be:</p>
<p><img alt=" " src="./media/image44.png" /></p>
<h4 id="6164-loops-in-bullets">6.1.6.4 Loops in bullets</h4>
<p>The same can be done with bullets:</p>
<p><img alt=" " src="./media/image45.png" /></p>
<p>will result in:</p>
<p><img alt=" " src="./media/image46.png" /></p>
<h4 id="6165-math-operations-during-a-loop">6.1.6.5 Math operations during a loop</h4>
<p>Numeric operations inside a loop are supported by using the <code>|</code> operator. The following operations are supported: 
<em> <code>|sum</code>, calculates the total sum of a numeric property during a loop.
</em> <code>|avg</code>, calculates the total average of a numeric property during a loop.
<em> <code>|min</code>, returns the minimum numeric value of a property during a loop.
</em> <code>|max</code>, returns the maximum numeric value of a property during a loop.</p>
<p>The following template is given: </p>
<p><img alt="" src="./media/numeric_operations_loop_template.png" /></p>
<p>Results in: </p>
<p><img alt="" src="./media/numeric_operations_loop_result.png" /></p>
<h3 id="617-horizontal-tabular-looping">6.1.7 Horizontal Tabular Looping</h3>
<p>Since verion 18.1 AOP also supports horizontal tabular looping using the {:horizontal_loop} ... {/horizontal_loop} tags. However this tag can be used to repead only one row. Following is an example on how this could be used:
<img alt="" src="./media/dynamic_columns.gif" /></p>
<h3 id="618-simple-angular-like-expressions">6.1.8 Simple angular like expressions</h3>
<p>Simple angular like expressions are also supported that can perform simple mathematical operations.</p>
<p>A full list of Angular expression can be found at <a href="https://docs.angularjs.org/guide/expression">https://docs.angularjs.org/guide/expression</a>.</p>
<h4 id="6181-simple-expressions">6.1.8.1 Simple Expressions</h4>
<p>Expressions like <strong>{num1 + num2}</strong> will print the sum of num1 and num2.
Division, multiplication, addition and subtraction are allowed.</p>
<p>If the given key has a boolean value then you can use <strong>{#boolean key}…{/boolean key}</strong> to print the content inside tags if the value of boolean key is <em>true</em>. For negation <strong>{^boolean key}…{/boolean key}</strong> is used. The content inside these tags will be printed if the boolean key has <em>false</em> as value or if boolean key does not exists or if boolean key is an empty array.</p>
<h4 id="6182-stringnumber-comparison">6.1.8.2 String/Number Comparison</h4>
<p>You can also check the value of keys with <strong>{#key=='value'}…{/key=='value'}</strong>. The content inside the tags will be only printed if the value of the key is equal to "value". Note here in <strong>{#key=='value'}</strong>, that straight single quotes are used!</p>
<p>The numbers can also be compared in the same way as strings <strong>{#key&gt;;50}…{/key&gt;;50}</strong>.The content inside the tags will be only printed if the value of the key is greater than 50. The following operators are supported: &lt;, &gt;, &lt;=, &gt;=, ==, !=</p>
<h4 id="6183-conditional-and-comparison-operator">6.1.8.3 Conditional and Comparison operator</h4>
<p>Another way to compare variables is as follows: <strong>{key == 'value' ? key2 : key3}</strong>. This way other keys/variables can also be inserted. This will print out value of key2 if the expression is true and key3 if the expression is false.</p>
<p>Possible conditional operators are:</p>
<ul>
<li>Equal: == (equal to) or === (equal value and equal type)</li>
<li>Not Equal: != or !== (not equal value or not equal type)</li>
<li>And: &amp;&amp;</li>
<li>Or: ||</li>
<li>Greater than: &gt;</li>
<li>Less than: &lt;</li>
<li>Greater than or equal: &gt;=</li>
<li>Less than or equal: &lt;=</li>
</ul>
<h4 id="6184-conditional-example">6.1.8.4 Conditional example</h4>
<p>For the JSON given in example below {currency == 'EUR' ? '€'+price : price+'$'} prints €50 if true and 50$ if false and given price variable is 50.</p>
<p>Given the JSON file with following content:</p>
<pre><code class="json">    {
        ...
                 &quot;data&quot;:[{
                       &quot;product&quot;:[{
                              &quot;product_name&quot; :&quot;Business Shirt&quot;,
                              &quot;quantity&quot;     :3,
                              &quot;unit_price&quot;   :50,
                              &quot;onstock&quot;      :true,
                              &quot;cur&quot;          :&quot;EUR&quot;
                       },
                       {
                              &quot;product_name&quot; :&quot;Trousers&quot;,
                              &quot;quantity&quot;     :3,
                              &quot;unit_price&quot;   :80,
                              &quot;onstock&quot;      :false,
                              &quot;cur&quot;          :&quot;USD&quot;
                       },
                       {
                              &quot;product_name&quot; :&quot;Jacket&quot;,
                              &quot;quantity&quot;     :3,
                              &quot;unit_price&quot;   :15,
                              &quot;onstock&quot;      :true,
                              &quot;cur&quot;          :&quot;USD&quot;
                       },
                       {
                              &quot;product_name&quot; :&quot;Blouse&quot;,
                              &quot;quantity&quot;     :3,
                              &quot;unit_price&quot;   :60,
                              &quot;onstock&quot;      :false,
                              &quot;cur&quot;          :&quot;EUR&quot;
                       }]
                }]
    }
</code></pre>

<p>and template with following content:</p>
<p><img alt=" " src="./media/image48.png" /></p>
<p>will result in:</p>
<p><img alt=" " src="./media/image49.png" /></p>
<p>Angular expressions can also be used inside floating texts. Below an example where the images are put inside floating textbox and are shown under condition.</p>
<p><img alt=" " src="./media/angular_expression.gif" /></p>
<h3 id="619-labels-printing">6.1.9 Labels printing</h3>
<p><strong>AOP</strong> also provides a way to print the labels in word document. To do so you can create a document with labels from going to Mailings options and then to Labels. Fill in the tags in address field and choose the type of label by clicking in Label option. A document can then be generated by clicking New document.
Currently however if labels are getting printed then we expect the document only containing labels and no other information, and that the tag keys are not used more than once.
Given the JSON file:</p>
<pre><code class="json">    ...
        &quot;data&quot;: {
            &quot;labels&quot;: [
                {
                    &quot;city&quot;: &quot;city1&quot;,
                    &quot;first_name&quot;: &quot;firstname1&quot;,
                    &quot;last_name&quot;: &quot;lastname1&quot;,
                    &quot;title&quot;: &quot;Mr.&quot;,
                    &quot;tracking_number_text&quot;: &quot;TN49775377172&quot;,
                    &quot;tracking_number&quot;: &quot;TN49775377172&quot;,
                    &quot;tracking_number_type&quot;: &quot;code128&quot;,
                    &quot;zip_code&quot;: 6981
                },
                ...
                {
                    &quot;city&quot;: &quot;city12&quot;,
                    &quot;first_name&quot;: &quot;firstname12&quot;,
                    &quot;last_name&quot;: &quot;lastname12&quot;,
                    &quot;title&quot;: &quot;Mr.&quot;,
                    &quot;tracking_number_text&quot;: &quot;TN49709864775&quot;,
                    &quot;tracking_number&quot;: &quot;TN49709864775&quot;,
                    &quot;tracking_number_type&quot;: &quot;code128&quot;,
                    &quot;zip_code&quot;: 9740
                }
            ]
        }
    ...
</code></pre>

<p>and template:</p>
<p><img alt=" " src="./media/imageLabelTemplate.png" /></p>
<p>will produce:</p>
<p><img alt=" " src="./media/imageLabelOutput.png" /></p>
<p>Note that in the first cell you need to add the {labels} tag. See also the Sample app.</p>
<h3 id="6110-html-tag">6.1.10 HTML tag</h3>
<p>HTML tags can also be converted to Word. The tag that has to be used is <strong>{_key}</strong>, thus underscore followed by the key which has HTML content in JSON. The tags that are currently supported are:</p>
<pre><code>&lt;br /&gt;                     : in order to introduce breaks (newline)
&lt;p&gt; .. &lt;/p&gt;                : represents a paragraph
&lt;strong&gt; .. &lt;/strong&gt;      : bold text
&lt;b&gt; .. &lt;/b&gt;                : bold text
&lt;s&gt; .. &lt;/s&gt;                : strike through
&lt;u&gt; .. &lt;/u&gt;                : underline
&lt;em&gt; .. &lt;/em&gt;              : italics
&lt;h1&gt; .. &lt;/h1&gt;              : heading 1
&lt;h2&gt; .. &lt;/h2&gt;              : heading 2
&lt;h3&gt; .. &lt;/h3&gt;              : heading 3
&lt;h4&gt; .. &lt;/h4&gt;              : heading 4
&lt;h5&gt; .. &lt;/h5&gt;              : heading 5
&lt;h6&gt; .. &lt;/h6&gt;              : heading 6
&lt;sub&gt; .. &lt;/sub&gt;            : subscript
&lt;sup&gt; .. &lt;/sup&gt;            : superscript
&lt;ol&gt; .. &lt;/ol&gt;              : ordered list
&lt;ul&gt; .. &lt;/ul&gt;              : unordered list
&lt;li&gt; .. &lt;/li&gt;              : list item
&lt;table&gt; .. &lt;/table&gt;        : table (including th, tr, td)
&lt;caption&gt; .. &lt;/caption&gt;    : caption
&lt;img&gt;                      : image
&lt;pre&gt; .. &lt;/pre&gt;            : preformatted text

&lt;span style=".."&gt;..&lt;/span&gt; : text between the span will have the style defined, background-color, color, font-size and font-family are supported.
</code></pre>
<p>Eg:
Given the following key inside data:</p>
<pre><code class="json">    &quot;htmlcontent&quot;: &quot;&lt;p&gt;This is text coming from the database / session in HTML format.
    &lt;br /&gt;It supports:
    &lt;/p&gt;
    &lt;ol&gt;
    &lt;li&gt;Lists&lt;/li&gt;
    &lt;li&gt;&lt;strong&gt;Bold&lt;/strong&gt;&lt;/li&gt;
    &lt;li&gt;&lt;em&gt;Italic&lt;/em&gt;&lt;/li&gt;
    &lt;li&gt;&lt;u&gt;Underline&lt;/u&gt;&lt;/li&gt;
    &lt;li&gt;&lt;s&gt;Strikethrough&lt;/s&gt;&lt;/li&gt;
    &lt;li&gt;Sub&lt;sub&gt;script&lt;/sub&gt;&lt;/li&gt;
    &lt;li&gt;&lt;sup&gt;Super&lt;/sup&gt;script&lt;/li&gt;
    &lt;li&gt;&lt;span style=&quot;color:#FF0000&quot;&gt;Text Color&lt;/span&gt;&lt;/li&gt;
    &lt;li&gt;&lt;span style=&quot;background-color:#FFFF00&quot;&gt;Background Text Color&lt;/span&gt;
    &lt;/li&gt;
    &lt;/ol&gt;

    &lt;h1&gt;Heading 1&lt;/h1&gt;
    &lt;h2&gt;Heading 2&lt;/h2&gt;
    &lt;h3&gt;Heading 3&lt;/h3&gt;
    &lt;h4&gt;Heading 4&lt;/h4&gt;
    &lt;p&gt;Normalt text with&lt;span style=&quot;font-family:comic sans ms,cursive&quot;&gt; Font Change&lt;/span&gt;&lt;/p&gt;
    &lt;p&gt;&lt;span style=&quot;font-family:courier new,courier,monospace&quot;&gt;Code font&lt;/span&gt;
    &lt;/p&gt;&quot;
</code></pre>

<p>and the template:</p>
<p><img alt=" " src="./media/imageHTML2WordTemplate.png" /></p>
<p>will produce:</p>
<p><img alt=" " src="./media/imageHTML2Word.png" /></p>
<h3 id="6111-interactive-report-ir-tag">6.1.11 Interactive Report (IR) tag</h3>
<p>{&amp;interactive} will be replaced in the given template by the interactive report that has been selected in APEX.
Other than the simple interactive report, there are three other options that can be selected: Control Break, Group By, Pivot. Those will be illustrated below.
Keep in mind that the tag that gets replaced is {&amp;interactive}, no matter which of the above options is selected in APEX.
For a concrete example, see section 11.</p>
<p><strong>Control Break:</strong>
By clicking on Actions and selecting Control Break, one or more columns can be selected on which the table should be broken. For the purpose of illustration, assume we select Quantity.</p>
<p><img alt=" " src="./media/breakAPEX.png" /></p>
<p>This splits the table up into partitions based on the value of the selected column. Thus rows sharing the same value for Quantity, will be grouped together into the same partition.
The resulting table can be seen below:</p>
<p><img alt=" " src="./media/breakResult.png" /></p>
<p>As a final note, this option also supports the application of aggregates on the table data.</p>
<p><strong>Group By:</strong>
By clicking on Actions and selecting Group By, one or more columns can be selected on which the table data should be grouped by. For the purpose of illustration, assume we select Quantity. Furthermore, one or more functions can be applied on the table data. In this example, we request the sum of the unit price for every group.</p>
<p><img alt=" " src="./media/grpByQuantity.png" /></p>
<p>The result is a new table with one column for every selected column on which the data should be grouped by, and one column for every selected function to be applied on the group data.</p>
<p>The resulting table can be seen below:</p>
<p><img alt=" " src="./media/grpByResult.png" /></p>
<p>Additionally, a custom label and format may be selected for each function column and a sum can be performed over the values of each function column.</p>
<p><strong>Pivot:</strong>
By clicking on Actions and selecting Pivot, the user is prompted to select at least one pivot column, at least one row column and at least one function over a particular column.
Important to note is that the row column, pivot column and function column need to be different.
For the sake of the example, we select Quantity as a pivot column, Product Name as a row column and sum over Unit Price as a function.</p>
<p><img alt=" " src="./media/pivotAPEX.png" /></p>
<p>The resulting table can be seen below:</p>
<p><img alt=" " src="./media/pivotRESULT.png" /></p>
<p>The additional options supported in this case are the same as the ones in Group By.</p>
<p><strong>Chart:</strong>
AOP can also print your Interactive Report Chart view directly in your template by using {\$interactive}.</p>
<p><img alt=" " src="./media/ir_chart.png" /></p>
<p>The result in Powerpoint can be seen below:</p>
<p><img alt=" " src="./media/ir_chart_result.png" /></p>
<p>Note that this is a native Powerpoint chart, so you can adapt, make bigger, change colors, etc. directly in Powerpoint.</p>
<h3 id="6112-multiple-interactive-reports-in-one-template">6.1.12 Multiple Interactive Reports in one template</h3>
<p>In this case, the template needs to have tags of the form {&amp;interactive_1},{&amp;interactive_2} and these tags will be replaced by the corresponding interactive reports. Many interactive reports can be selected by giving in their static IDs in a particular order (ir1,ir2,...) and it is in that order that their data will be inserted in the template. Thus, {&amp;interactive_1} gets replaced by the data in the first interactive report (static Id: ir1) and similarly for {&amp;interactive_2} that will get replaced by the data in the second interactive report (static Id: ir2) and so on.</p>
<p><img alt=" " src="./media/multipleIR.png" /></p>
<p>The result can be seen below:</p>
<p><img alt=" " src="./media/multipleIRResult.png" /></p>
<h3 id="6113-table-cell-background">6.1.13 Table cell background</h3>
<p>You can give a background to a cell in a table in Word by using the column followed by _cell_background_color. The tag in the template should end with a $.</p>
<pre><code class="json"> cursor(select p.product_name as &quot;product_name&quot;,
                              i.quantity as &quot;quantity&quot;,
                              case
                              when i.quantity between 1 and 2 then '#00FF00'
                              when i.quantity between 2 and 3 then '#00FF00'
                              else '#0000FF'
                              end as &quot;quantity_cell_background_color&quot;,
                              i.unit_price as &quot;unit_price&quot;
                         from demo_order_items i, demo_product_info p
                        where o.order_id = i.order_id
                          and i.product_id = p.product_id
                      ) &quot;backcolor&quot;
</code></pre>

<h3 id="6114-right-to-left-tag">6.1.14 Right to Left tag</h3>
<p>In word when substituting the content in language written in right to left like arabic, the {&lt;rightToLeft} tag can be used to properly format the language. If the susbstuting content does not contain any right to left language character then it will behave as normal substitution tag.</p>
<h3 id="6115-footnote-tag">6.1.15 Footnote tag</h3>
<p>A footnote tag can be used to insert footnote. The tag should start with "+" symbol. For example given the following template:</p>
<p><img alt=" " src="./media/footnote_template.png" /></p>
<p>and the data as follows:</p>
<pre><code class="json">{
    &quot;quote&quot;:&quot;Only I can change my life. No one can do it for me.&quot;,
    &quot;person&quot;:&quot;Carol Burnett&quot;
}
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/footnote_result.png" /></p>
<h3 id="6116-hyperlink-tag">6.1.16 Hyperlink tag</h3>
<p>Since AOP3.3 hyperlink feature is added using a tag that start  with a * like: {*tag}. Given the template:</p>
<p><img alt=" " src="./media/hyperlink_template.png" /></p>
<p>And the data:</p>
<pre><code class="json">{
  &quot;name&quot;: &quot;Support&quot;,
  &quot;company_url&quot;: &quot;https://www.apexofficeprint.com&quot;,
  &quot;company_url_text&quot;: &quot;APEX RND&quot;,
  &quot;mail&quot;: &quot;support@apexofficeprint.com&quot;
}
</code></pre>

<p>will result in:</p>
<p><img alt=" " src="./media/hyperlink_result.png" /></p>
<p>The mail hyperlinks are automatically detected and mailto: will be appended for the link to work. The hyperlink text can be given by giving extra data that ends with _text. e.g: {*tag_text}. (see json above).</p>
<p>This hyperlink will also work when output pdf is wished.</p>
<p>Please note that in Excel the hyperlink will be added but the style will remain normal. You can change the tag style in template if another styling is wished. In Word your defalt hyperlink styling will be taken. If you wish another styling, you can change the style of the tag and add tag_preserve_tag_style:true options in the data.</p>
<h3 id="6117-table-of-content">6.1.17 Table Of Content</h3>
<p>AOP versions greater than 3.5, also support generation of table of content in Word. Placing the {~} tag will generate table of content at the place where this tag is used. </p>
<h3 id="6118-word-subtemplating">6.1.18 Word Subtemplating</h3>
<p>Inside Word documents, the tag <code>{?include NAME}</code> is available.</p>
<p>Given the following JSON:</p>
<pre><code class="json">{
    ...
    &quot;template&quot;: {
        &quot;filename&quot;: &quot;Template&quot;,
        &quot;file&quot;: &quot;UEsDBBAQBgQ...&quot;,
        &quot;template_type&quot;: &quot;docx&quot;
    },
    &quot;templates&quot;: [
        {
            &quot;name&quot;: &quot;Subtemplate1&quot;,
            &quot;mime_type&quot;: &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;,
            &quot;file_source&quot;: &quot;base64&quot;,
            &quot;file_content&quot;: &quot;UEsDBBAQBgAIAA...&quot;
        }
    ]
}
</code></pre>

<p>with the template containing <code>{?include Subtemplate1}</code> would replace the tag with the contents of the subtemplate.</p>
<p>This tag can be used inside loops, and tags inside the subtemplate will also be replaced.</p>
<p>For example:</p>
<pre><code class="text">{#products}
Product {name}
    {?include Subtemplate1}
{/products}
</code></pre>

<p>Should the subtemplate just consist of the content <code>Amount: {amount}</code>, then this could be an example result:</p>
<pre><code class="text">Product Product1
    Amount: 5
Product Product2
    Amount: 36
</code></pre>

<p>This tag is currently only available inside Word templates, and the subtemplates currently can only be Word documents (templates) too.</p>
<h2 id="62-powerpoint-pptx-template">6.2 Powerpoint (pptx) template</h2>
<p>For pptx template files same tags are supported as in docx template.
Attention should be paid when using <strong>"#"</strong>, <strong>"%"</strong>, <strong>"\$"</strong>  and <strong>"\^"</strong> tags, namely they should be on their own text field. The position of the text field will determine where the top left of the chart and image will start. Repeating a template slide is done by specifying which array should be looped with <strong>"!"</strong> tag after the curly bracket for example <strong>{!products}</strong> to repeat over product array. If none is declared the root object is taken as array. Multiple <strong>"!"</strong> tags are not allowed in one slide.</p>
<p>Given the JSON file with following content:</p>
<pre><code class="json">    {
        &quot;template&quot;: {
            &quot;template_type&quot;: &quot;pptx&quot;,
            &quot;filename&quot;: &quot;demo.pptx&quot;
        },
        &quot;output&quot;: {
            &quot;output_encoding&quot;: &quot;raw&quot;,
            &quot;output_type&quot;: &quot;pptx&quot;
        },
        &quot;files&quot;: [
            {
                &quot;filename&quot;: &quot;output&quot;,
                &quot;data&quot;: [
                    {
                        &quot;slide_title&quot;: &quot;Slides Per Product&quot;,
                        &quot;company_name&quot;: &quot;Company A&quot;,
                        &quot;product&quot;: [
                            {
                                &quot;product_name&quot;: &quot;Business Shirt&quot;,
                                &quot;quantity&quot;: 3,
                                &quot;unit_price&quot;: 50
                            },
                            {
                                &quot;product_name&quot;: &quot;Trousers&quot;,
                                &quot;quantity&quot;: 3,
                                &quot;unit_price&quot;: 80
                            },
                            {
                                &quot;product_name&quot;: &quot;Jacket&quot;,
                                &quot;quantity&quot;: 3,
                                &quot;unit_price&quot;: 15
                            },
                            {
                                &quot;product_name&quot;: &quot;Blouse&quot;,
                                &quot;quantity&quot;: 3,
                                &quot;unit_price&quot;: 60
                            }
                        ]
                    }
                ]
            }
        ]
    }
</code></pre>

<p>and the pptx template as follows:</p>
<p><img alt=" " src="./media/image51.png" />
<img alt=" " src="./media/image52.png" /></p>
<p>will result the following for the first slide:</p>
<p><img alt=" " src="./media/image53.png" /></p>
<p>Since there is only one item in root JSON object this is repeated only once. In template slide 2 we have specified product array as our loop array with {!product} tag. Since there are 4 objects in our product array this template will be repeated four times. The result is as follows:</p>
<p><img alt=" " src="./media/image54.png" />
<img alt=" " src="./media/image55.png" />
<img alt=" " src="./media/image56.png" />
<img alt=" " src="./media/image57.png" /></p>
<h2 id="63-excel-xlsx-template">6.3 Excel (xlsx) template</h2>
<p>In the xslx templates, some of the same tags as the previous types of templates can be used, as shown in the overview table at the start of this section. The JSON format should contain the same meta information elements (e.g. template_type, filename, …) and the data information is stocked under <strong>files/data</strong>.</p>
<p>Regular tags can be used with corresponding keyword in the JSON file between brackets, like in the docx and pptx templates. The xlsx templates can loop over elements in a list by using the same technique as in the docx template: {#loop_element} to enter the loop and {/loop_element} to close it. The cells that are in the rectangle bounded by these two tags will be looped over and filled in using the data available in the JSON file. Nested loops are possible (however keep in mind to remain within the rectangle formed by the "parent" loop – see note after example below). Style will be copied from the template to the generated file accordingly. As with the docx templates, simple angular expressions can be used to perform mathematical operations.</p>
<p><em>Xlsx example:</em></p>
<p>Given the JSON file with following content:</p>
<pre><code class="json">    {
        &quot;template&quot;: {
        &quot;template_type&quot;: &quot;xlsx&quot;,
        &quot;filename&quot;: &quot;simple.xlsx&quot;
        },
        &quot;output&quot;: {
        &quot;output_encoding&quot;: &quot;raw&quot;,
        &quot;output_type&quot;: &quot;xlsx&quot;
        },
        &quot;files&quot;: [
        {
            &quot;filename&quot;: &quot;file1&quot;,
            &quot;data&quot;: [
                {
                    &quot;cust_first_name&quot;: &quot;Albert&quot;,
                    &quot;cust_last_name&quot;: &quot;Lambert&quot;,
                    &quot;cust_city&quot;: &quot;St. Louis&quot;,
                    &quot;orders&quot;: [
                        {
                            &quot;order_total&quot;: 310,
                            &quot;order_name&quot;: &quot;Casual Shop's Order&quot;,
                            &quot;product&quot;: [
                                {
                                    &quot;product_name&quot;: &quot;Shirt&quot;,
                                    &quot;quantity&quot;: 3,
                                    &quot;unit_price&quot;: 50
                                },
                                {
                                    &quot;product_name&quot;: &quot;Trousers&quot;,
                                    &quot;quantity&quot;: 2,
                                    &quot;unit_price&quot;: 80
                                }]
                        },
                        {
                            &quot;order_total&quot;: 200,
                            &quot;order_name&quot;: &quot;Sport Shop's order&quot;,
                            &quot;product&quot;: [
                                {
                                    &quot;product_name&quot;: &quot;Sport's shoes&quot;,
                                    &quot;quantity&quot;: 2,
                                    &quot;unit_price&quot;: 100
                                }]
                        }]
                }]
        }]
    }
</code></pre>

<p>and the xlsx template as follows:</p>
<p><img alt=" " src="./media/image58b.png" /></p>
<p><span class="warning" style="color:red"><em>Note: in the example above the {/orders} closing tag must be in the last column. Otherwise the child loops inside {#orders}…{/orders}, in this case {#product}…{/product}, would not be able to generate inside the rectangle formed between the tags of its parent loop ({#orders}…{/orders}).</em></span></p>
<p><strong>Interactive Report in Excel:</strong>
As of version 2.2, all of the functionalities supported in Word regarding the interactive report are also supported in Excel.
For the purpose of illustration, let's take this template as input:</p>
<p><img alt=" " src="./media/xlsxIRbefore.png" /></p>
<p>The resulting output is then:</p>
<p><img alt=" " src="./media/xlsxIRafter.png" /></p>
<p>AOP 3.0 and above also supports cell settings from JSON by using _ for your tag.
For example when you have a column "tag", if you use "tag_font_color" : "#1782A6" it will set the Font color.
When using "tag_cell_background":"#1DF248" you set the background color, when using "text_wrap":"y" will set if text is wrapped etc. A full list of features can be found in the Sample App for APEX 5.1.
With AOP 3.3 and above you can also generate sheets automatically by using {!tag} in A1 field.</p>
<h2 id="64-qrcode-image-replacing">6.4 QRCode Image Replacing</h2>
<p>AOP also allows you replace a QRcode image with another image. The qr code can contain the image tags and barcode tags, i.e {%key} or {|key}. This method can be used if you are inserting a floating image, or need to have certain border styles on the image. The tag replacing will work as look as there are no artistic effects used for the image themselves. </p>
<p>Please note that the scope always starts at the default place, so the {#loop} tags have no effect. </p>
<p><img alt="example of image replacing" src="./media/img2img.gif" /></p>
<h2 id="65-converter">6.5 Converter</h2>
<p><strong>This feature only works when the output_type is pdf</strong></p>
<p>AOP has the ability to convert several types of files and/or append/prepend them to the outputted files.</p>
<h3 id="651-appendingprepending-files">6.5.1 Appending/prepending files</h3>
<p>All append/prepend files will first be converted to PDF, after which the pages (as a whole) will be prepended/appended to the outputted files. E.g. images will appear on their own page, <strong>not</strong> "pasted" into the template file.</p>
<h4 id="6511-general-structure">6.5.1.1 General structure</h4>
<p>The JSON sent to AOP will have this structure:</p>
<pre><code class="json">{
    ...
    &quot;template&quot;: { ... },
    &quot;output&quot;: {
        &quot;output_encoding&quot;: &quot;base64&quot;,
        &quot;output_type&quot;: &quot;pdf&quot; // Converter functionality only works with PDF as output_type
    },
    &quot;files&quot;: [
        {
            &quot;data&quot;: { ... },
            &quot;filename&quot;: &quot;File1&quot;
        },
        {
            &quot;data&quot;: { ... },
            &quot;filename&quot;: &quot;File2&quot;
        },
        ...
    ],
    &quot;prepend_files&quot;: [
        // Array of prepend files (see 6.5.1.2 File Structure)
        { ... },
        { ... },
        ...
    ],
    &quot;append_files&quot;: [
        // Array of prepend files (see 6.5.1.2 File Structure)
        { ... },
        { ... },
        ...
    ]
}
</code></pre>

<h4 id="6512-file-structure">6.5.1.2 File structure</h4>
<pre><code class="json">{
    &quot;filename&quot;: &quot;Filename&quot;,
    &quot;mine_type&quot;: &quot;MIME TYPE&quot;,
    // File source can be &quot;plain&quot;, &quot;base64&quot;, &quot;url&quot; or &quot;file&quot;,
    &quot;file_source&quot;: &quot;FILE SOURCE&quot;,
    // Used by &quot;file_source&quot;: &quot;plain&quot; and &quot;base64&quot;,
    &quot;file_content&quot;: &quot;...&quot;,
    // Used by &quot;file_source&quot;: &quot;url&quot;,
    &quot;file_url&quot;: &quot;http://...&quot;,
}
</code></pre>

<h4 id="6513-multiple-files">6.5.1.3 Multiple files</h4>
<p>Should the JSON contain multiple files, e.g. like this:</p>
<pre><code class="json">{
    ...
    &quot;files&quot;: [
        {
            &quot;data&quot;: { ... },
            &quot;filename&quot;: &quot;File1&quot;
        },
        {
            &quot;data&quot;: { ... },
            &quot;filename&quot;: &quot;File2&quot;
        },
        ...
    ],
}
</code></pre>

<p>Then, as might be expected, a zip archive will be returned containing File1.pdf and File2.pdf.
The append/prepend files will be appended/prepended to <em>each</em> file.</p>
<h3 id="652-converting-without-template">6.5.2 Converting without template</h3>
<p>AOP allows converting files without a template, resulting in the append/prepend files being converted and stitched together.</p>
<h4 id="6521-general-structure">6.5.2.1 General structure</h4>
<p>The JSON sent to AOP will have this structure:</p>
<pre><code class="json">{
    ...
    &quot;template&quot;: {
        // This template_type is template-less
        &quot;template_type&quot;: &quot;converter&quot;
    },
    &quot;output&quot;: {
        &quot;output_encoding&quot;: &quot;base64&quot;,
        &quot;output_type&quot;: &quot;pdf&quot; // Converter functionality only works with PDF as output_type
    },
    // If the files array is empty, it'll default to a file with filename &quot;Converted&quot;
    // Giving (multiple) files will just result in a zip archive with identical files, but with the given names
    &quot;files&quot;: [],
    &quot;prepend_files&quot;: [
        // Array of prepend files (see 6.5.1.2 File Structure)
        { ... },
        { ... },
        ...
    ],
    &quot;append_files&quot;: [
        // Array of prepend files (see 6.5.1.2 File Structure)
        { ... },
        { ... },
        ...
    ]
}
</code></pre>

<p>Should <code>"files"</code> be empty or only contain one file, and <code>"append_files"</code> or <code>"prepend_files"</code> only contain one file, then the output file will just be that append/prepend file converted to PDF.</p>
<h3 id="653-supported-mime-types-for-convertingappendingprepending">6.5.3 Supported mime types for converting/appending/prepending</h3>
<ul>
<li>PDF <code>application/pdf</code></li>
<li>Text <code>text/plain</code></li>
<li>Markdown <code>text/markdown</code></li>
<li>HTML <code>text/html</code></li>
<li>Word <code>application/vnd.openxmlformats-officedocument.wordprocessingml.document</code></li>
<li>Excel <code>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code></li>
<li>Powerpoint <code>application/vnd.openxmlformats-officedocument.presentationml.presentation</code></li>
<li>JPEG <code>image/jpeg</code></li>
<li>PNG <code>image/png</code></li>
<li>GIF <code>image/gif</code></li>
<li>BMP <code>image/bmp</code></li>
<li>MS-BMP <code>image/x-ms-bmp</code></li>
</ul>
<p><em><em>Mind that tags in append/prepend files will </em>not</em> be parsed! Append/prepend files are only converted and appended/prepended to the output files.</p>
<h1 id="7-sql-structure">7 SQL Structure</h1>
<h2 id="71-how-to-write-sql-queries-and-map-them-to-template-documents">7.1 How to write SQL queries and map them to template documents</h2>
<p>Please refer to the image below containing SQL query and matching template.</p>
<p>AOP Plug-in supports PL/SQL cursor expressions which can be used in your templates as "data loops".</p>
<p>Left side corresponds to the SQL query that we used in our demo example. Right side is our Word template.</p>
<p>In SQL query you will <strong>notice three inner cursors called data, orders and product.</strong></p>
<p>Idea is for each customer to find orders and products and display it as an invoice letter.</p>
<p>Data cursor is a standard part of AOP JSON structure and it needs to be present in all SQL queries. At the same time you do not have to specify it as a loop in your template. For more details about this please reference Section 9 of this Manual.</p>
<p>Other two cursor names can be of your preference as long as they are reflected in your template.</p>
<p><strong>Why do we have cursor syntax? </strong></p>
<p>This is the way AOP engine merges your data with your templates.</p>
<p>In our template example you want to display customer details (Data cursor) and then display all their orders (Orders cursor) with products (Product cursor) so each represents a separate cursor.</p>
<p>This means that we want to be able to create a loop for orders and a separate loop for products. This is exactly what we have done in this template.</p>
<p>The way AOP template loop works is by using {#loop element}….{/loop element} notation. In the template notice that we are using the following:</p>
<pre><code>"Thank you for shopping at. We have following products reserved for you:

{#orders}{#product}
    - {product_name}{/product}
The total amount of your order is €{order_total}.
{/orders}"
</code></pre>
<p>First open <em>Orders</em> loop then open <em>Product</em> loop then doing a bullet numbering for all products. Before closing the <em>Product</em> loop and then closing the <em>Orders</em> loop.</p>
<p>Once you create your SQL query it is very easy to implement it in your template following few simple tagging rules depending on a template type you are creating.</p>
<p><img alt=" " src="./media/image62.png" /></p>
<h1 id="8-server-only-on-premise">8 Server (only On-Premise)</h1>
<h2 id="81-installation">8.1 Installation</h2>
<p>APEX Office Print is using an external converter. By default LibreOffice is used (available on all platforms), but this can be changed to MS Office (Windows only). One of these products must be installed on the same server where you will also install APEX Office Print.</p>
<p>You can register and then login at <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a>. Go to Downloads and download On Premise package for your platform. Currently we support Linux,  Windows and OSX.</p>
<p><img alt=" " src="./media/aop_on_premise_download.png" /></p>
<p>Unzip the downloaded file, you will see a directory with the version downloaded version number of AOP e.g v18.1/</p>
<p>Go to the version directory/server directory and copy executable file on the server where you want AOP running in a directory of your choice</p>
<p>Executable files:</p>
<ul>
<li>OSX: APEXOfficePrintOSX64</li>
<li>Linux (Redhat): APEXOfficePrintLinux64</li>
<li>Windows: APEXOfficePrintWin64</li>
</ul>
<p>Decide on which port you want to let AOP run. By default it is using port 8010. You can change that later (for example APEXOfficePrintLinux64 -p 5555).</p>
<pre><code>If you want to run the On-Premise Trial version of AOP you can skip the activation step.
The on-premise version of AOP in Trial mode will work with Word and PDF, but it contains a trial watermark.
The cloud version of AOP (free 100 days) has no limitations.
</code></pre>
<p><strong>Following step is only necessary when you bought AOP</strong>, it's not necessary to run in Trial mode (Linux example):</p>
<ul>
<li>run ./APEXOfficePrintLinux64 -a</li>
<li>this will activate the software</li>
<li>you have to enter the email you registered with and it will try to generate the license key. License key will be generated if you have an open connection to the internet. If there’s no internet connection, or something goes wrong with the activation, you can contact support@apexofficeprint.com and send us your MAC address of the server you want to install it on. We’ll send you the license file per email.</li>
<li>exit AOP</li>
</ul>
<p>To start APEX Office Print:</p>
<ul>
<li>run ./APEXOfficePrintLinux64 &amp;</li>
<li>or if you want it on a different port ./APEXOfficePrintLinux64 -p 8012 &amp; ( on Linux using &amp; at the end of the command, will run this command in backround)</li>
</ul>
<p><strong>PDF</strong> converter options:</p>
<p>LibreOffice can be downloaded from <a href="https://www.libreoffice.org">https://www.libreoffice.org</a>. Make sure you download LibreOffice 5 or higher and no older version of LibreOffice is installed. Once the installation of LibreOffice is complete check if you can run <strong>soffice --version</strong> in a terminal.</p>
<p>You should see something like:</p>
<p><strong>LibreOffice 5.4.4.2 22b09f6418e8c2d508a9eaf86b2399209b0990f4</strong></p>
<p>If that fails make sure your environment variable PATH contains the directory of LibreOffice (bin directory). You can also create a symbolic link to soffice e.g.</p>
<pre><code>ln -s /opt/libreoffice5.4/program/soffice /usr/sbin/soffice
</code></pre>
<p>If you're on Windows, you can choose for LibreOffice or MS Office. In case you want to use MS Office, make sure you have MS Office 2003 or higher installed and also install <a href="https://www.cognidox.com/officetopdf-converter/">OfficetoPDF</a> (direct <a href="https://github.com/cognidox/OfficeToPDF/releases">download</a>), which allows to run conversions from the command line. <i>Note: Place the OfficetoPDF executable in the same folder than AOP.</i></p>
<p>After installing LibreOffice or MS Office, restart AOP.</p>
<p>From version 18.1 onwards, it is possible to specify other converters. On the first run of APEXOfficePrint a aop_config.json file is created. Below an example:</p>
<pre><code class="json">{
    &quot;converters&quot;: {
        &quot;abiword&quot;:{
            &quot;command&quot;: &quot;abiword --to={outputFormat} --to-name={outputFile} {inputFile}&quot;,
            &quot;handlesParallel&quot;: false
        },
        &quot;custom2&quot;:{
        }
    }
}
</code></pre>

<p>This allows for the users to use the converter of their choice. In the command section the following tags will be replaced:</p>
<pre><code>{outputFormat}: will be replaced by the output format needed. e.g: pdf 
{outputFile}: the location and filename of the expected output. (includes output extension and is absolute path),
{inputFile}: the location where the file for the conversion is located. (includes inputformat extenstion and is absolute path)
{inputFormat}: the intput format of the input file. e.g. docx
</code></pre>

<p>The other option handlesParallel should be true if the specified custom converter is capable of handling multile pdf conversions at the same time.
If a custom converter is used and the specified converter cannot handle parallel conversion, then the conversions are placed in a queue and called on first come first serve basis (even when multiple instances of AOP are running).</p>
<p><strong>Barcode</strong> option:</p>
<p>Before AOP 3.1 an external tool needed to be installed to be able to generate barcodes, but since AOP 3.1 and above that is not necessary anymore. All the necessary components are within AOP itself.</p>
<p><strong>Testing</strong> the connection to AOP:</p>
<p>Make sure the database server can connect to the port where AOP is running. If not, open the port so the database server can connect to the webserver:port (note you don't need to open it up to everybody, just the database server is fine)</p>
<p>For example by running curl webserver:port (curl can be downloaded for free for windows via <a href="https://curl.haxx.se/download.html#Win64">https://curl.haxx.se/download.html#Win64</a>)</p>
<p><strong>$ curl 127.0.0.1:8010</strong></p>
<p>The installation on the server part is now complete.</p>
<p>In the downloaded zip file there is also a sample application (app directory) that can be imported or you can just import the AOP plug-in (plugin directory) into your application. The only configuration there is to define the webserver:port where AOP is running and which converter you are using (LibreOffice, MS Office). You can do that under Shared Components &gt; Component Settings. Then select APEX Office Print (AOP) Plug-in, change AOP URL and select appropriate converter.</p>
<h2 id="82-configuration">8.2 Configuration</h2>
<p>Following parameters can be used:</p>
<p>-p or --port can set a different port the server should be running at</p>
<p>Example: to run AOP on port 8015 run:</p>
<p>APEXOfficePrintLinux64 –p 8015 (or ./APEXOfficePrintLinux64 –p 8015)</p>
<h2 id="83-unlock-trial-version">8.3 Unlock Trial version</h2>
<p>By default AOP will run in TRIAL version.</p>
<p>Only Word templates can be created in the TRIAL version of AOP. Once you have decided on a license level, the product can be activated by running -a or --activate:</p>
<p>\$ APEXOfficePrintLinux64 –a</p>
<p>It will prompt for an email. Please use the same email you used when you subscribed for a license on <a href="https://www.apexofficeprint.com/">https://www.apexofficeprint.com/</a></p>
<p>When running AOP again, it will show the new licensed templates you can use.</p>
<p>If there’s no internet connection, or something goes wrong with the activation, you can contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a> and send us your MAC address of the server you want to install it on. We’ll send you the license file per email. Add that file in the same directory of AOP and restart AOP to get the full version.</p>
<p>To obtain the MAC address you can use following commands:</p>
<ul>
<li>Windows: ipconfig /all (or nbtstat –a &lt;ip address&gt;)</li>
<li>Linux: ifconfig | grep HWaddr</li>
<li>OSX: networksetup -listallhardwareports</li>
</ul>
<h2 id="84-server-options">8.4 Server Options</h2>
<p>To view all available option, run ./APEXOfficePrintLinux64 -h</p>
<pre><code>Following parameters can be used:                                               
    -a or --activate         : Activate the software                                
    -h or --help             : Show this menu                                       
    -p or --port             : For giving in the running port default: 8010         
                                Example: APEXOfficePrint -p 5555                     
    -s or --startat          : Directory to start at.                               
    --license                : The location of license file.                        
                                Default looks at the startup directory               
    --silent                 : Do everything quietly even start message             
    -v or --version          : Show the current version of AOP                      
    --verbose                : Log what AOP is currently doing.                     
    --enable_printlog        : Log data about the printjobs to server_printjob.log. 
    --idle_timeout           : The maximum idle seconds for a request.              
                            : Default: 2 (pdf conversion time is considered idle)  
    -i or --instances        : The number of instances of AOP to start              
                                Giving 0 will start max instances available          
    --https_cert             : The location of the https certificate                
    --https_key              : The location of the https private key file           
    --https_port             : The port for the https server to run on.             
                                Having a key/cert but no port will make the https    
                                server use the port from -p/--port (or the default)  
                                Example: .. -p 80 --https_port 443 -https_key ...    
                                        http runs on port 80, https on port 443     
                                Example: .. -p 80 --https_key ...                    
                                        https runs on port 80, no regular http      
    --ipwhitelist            : The file to read the IP whitelist from               
                                If this parameter is empty, but 'ipwhitelist.txt'    
                                        exists, ipwhitelist.txt will be used        
                                File format: one IP (range) or subnetwork per line   
                                Example: 127.0.0.1, abc::0-def::ffff                 
                                        10.0.0.0/8, 192.0..                       
    --pdf_error_threshold    : Set the maximum amount of retries for processing a pdf 
                                file.                                                
    --enable_save            : This enables the option write to disk                
                                Default: outputfiles dir of AOP directory            
    --enable_local_resources : This enables accessing local files (e.g. templates)  
                                Default: outputfiles dir of AOP directory            
    --check_configuration    : Checks the configurations needed for AOP to run
</code></pre>
<p>Since version 18.2 AOP creates a config file. These options can be saved in this config file. If no config file is there, AOP generates the config file in the first run. 
This configuration file is of JSON format. The default configuration is as follows:</p>
<pre><code>{
    &quot;config&quot;: {
        &quot;port&quot;: 8010, // The port where AOP should start. 
        &quot;startat&quot;: &quot;./&quot;, // The default location to start at. Handly if you are using local resources. 
        &quot;license&quot;: &quot;./aop.license&quot;, // The location of the license file.
        &quot;silent&quot;: false,  // If true does not log anything.
        &quot;verbose&quot;: false, // If true logs what it is currently doing. (Ignores silent)
        &quot;enable_printlog&quot;: false, // If true logs the incoming printjobs into a log file. 
        &quot;idle_timeout&quot;: 120, // The timeout for conversion in seconds. 
        &quot;instances&quot;: 1, // The number of instace to start. Ideally is equal to number of cores (if 0 AOP detects number of cores).
        &quot;https_key&quot;: &quot;&quot;, // The location for the https key for AOP to use when starting in HTTPS mode. 
        &quot;https_cert&quot;: &quot;&quot;, // The locatio for the https certificate for AOP to use when startin in HTTPS mode. 
        &quot;https_port&quot;: 433, // The port to use while starting as HTTPS. 
        &quot;ipwhitelist&quot;: &quot;&quot;, // The location of the ipwhitelist file.
        &quot;pdf_temp_folder&quot;: &quot;&quot;, // The temp folder to use when converting to PDF.
        &quot;pdf_error_threshold&quot;: 3, // The number of retries after pdf failure.
        &quot;enable_save&quot;: false, // Enables saving output in local directories.
        &quot;enable_local_resources&quot;: false // Enables reading out the templates and resources (for e.g images).
    },
    &quot;converters&quot;: { //Placeholder for converters. You can specify your own converters here and pass the value. See section 8.1 for more info. 
        &quot;abiword&quot;:{
            &quot;command&quot;: &quot;abiword --to={outputFormat} --to-name={outputFile} {inputFile}&quot;,
            &quot;handlesParallel&quot;: false
        }
    }
}
</code></pre>

<h2 id="85-running-as-service-in-windows">8.5 Running as Service in Windows</h2>
<h3 id="using-microsoft-office-as-pdf-converter">Using Microsoft Office as PDF converter</h3>
<p>If you wish to use Microsoft office as PDF converter for your documents we have to do some tweaks before we can use ApexOfficePrint as service.</p>
<h4 id="32-bit-windows">32-Bit Windows</h4>
<h5 id="directory-creation">Directory Creation</h5>
<p>Create a directory "Desktop" if it does not already exist under \
"C:\Windows\system32\config\systemprofile\Desktop"</p>
<h5 id="dcom-config">DCOM config</h5>
<ol>
<li>
<p>From Run (Windows + R), type <strong>dcomcnfg</strong></p>
</li>
<li>
<p>Navigate to <strong>Component Services &gt; Computers &gt; My Computer &gt; DCOM Config</strong></p>
<p><img alt=" " src="./media/imageDComConfig.png" /></p>
</li>
<li>
<p>Locate "<strong>Microsoft Excel Application</strong>" and right click properties of it</p>
</li>
<li>
<p>Navigate to <strong>Security Tab</strong> and <strong>Customize</strong> the <strong>Launch and Activation Permissions</strong> and Edit</p>
</li>
<li>
<p>Check that no instances of excel.exe are running before changing the properties, either close the applications that are running the Excel or go to task manager and kill the excel.exe processes.</p>
<p><img alt=" " src="./media/imageDComDetail.png" /></p>
</li>
<li>
<p><strong>Add</strong> the <strong>current user</strong> (type the current user, click check names, and click ok) and grant <strong>permission</strong> for <strong>Local Launch</strong> and <strong>Local Activation</strong></p>
</li>
<li>
<p>Go to <strong>Identity Tab</strong> and change the radio button to <strong>"The User"</strong></p>
</li>
<li>
<p>Do the same for <strong>"Microsoft PowerPoint Slide"</strong>.</p>
</li>
<li>
<p>Do the same for <strong>"Microsoft Word 97-2003 Document"</strong>.</p>
</li>
</ol>
<h5 id="setting-directory-permissions">Setting directory permissions</h5>
<ol>
<li>
<p>Navigate to: "C:\Windows\System32\config\systemprofile\AppData\Roaming\Microsoft".</p>
</li>
<li>
<p>Right click and go to Properties</p>
</li>
<li>
<p>Under Security Tab add the current user and grant the Modify, Read &amp; Execute, List Folder Content, Read, and Write permissions.</p>
</li>
<li>
<p>Do the same for "C:\Windows\Temp\".</p>
</li>
</ol>
<h4 id="64-bit-windows">64-Bit Windows</h4>
<h5 id="directory-creation_1">Directory Creation</h5>
<p>Create a directory "Desktop" if it does not already exist under:</p>
<p>"C:\Windows\system32\config\systemprofile\Desktop"
and
"C:\Windows\SysWOW64\config\systemprofile\Desktop"</p>
<h5 id="dcom-config_1">DCOM config</h5>
<ol>
<li>
<p>From Run (Windows + R), type <strong>dcomcnfg</strong> (if your <strong>Microsoft Office is 32 bit</strong> then open command line and change directory to "<strong>C:\Windows\SysWOW64</strong>" and run "<strong>mmc comexp.msc /32" command</strong>)</p>
</li>
<li>
<p>Navigate to <strong>Component Services &gt; Computers &gt; My Computer &gt; DCOM Config</strong></p>
<p><img alt=" " src="./media/imageDComConfig.png" /></p>
</li>
<li>
<p>Locate "<strong>Microsoft Excel Application</strong>" and right click properties of it</p>
</li>
<li>
<p>Navigate to <strong>Security Tab</strong> and <strong>Customize</strong> the <strong>Launch and Activation Permissions</strong> and Edit</p>
</li>
<li>
<p>Check that no instances of excel.exe are running before changing the properties, either close the applications that are running the Excel or go to task manager and kill the excel.exe processes.</p>
<p><img alt=" " src="./media/imageDComDetail.png" /></p>
</li>
<li>
<p><strong>Add</strong> the <strong>current user</strong> (type the current user, click check names, and click ok) and grant <strong>permission</strong> for <strong>Local Launch</strong> and <strong>Local Activation</strong></p>
</li>
<li>
<p>Go to <strong>Identity Tab</strong> and change the radio button to <strong>"The Interactive User"</strong> or <strong>"The Launching User"</strong> (automatic start)</p>
</li>
<li>
<p>Do the same for <strong>"Microsoft PowerPoint Slide". </strong></p>
</li>
<li>Do the same for <strong>"Microsoft 97-2003 Document". </strong></li>
</ol>
<h5 id="setting-directory-permissions_1">Setting directory permissions</h5>
<p>Navigate to:</p>
<ol>
<li>
<p>"C:\Windows\System32\config\systemprofile\AppData\Roaming\Microsoft".</p>
</li>
<li>
<p>Right click and go to Properties</p>
</li>
<li>
<p>Under Security Tab add the current user and grant the Modify, Read &amp; Execute, List Folder Content, Read, and Write permissions.</p>
<p>Do the same for:</p>
</li>
<li>
<p>"C:\Windows\System32\config\systemprofile\AppData\Local\Microsoft"</p>
</li>
<li>
<p>Do the same for "C:\Windows\Temp\".</p>
</li>
</ol>
<h3 id="using-libreoffice-as-pdf-converter">Using LibreOffice as pdf converter</h3>
<p>No extra steps are necessary.</p>
<h3 id="managing-the-service">Managing the service</h3>
<ul>
<li>
<p>Navigate to Windows Service folder situated in the APEXOfficePrint folder.</p>
</li>
<li>
<p>Edit 1_SetupAsService.bat to include the full path to the executable APEXOfficePrintWin64.exe</p>
<p>Note that you can also add additional parameters for example for the port it should run on and the starting directory.</p>
<p><code>terminal
nssm.exe install APEXOfficePrint %0\..\..\APEXOfficePrintWin64.exe --port 8090 -s D:\apexofficeprint</code></p>
</li>
<li>
<p>Run 1_SetupAsService.bat.</p>
</li>
<li>
<p>The service should be installed and can be seen in Services (Control Panel &gt; Administrative Tools &gt; Services).</p>
</li>
<li>
<p>To change how the APEXOfficePrint services starts you can change it from Services or start it manually via 2_StartService.bat (should be run as Administrator).</p>
</li>
<li>
<p>To check if the service has started, navigate to <a href="http://localhost:8010/">http://localhost:8010/</a></p>
</li>
<li>
<p>To stop the service run 3_StopService.bat as Administrator or stop it from Services.</p>
</li>
<li>
<p>To remove the APEXOfficePrint as service run 4_RemoveService.bat.</p>
</li>
<li>
<p>The APEXOfficePrint service should now be removed from Services. If it says Disabled then it will be removed after the service has been stopped.</p>
</li>
</ul>
<h2 id="86-run-apex-office-print-at-startup-or-as-service-in-linux">8.6 Run APEX Office Print at startup or as service in Linux</h2>
<p>After reboot of the server where APEX Office print is installed, you have to make sure that you also run APEXOfficePrintLinux64 command. If you want to automate the startup of AOP you can create in init.d.
For example: /etc/init.d/aop-server</p>
<pre><code class="bash">#!/bin/bash
#
# Apex Office Print (AOP) Server
#
# chkconfig: 345 70 30
# description: AOP is a print server for Oracle Application Express and PL/SQL
# processname: APEXOfficePrint

# Source function library.
. /etc/init.d/functions

RETVAL=0
AOP_HOME=/opt/aop/v18.1/server
AOP_PROCESS_NAME=APEXOfficePrint
AOP_EXECUTABLE_NAME=APEXOfficePrintLinux64
AOP_PORT=8010
LIBREOFFICE_HOME=/opt/libreoffice5.4

PATH=$LIBREOFFICE_HOME/program:$PATH
export PATH

start() {
        echo -n &quot;Starting $AOP_PROCESS_NAME &quot;
        echo -n &quot;Current path is $PATH&quot;
        $AOP_HOME/$AOP_EXECUTABLE_NAME -p $AOP_PORT -s $AOP_HOME &amp;
        RETVAL=$?
        echo
        return $RETVAL
}

stop() {
        echo -n &quot;Shutting down $AOP_PROCESS_NAME: &quot;
        pkill $AOP_PROCESS_NAME
        RETVAL=$?
        echo
        return $RETVAL
}

status() {
        echo -n &quot;TODO: Print $AOP_PROCESS_NAME status here... &quot;
        RETVAL=$?
        return $RETVAL
}

case &quot;$1&quot; in
    start)
        start
        ;;
    stop)
        stop
        ;;
    status)
        status
        ;;
    restart)
        stop
        start
        ;;
    *)
        echo &quot;Usage: $prog {start|stop|status|restart}&quot;
        exit 1
        ;;
esac
exit $RETVAL
</code></pre>

<h2 id="87-startstop-apex-office-print-on-linux-7-with-systemctl">8.7 Start/Stop APEX Office Print on Linux 7 with systemctl</h2>
<p>On Linux 7 you can use systemd (systemctl) to start and stop services.
For Red Hat and Oracle Enterprise Linux you can follow the below instructions.</p>
<p>As user root or sudo privileged user</p>
<ul>
<li>cd into /usr/lib/systemd/system</li>
<li>create a file aop.service</li>
</ul>
<p>Paste the following in and adjust for your installation as required (personally I install AOP in /opt/oracle)</p>
<pre><code>[Unit]
Description=APEX Office Print
After=network.target

[Service]
Type=simple
User=aop
Group=aop

Environment=AOP_HOME=/opt/aop/latest/server  ### Please see comment below
Environment=AOP_PROCESS_NAME=APEXOfficePrint
Environment=AOP_EXECUTABLE_NAME=APEXOfficePrintLinux64
Environment=AOP_PORT=8010

Environment=PATH=/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/bin/
SyslogIdentifier=apexofficeprint
Restart=always
RestartSec=30
TimeoutStartSec=30
TimeoutStopSec=30

ExecStart=/usr/bin/env ${AOP_HOME}/${AOP_EXECUTABLE_NAME} -p ${AOP_PORT} -s ${AOP_HOME}

ExecStop=/usr/bin/env pkill ${AOP_PROCESS_NAME}

[Install]
WantedBy=multi-user.target
</code></pre>

<ul>
<li>Reload the daemon</li>
</ul>
<pre><code>systemctl daemon-reload
</code></pre>

<ul>
<li>A simple setup is to install the version of aop in /opt/aop. When you install a new version just unzip in this directory. You will end up for example with the following directories v3.4, v3.5 and v18.1. Create in the directory /opt/aop a symbolic link to point to the latest version.</li>
</ul>
<pre><code>ln -s /opt/aop/v18.1 /opt/aop/latest
</code></pre>

<p>Suppose something is not working properly and you need to revert back to your previous version, all you need to do is to create the symbolic link to a previous version. For example</p>
<pre><code>unlink latest
ln -s /opt/aop/v3.3 /opt/aop/latest
</code></pre>

<ul>
<li>As root </li>
</ul>
<pre><code>start aop :  systemctl start aop
stop aop :  systemctl stop aop
status aop: systemctl status aop
</code></pre>

<p>Example output of systemctl status aop</p>
<pre><code>[root@s2s-proddb-03 system]# systemctl status aop.service 
● aop.service - APEX Office Print 
   Loaded: loaded (/usr/lib/systemd/system/aop.service; disabled; vendor preset: disabled) 
   Active: active (running) since Sat 2018-03-10 20:39:47 AEDT; 6s ago 
Main PID: 28273 (APEXOfficePrint) 
   CGroup: /system.slice/aop.service 
           ├─28273 /opt/aop/latest/server/APEXOfficePrintLinux64 -p 8010 -s /opt/oracle/aop/latest/server 
           ├─28283 /opt/aop/v3.4/server/APEXOfficePrintLinux64 --pkg-fallback --max_old_space_size=16384 /snapshot/apexofficeprint/aop_server/node_modules/apexrnd-startup-utils/sequentialConverter.js -d 0 --idleT... 
           └─28288 /opt/aop/v3.4/server/APEXOfficePrintLinux64 --pkg-fallback --max_old_space_size=16384 /snapshot/apexofficeprint/aop_server/apexofficeprint.js -p 8010 -s /opt/oracle/aop/latest/server 
Mar 10 20:39:47 http://proddb-032.acme.com systemd[1]: Started APEX Office Print. 
Mar 10 20:39:47 http://proddb-032.acme.com systemd[1]: Starting APEX Office Print... 
Mar 10 20:39:48 http://proddb-032.acme.com apexofficeprint[28273]: Current license is activated to: xxxx@thiscompany.com 
Mar 10 20:39:48 http://proddb-032.acme.com apexofficeprint[28273]: The products activated are: 
Mar 10 20:39:48 http://proddb-032.acme.com apexofficeprint[28273]: Word 
Mar 10 20:39:49 http://proddb-032.acme.com apexofficeprint[28273]: Listening on port 8010 
Mar 10 20:39:49 http://proddb-032.acme.com apexofficeprint[28273]: AOP 1 running
</code></pre>

<h2 id="88-step-by-step-how-to-install-libreoffice-on-linux">8.8 Step-by-step how to install LibreOffice on Linux</h2>
<p>In case you need to install LibreOffice on Linux, here're the steps (see also other section):</p>
<pre><code class="bash"># download LibreOffice for the PDF converter
cd /tmp
wget  http://downloadarchive.documentfoundation.org/libreoffice/old/5.4.7.2/rpm/x86_64/LibreOffice_5.4.7.2_Linux_x86-64_rpm.tar.gz

# make sure no old versions exist
yum remove openoffice* libreoffice*

# extract tar
tar -xvf LibreOffice_5.4.7.2_Linux_x86-64_rpm.tar.gz

# install
cd /tmp/LibreOffice_5.4.7.2_Linux_x86-64_rpm/RPMS/

yum localinstall *.rpm

# install some missing dependencies (depending your linux version this is not necessary)
yum install cairo.x86_64
yum install cups.x86_64
yum install mesa-libGL.x86_64

# install Java dependency (not necessary if you already have Java)
yum install java-1.8.0-openjdk.x86_64

# create symbolic link
ln -s /opt/libreoffice5.4/program/soffice /usr/sbin/soffice
</code></pre>

<h2 id="89-https-configuration">8.9 HTTPS Configuration</h2>
<p>AOP also has support for the usages of https protocol. It requires a crt file and its private key file. 
A self signed certificate and key can also be used. The certifcate can be generated by using openssl command:</p>
<pre><code>openssl req -x509 -newkey rsa:2048 -keyout keytmp.pem -out aop.crt -days 365
openssl rsa -in keytmp.pem -out aop.key
</code></pre>

<p>Given aop.crt certifcate file and aop.key private key file AOP can be started with:</p>
<pre><code>APEXOfficePrint --https_cert aop.crt --https_key aop.key
</code></pre>

<p>The port number can also be specified with the --https_port argument. If this is provided HTTP and HTTPS server will run.</p>
<p>You should see the following when started successfully on the console.</p>
<pre><code>Starting HTTP and HTTPS on port 8010 and 443
AOP 1 (HTTP) running
AOP 1 (HTTPS) running
</code></pre>

<p>Please note that the certificate validation is done by the client. 
If you are using a self signed certificate and visit the https location with browser, you will get a security warning (see below).</p>
<p><img alt="" src="./media/certificate_error.png" /></p>
<p><img alt="" src="./media/firefox_certificate_error.png" /></p>
<p>You can configure the browsers to trust the self signed certificate by adding it to the security exception.
You will also have to add this certificate in your oracle wallet to get rid of 'Certificate Validation Error'.</p>
<p>This option is comes in handy if you are running AOP.</p>
<h2 id="810-installation-errors">8.10 Installation errors</h2>
<h3 id="linux-installation-port-error">Linux installation port error</h3>
<p>If you encounter this error:</p>
<pre><code>-------------------------------------------------
Error on Thu Feb 04 2016 19:33:35 GMT-0800 (PST)
-------------------------------------------------
listen EADDRINUSE
</code></pre>
<p>It means that the port you tried running AOP server is already taken and you need to change it by running this command:</p>
<p>./APEXOfficePrintLinux64 –p xxxx (replace xxxx by a free port)</p>
<h2 id="811-docker-image">8.11 Docker image</h2>
<h3 id="pre-requisites">Pre-requisites</h3>
<p>Define a Docker netwerk, if you don't have one yet</p>
<pre><code class="bash">docker network create my_network
</code></pre>

<p>Make sure your Oracle database container is in this netwerk</p>
<pre><code class="bash">docker network connect my_network oracle
</code></pre>

<p>Start your ORDS container on this netwerk</p>
<pre><code class="bash">docker run -t -i \
--name ords \
--network=my_network \
-e DATABASE_HOSTNAME=&quot;oracle&quot; \
-e DATABASE_PORT=&quot;1521&quot; \
-e DATABASE_SERVICENAME=&quot;ORCLPDB1&quot; \
-e DATABASE_PUBLIC_USER_PASS=oracle \
-e APEX_LISTENER_PASS=oracle \
-e APEX_REST_PASS=oracle \
-e ORDS_PASS=oracle \
--volume /docker/apex/images:/usr/local/tomcat/webapps/i \
-p 8181:8080
ords/ords_apex:3.0.9
</code></pre>

<h3 id="download-the-aop-docker-image">Download the AOP docker image</h3>
<pre><code class="bash">docker pull apexrnda/apexofficeprint
</code></pre>

<p>Activating APEX Office Print the first time (Gold license only - not necessary for Enterprise license). This step is only needed once.</p>
<pre><code class="bash">docker run -it \
--name apexofficeprint \
--network=my_network \
-p 8010:8010 \
-v /docker/apexofficeprint/:/apexofficeprintstartup/ \
apexrnd/apexofficeprint \
-s /apexofficeprintstartup/
-a
</code></pre>

<p>In case you have an Enterprise License, add the aop.license file in the directory you specified, in the below example it's /docker/apexofficeprint/</p>
<h3 id="start-an-aop-container-on-the-network-of-your-oracle-database-container">Start an AOP container on the network of your Oracle database container</h3>
<pre><code class="bash">docker run -d \
--name apexofficeprint \
--network=my_network \
-p 8010:8010 \
-v /docker/apexofficeprint/:/apexofficeprintstartup/ \
apexrnd/apexofficeprint \
-s /apexofficeprintstartup/
</code></pre>

<p>You should now be able to connect to APEX Office Print server by going to http://apexofficeprint:8010/. You can view <a href="https://www.youtube.com/watch?v=U2RomOX_4_8">this video</a> to see the above in action.</p>
<h3 id="create-an-acl-for-apex_050100-to-the-aop-container">Create an ACL for APEX_050100 to the AOP container</h3>
<pre><code class="sql">begin
 DBMS_NETWORK_ACL_ADMIN.append_host_ace (
    host       =&gt; 'apexofficeprint',
    lower_port =&gt; 8010,
    upper_port =&gt; 8010,
    ace        =&gt; xs$ace_type(privilege_list =&gt; xs$name_list('http'),
                              principal_name =&gt; 'APEX_050100',
                              principal_type =&gt; xs_acl.ptype_db));
end;
</code></pre>

<h3 id="configure-the-apex-plug-in">Configure the APEX plug-in</h3>
<p>Go to Shared Components &gt; Component Settings &gt; APEX Office Print and put in the AOP URL a reference to your docker container e.g. http://apexofficeprint:8010/</p>
<h1 id="9-tutorials">9 Tutorials</h1>
<p>You can check the <a href="https://www.apexofficeprint.com/ords/f?p=328:1">APEX Office Print tutorial page</a> to see tutorials and videos.</p>
<h1 id="10-troubleshooting">10 Troubleshooting</h1>
<h2 id="101-output-generates-invalid-office-documents">10.1 Output generates invalid Office documents</h2>
<p>In case Office documents are not opening as expected, probably there was an issue with the JSON that was send to the AOP server. If you run in the AOP Cloud, you can enable Remote Debugging, which you can access when you login in your APEX Office Print dashboard at <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a>.
If you're running the on-premise version of AOP, on the server there is a server_error.log file that contains the errors it found during rendering. First step is to check that file for more information.
Next make sure that your JSON is valid by validating the JSON in for example <a href="http://jsonlint.com">http://jsonlint.com</a> or by doing Remote Debug (see further on in this document)</p>
<h2 id="102-invalid-json-generated-by-apex95web95servicemake95rest95request">10.2 Invalid JSON generated by apex_web_service.make_rest_request</h2>
<p>Make sure APEX 5.0.4 or higher is installed. To download it login to support.oracle.com.</p>
<h2 id="103-invalid-json-generated-by-apex_json">10.3 Invalid JSON generated by apex_json</h2>
<p>Make sure you install an additional patch for APEX 5.0.4 PSE 24341756 or for APEX 5.1.0 PSE 25650850 or for APEX 5.1.1 PSE 25853436 or for APEX 5.1.4 PSE 27963501 available at <a href="https://support.oracle.com">https://support.oracle.com</a>. Those will fix issues with apex_json which is used behind the scenes in AOP.</p>
<p>You also might hit Oracle database bug (in 12.1.0.2). A patch is made available on <a href="https://support.oracle.com">https://support.oracle.com</a>; search for patch #21424376. You won't experience this issue in 11.2.0.4 or 12.2.</p>
<p>When using PL/SQL Function returning JSON, you might hit a bug in apex_plugin_util, which can be fixed by applying patch 26048323.</p>
<p>Finally if you still encounter issues, use ORDS (SQL Workshop &gt; RESTful Services) as your datasource. ORDS will generate the JSON instead of apex_json and AOP will use that JSON instead (see 3.5.4 Data Source - URL with ORDS RESTful Web Service).</p>
<h2 id="104-running-on-oracle-cloud">10.4 Running on Oracle Cloud</h2>
<p>If you are running on Oracle Cloud you have to use HTTPS in the AOP Plug-in Component setting and when you call the <em>aop_api_pkg</em> package. Use <a href="https://www.apexrnd.be/aop">https://www.apexrnd.be/aop</a> as the url.</p>
<h2 id="105-invalid-pdf-file">10.5 Invalid PDF file</h2>
<p>If you're running the on-premise version of AOP, check a file on the server called server_error.log or server_uncaugt_exceptions.log and see which error you get.
Try to run your example in the same format as your template. If this also fails, there's an issue with the JSON or the template. Check your template and data again. If you receive your document fine, but PDF is not working, there's an issue finding LibreOffice or MS Office. Make sure those programs are installed correctly. Try to do a manual conversion on the command line in those tools and see if that works. If not, check the error and try to reinstall.
You can also do Remote Debugging (see further on in this document), which will help identifying the real issue. If everything fails, please contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a>.</p>
<h2 id="106-ora-29273-http-request-failed">10.6 ORA-29273: HTTP request failed</h2>
<p><strong>ORA-29273: HTTP request failed ORA-06512: at "SYS.UTL_HTTP", line 1130 ORA-24247: network access denied by access control list (ACL)</strong></p>
<p>Make sure APEX_050000 or APEX_050100 schema has the rights to connect to APEX Office Print (http(s)://www.apexofficeprint.com for the Cloud version or your local url in case of the on-premise version). The script to correct the issue can be found here: <a href="https://docs.oracle.com/cd/E59726_01/install.50/e39144/listener.htm#HTMIG29162">APEX 5.0</a> or for <a href="http://docs.oracle.com/database/apex-5.1/HTMIG/enabling-network-services-in-Oracledb-11g-or-later.htm#HTMIG29160">APEX 5.1</a> (use the correct script for your database version - for XE use prior to 12c)</p>
<h2 id="107-ora-29024-certificate-validation-failure">10.7 ORA-29024: Certificate validation failure</h2>
<p><strong>ORA-29273: HTTP request failed ORA-06512: at "SYS.UTL_HTTP", line 1130 ORA-29024: Certificate validation failure</strong></p>
<p>In case you run over HTTPS you need to take into account the certificates.
There're two ways to get around this:</p>
<ul>
<li>
<p>Option 1: You can load our certificates in your Oracle wallet (the Oracle DB is doing the call to our server).</p>
</li>
<li>
<p>Option 2: You can add an entry in your webserver so a local entry is called by the database (which doesn't need a certificate) and the webserver is doing the redirect to handle the https call.</p>
</li>
</ul>
<p>Here's an example when in the plug-in you would specify a local address: <a href="http://apexrnd.localdomain/aop/">http://apexrnd.localdomain/aop/</a></p>
<pre><code>&lt;VirtualHost *:80&gt;
ServerName  apexrnd.localdomain
ServerAlias apexrnd.localdomain
RewriteEngine On
ProxyVia On
ProxyRequests Off
SSLProxyEngine On
ProxyPass        /aop/   https://api.apexofficeprint.com/
ProxyPassReverse /aop/   https://api.apexofficeprint.com/
&lt;/VirtualHost&gt;
</code></pre>
<h2 id="108-error-generating-excel-and-powerpoint-with-aop-trial">10.8 Error generating Excel and Powerpoint with AOP Trial</h2>
<p>If you don't activate the on-premise version of AOP it will run in Trial mode.
This mode is not able to generate xlsx and pptx files, but it will work with docx and pdf, but those outputs will contain a trial watermark. The 100 day free cloud version is not limited and you can do everything on there.
When you buy APEX Office Print you can activate your on-premise version and all restrictions will be removed.</p>
<h2 id="109-how-to-read-and-convert-documents-docx-xlsx-pptx-pdf-on-linux">10.9 How to read and convert documents (docx, xlsx, pptx, pdf) on Linux</h2>
<p>You need to install LibreOffice <a href="https://www.libreoffice.org/download/libreoffice-fresh/">https://www.libreoffice.org/download/libreoffice-fresh/</a>. The steps to do this are outlined below:</p>
<p>Make a connection to your server with ssh or putty, but make sure you <strong>don't forward or tunnel your X Display</strong>.</p>
<p>Install supporting packages:</p>
<pre><code>yum install wget
</code></pre>
<p>Download LibreOffice</p>
<pre><code>cd /tmp
wget http://download.documentfoundation.org/libreoffice/stable/5.4.2/rpm/x86_64/LibreOffice_5.4.2_Linux_x86-64_rpm.tar.gz
</code></pre>
<p>Install LibreOffice</p>
<pre><code>tar xzvf LibreOffice_5.4.2_Linux_x86-64_rpm.tar.gz
cd LibreOffice_5.4.2.2_Linux_x86-64_rpm/RPMS
yum localinstall *.rpm
- or you can do rpm -ivh *.rpm
</code></pre>
<p>Add LibreOffice to the profile for your user (as it needs to be able to find soffice)</p>
<pre><code>vi /etc/profile
export PATH=$PATH:/opt/libreoffice5.4/program
source /etc/profile
</code></pre>
<p>Or add a symbolic link to LibreOffice</p>
<pre><code>ln -s /opt/libreoffice5.4/program/soffice /usr/sbin/soffice
</code></pre>
<p>Check the version of LibreOffice and try to run a conversion</p>
<pre><code>soffice --version
soffice --headless --invisible --convert-to pdf --outdir /tmp aop_interactive.docx
</code></pre>
<p>If you get: Fontconfig warning: ignoring UTF-8: not a valid region tag</p>
<pre><code>echo "$LC_CTYPE"
|-&gt; you probably have UTF-8 defined; unset it
export LC_CTYPE=""
</code></pre>
<p>Make sure you restart APEX Office Print after installing LibreOffice.</p>
<p><strong>Note:</strong> we sometimes see LibreOffice doesn't generate the same PDF as MS Office is generating, but we found LibreOffice becoming more and more inline, so we recommend using the latest version of LibreOffice.</p>
<p><strong>Note:</strong> Depending the version of LibreOffice converting to HTML from docx, xlsx, pptx might include the images as base64 or include a link.</p>
<h2 id="1010-ora-31011-xml-parsing-failed-ora-19202-error-occurred-in-xml-processing-lpx-00651-vm-stack-overflow">10.10 ORA-31011: XML parsing failed, ORA-19202: Error occurred in XML processing, LPX-00651: VM Stack overflow</h2>
<p>You need to install an additional patch for APEX 5.0.4 which will fix this issue. Search in <a href="https://support.oracle.com">https://support.oracle.com</a> for PSE 24341756.</p>
<h2 id="1011-error-occured-while-aquiring-license">10.11 Error occured while aquiring license</h2>
<p>You receive: "Error occured while aquiring license. Please make sure that your API key is correct and that you have enough printing credits. Contact AOP if the problem persists."</p>
<p>This means you ran out of credits. Go to <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a> and upgrade your package or send an email to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a> to see what we can do for your case.</p>
<h2 id="1012-syntaxerror-unexpected-token-p-in-json-at-position-0">10.12 SyntaxError: unexpected token P in JSON at position 0</h2>
<p>If you are using APEX 5.1, the Dynamic Action plug-in will always work, whereas the Process plug-in might give this error. When you put the process in the Processing part, it will only work if the “Reload on Submit” attribute (of the page) is set to “Always” (note this attribute is new in 5.1).
This is due to a change how APEX 5.1 is handling Page Processing. If you would import an APEX 5.0 app in 5.1 by default it’s set to Always reload on submit, but if you create a brand new app in 5.1 it’s set to “Only for Success” and then the process plug-in is not working. Alternative you can put the AOP Process to be After Header, and make it conditional, than it will work regardless of the setting of "Reload on Submit".</p>
<h2 id="1013-issues-with-oracle-xe">10.13 Issues with Oracle XE</h2>
<p>When using Oracle XE, make sure you have the execute grant on the UTL_HTTP package.</p>
<pre><code>GRANT EXECUTE ON SYS.UTL_HTTP TO my_user;
GRANT EXECUTE ON SYS.UTL_FILE TO my_user;
</code></pre>
<p>If you receive "ORA-20000: Issue returned by AOP Service (REST call). Please verify the logs on the server. Returned HTTP code: . (code: -29273)", see section 10.6.</p>
<h2 id="1014-chinese-and-other-language-and-font-support">10.14 Chinese and other language and font support</h2>
<p>If you need special characters or language support, make sure the necessary fonts and languages are on your system. For example to add Chinese support on RHEL Linux do:</p>
<pre><code>yum install "@Chinese Support"
</code></pre>
<p>Further more if you want to install additional fonts here's a good <a href="http://mscorefonts2.sourceforge.net">link</a>. Our AOP Cloud is also supporting <a href="https://www.google.com/get/noto/">Google Noto</a> fonts.</p>
<p>Installing a font is nothing more than installing the font on your system.
So for example on (RedHat) Linux we copy the *.ttf files (or directory) to /usr/share/fonts/ and run "fc-cache -f -v"</p>
<p>Depending if you have a GUI (Linux/Windows) you can just double click on the font and it will install it in your system. If your system recognises is, MS Office or LibreOffice should be able to use it for the PDF conversion.</p>
<p>For barcodes, you could also choose to install a barcode font, for example <a href="https://www.barcodesinc.com/free-barcode-font/">Free 3of9</a> or <a href="http://www.dafont.com/3of9-barcode.font">http://www.dafont.com/3of9-barcode.font</a>. Barcode fonts are more performant than images.</p>
<h2 id="1015-running-aop-installed-in-a-single-schema-but-shared-across-multiple-schemas">10.15 Running AOP installed in a single schema but shared across multiple schemas</h2>
<p>It is possible to install AOP only once and call it from other places. In order to do this, after you install AOP - go to the package AOP_API18_PKG and AOP_PLSQL18_PKG and remove the AUTHID CURRENT_USER and recompile.</p>
<p><img alt=" " src="./media/authid.png" /></p>
<h2 id="1016-running-on-premise-aop-under-https">10.16 Running on-premise AOP under HTTPS</h2>
<p>Since AOP version 3.1 AOP can be configured to use HTTPS server. The key and the certificate files can be provided to AOP using the --https_key and --https_cert arguments.</p>
<p>For older versions however we recommend setting up an Apache Reverse Proxy which is doing the SSL in front of AOP.
From Apache to AOP it would be unencrypted, but if it’s on the same machine as Apache and the port of AOP is not open and only accessible by localhost, we believe you're save.</p>
<p>To prevent access to AOP other than the Apache Reverse Proxy, you can do (on Linux):</p>
<pre><code class="bash">iptables -A INPUT -p tcp --dport 8010 -s 127.0.0.0/8 -j ACCEPT
iptables -A INPUT -p tcp --dport 8010 -j DROP
</code></pre>

<p>(instead of DROP you can use REJECT too)</p>
<p>So that would mean only a program on localhost (like Apache) can connect to port 8010, all others are rejected.</p>
<h2 id="1017-the-requested-url-has-been-prohibited">10.17 The requested URL has been prohibited</h2>
<p>If in APEX you force all outgoing connections to be HTTPS by setting:
Manage Instance -&gt; Security -&gt; HTTP Protocol -&gt; Require Outbound HTTPS -&gt; No.</p>
<p>make sure you're calling AOP also with HTTPS. If you're calling the AOP cloud <a href="https://api.apexofficeprint.com">https://api.apexofficeprint.com</a> make sure to load the certificate in your database or setup a proxy on your end.</p>
<h2 id="1018-pdf-output-suddenly-stopped-working">10.18 PDF output suddenly stopped working</h2>
<p>Probably LibreOffice or MS Office process is stuck. A way to solve this is running a script that checks for long running processes and that kills those. If you're using the AOP Cloud, please contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a>.</p>
<h2 id="1019-map-or-gantt-or-other-div-not-in-output">10.19 Map or Gantt or Other div not in output</h2>
<p>In some occations divs are not screenshotted well enough, so they don't appear in the output. For example the JET Gauge might not be taken. We are looking for a workaround for a future release.</p>
<h2 id="1020-ora-29273-http-request-failed-ora-12535-tnsoperation-timed-out">10.20 ORA-29273: HTTP request failed ORA-12535: TNS:operation timed out</h2>
<p>Please check your firewall if it allows outgoing connection from the database to the AOP server.
If you added the AOP port to the firewall rules, make sure to restart the daemon.</p>
<p>If you're using a proxy, make sure to specify the proxy in Shared Components &gt; Application Definition Attributes &gt; Proxy Server or specify the global variable in the AOP_API_PKG.g_proxy_override.</p>
<p>See also further in this doc at chapter 14 Debugging connections to AOP Server</p>
<h2 id="1021-font-in-pdf-is-different-from-the-font-in-my-word-template">10.21 Font in PDF is different from the font in my Word template</h2>
<p>This is most likely due to the fact that the font you chose in Word, is available on your local computer, but not in the server. If you install that font also on the server where AOP is running, it should do the conversion well. See also 10.14 Chinese and other language and font support.</p>
<h2 id="1022-the-generation-of-my-document-is-slow">10.22 The generation of my document is slow</h2>
<p>You would need to figure out where you lose time:</p>
<ul>
<li>
<p>creation of JSON: your SQL statement or other source is taken to transform in JSON. You can trace what is going on by setting your page in debug mode (APEX) or running your SQL statement in a SQL window.</p>
</li>
<li>
<p>time needed on the server by AOP: you can trace that by enabling logging (only on-premise) Start the AOP server with --enable_printlog or --verbose, which will show the incoming requests.</p>
</li>
<li>
<p>network time: measture the time to travel from your database to our cloud or to your own on-premise install. If you would use the on-premise version and put AOP on the same machine as the database, it would be the fastest. Or if you could add it on another server where the network is fast, that should get rid of the transfer time.</p>
</li>
</ul>
<p>If the conclusion is that everything is as fast as possible, we advice the reports that take a long time, to run in the background with a job. You could also schedule the reports to run overnight and store the results in a table.</p>
<h2 id="1023-invalid-multi-column-chart-or-unexpected-error">10.23 Invalid multi-column chart or Unexpected Error</h2>
<p>With some versions of the Oracle Database there's an issue with the Cost Based Optimiser.
Till you upgrade your database, you might want to try to use /<em>+rule</em>/ hint in your top level SQL statement.</p>
<h2 id="1023-safe-button-in-components-settings-not-available">10.23 Safe button in Components Settings not available</h2>
<p>Most likely you subscribed the plug-in from another place. Go to Shared Components &gt; Plug-ins
- Click on References (number) and copy your logic where you used AOP. This is so you don't have to recreate your logic later. Next, remove all the processes or dynamic actions that use the plug-in.
- Now you should be able to go to Shared Components &gt; Plug-ins &gt; AOP and hit the Delete button so the AOP plug-in is removed.
- Import the AOP plug-in again, but make sure you don't reference it from another app, so Import from file.
- Use the logic from step 1 to recreate your call(s) to AOP.</p>
<h2 id="1024-sqlerrm-ora-31011-xml-parsing-failed-ora-19202-error-occurred-in-xml-processing-lpx-00664-vm-node-stack-overflow">10.24 sqlerrm: ORA-31011: XML parsing failed ORA-19202: Error occurred in XML processing LPX-00664: VM Node-Stack overflow</h2>
<p>The node stack of the XSL VM can be set with an event. It defaults to 300, the maximum is 4096. You can set it with:</p>
<pre><code class="sql">alter session set events='31153 trace name context forever, level 4096'; 
</code></pre>

<h2 id="1025-how-to-get-a-download-to-excel-button-in-the-actions-menu-of-an-interactive-report">10.25 How to get a download to Excel button in the Actions menu of an Interactive Report?</h2>
<p>The below steps describe how to export an Interactive Report to Excel (XLSX) with AOP via the native IR download dialog. The changes are done on the global page and works for all IR of the app without the need of creating a DA on each page for each report, so reducing a lot of manual work.</p>
<p>Create a JS file with the following content and upload/reference it app-wide:</p>
<pre><code class="javascript">function addAOPXLSXDownloadToIR(pStaticIdItem) {
  // hack into dialogopen event of jquery ui dialogs
  $('body').on('dialogopen', function(event, ui) {
    var dialogWindow$ = $(event.target);
    // only process if it´s an IR download dialog
    if (dialogWindow$.parents('div.ui-dialog').find('span.ui-dialog-title').text() === apex.lang.getMessage('APEXIR_DOWNLOAD')) {
      // get ID/static ID of IR
      var currentRegionId = dialogWindow$.attr('id').match(/(.+)_dialog_js/)[1];
      if (currentRegionId) {
        // build html markup for XLSX download button
        var html = apex.util.htmlBuilder();
        html.markup('&lt;li')
          .attr('class', 'a-IRR-iconList-item')
          .markup('&gt;')
          .markup('&lt;a')
          .attr('class', 'a-IRR-iconList-link')
          .attr('href', 'javascript:$s(&quot;' + pStaticIdItem + '&quot;,&quot;' + currentRegionId + '&quot;)')
          .attr('id', 'download_excel_aop')
          .markup('&gt;')
          .markup('&lt;span')
          .attr('class', 'a-IRR-iconList-icon a-Icon icon-irr-dl-xls')
          .markup('&gt;')
          .markup('&lt;/span&gt;')
          .markup('&lt;span')
          .attr('class', 'a-IRR-iconList-label')
          .markup('&gt;')
          .markup('XLSX')
          .markup('&lt;/span&gt;')
          .markup('&lt;/a&gt;')
          .markup('&lt;/li&gt;');
        // append html
        $('.a-IRR-iconList').append(html.toString());
      }
    }
  });
}
</code></pre>

<p>Create a page 0 item for holding the IR static ID:</p>
<pre><code>P0_AOP_IR_STATIC_ID
</code></pre>

<p>Create a page load DA (Execute JavaScript Code) on page 0 to call above JS function</p>
<pre><code class="javascript">addAOPXLSXDownloadToIR('P0_AOP_IR_STATIC_ID’);
</code></pre>

<p>Create a page 0 DA (On Change of “P0_AOP_IR_STATIC_ID”) which calls the AOP plugin</p>
<ul>
<li>1 True Action (AOP plugin)</li>
</ul>
<p><img alt=" " src="./media/ir_download_01.jpg" /></p>
<ul>
<li>2 True Action (Execute JavaScript - To close the IR download dialog after download)</li>
</ul>
<pre><code class="javascript">var staticId = $v('P0_AOP_IR_STATIC_ID');
$('div#' + staticId + '_dialog_js').parent().find('button').click();
</code></pre>

<p>Note: every IR should have a static ID.</p>
<p>That´s it, the final result looks like this (on every IR in the app):</p>
<p><img alt=" " src="./media/ir_download_02.jpg" /></p>
<h2 id="1026-ora-06550-pls-00201-identifier-aop_api_pkgxxx-must-be-declared">10.26 ORA-06550: PLS-00201: identifier 'AOP_API_PKG.xxx' must be declared</h2>
<p>The APEX Plug-in can't find the AOP_API_PKG package. To fix the issue, run aop_db_pkg.sql (in the "db"-directory) in your Oracle Schema (SQL Workshop -&gt; SQL Scripts -&gt; Upload -&gt; Select file and hit Upload)</p>
<h1 id="11-debugging-in-apex">11 Debugging in APEX</h1>
<p>AOP is fully instrumented with APEX debug messages, so when you turn debugging on in your APEX application you will see many AOP: ... calls.
Depending the level of APEX debug mode, more detailed debug output will be available. See <a href="http://dgielis.blogspot.com/2018/06/error-whats-going-in-apex-easiest-way.html">Dimitri Gielis's blog post</a> how to put APEX Trace on, which will show the most debug messages.</p>
<p>You can also specify a global variable g_debug_procedure if you want to call your own debug procedure which for examples logs the information in your own table.</p>
<p>If you use Logger, you can also enable logger by compiling aop_api_pkg with a PL/SQL flag.</p>
<pre><code class="sql"> ALTER PACKAGE aop_api18_pkg COMPILE PLSQL_CCFLAGS = 'logger_on:TRUE';
</code></pre>

<h1 id="12-debugging-in-plsql">12 Debugging in PL/SQL</h1>
<p>If you're scheduling reports or calling the AOP packages with PL/SQL you can debug straight from PL/SQL. Here's an example:</p>
<pre><code class="sql">declare
  l_binds           wwv_flow_plugin_util.t_bind_list;
  l_return          blob;
  l_output_filename varchar2(100) := 'output';
begin
  -- remove previous debug
  apex_debug.remove_debug_by_age(
    p_application_id  =&gt; 232,
    p_older_than_days =&gt; -1);

  -- create an APEX session with the debug enabled
  aop_api_pkg.create_apex_session(
    p_app_id       =&gt; 232,
    p_enable_debug =&gt; 'Y');

  l_return := aop_api_pkg.plsql_call_to_aop (
                p_data_type       =&gt; aop_api_pkg.c_source_type_rpt,
                p_data_source     =&gt; 'ir1',
                p_template_type   =&gt; aop_api_pkg.c_source_type_apex,
                p_template_source =&gt; 'aop_interactive.docx',
                p_output_type     =&gt; 'pdf',
                p_output_filename =&gt; l_output_filename,
                p_binds           =&gt; l_binds,
                p_aop_url         =&gt; 'http://api.apexofficeprint.com/',
                p_api_key         =&gt; '1C511A58ECC73874E0530100007FD01A',
                p_app_id          =&gt; 232,
                p_page_id         =&gt; 5,
                p_init_code       =&gt; 'aop_api_pkg.g_language := ''en'';');
end;
/
</code></pre>

<h1 id="13-remote-debugging">13 Remote Debugging</h1>
<p>If you receive an error and you need some help of us, do following steps:</p>
<p>1) Go in your application to Shared Components &gt; Component Settings &gt; APEX Office Print (AOP) [Plug-in] and enable remote debugging (see parameters screenshot)</p>
<pre><code>![ ](media/aop_component_settings.png)

Note 1: you find your API key when you login in your dashboard on &lt;https://www.apexofficeprint.com&gt;

Note 2: Make sure APEX\_050000 or APEX\_050100 schema has the rights to connect to http(s)://www.apexofficeprint.com
</code></pre>
<p>2) Run your report again.</p>
<p>3) Login on <a href="https://www.apexofficeprint.com">https://www.apexofficeprint.com</a> and go to Remote Debug</p>
<pre><code>![ ](media/aop_remote_debug.png)
</code></pre>
<p>4) Click on the magnifying glass, and the JSON that was generated behind the scenes which is send to the AOP server component will be shown.</p>
<p>5) Investigate the received JSON:</p>
<p>-) <strong>JSON is valid, and valid output</strong>: this is how it should be.</p>
<p>-) <strong>JSON is invalid</strong>: this is probably due to your version of APEX. If you are below APEX 5.1.2, you need a patch linked to apex_json.</p>
<p>-) <strong>JSON is valid, but invalid Office file (Word, Excel, Powerpoint)</strong>: this means that AOP couldn't merge your data with the template you provided. If the template and requested output is the same format (e.g. your template is in Word and you request a Word document); check your template again if all substitution strings are correct. If you believe everything is ok, click the button "Sent to Support" and contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a>.</p>
<p>-) <strong>JSON is valid, but invalid PDF (or other output format)</strong>: if the template and output format are different, a conversion is going on handled by LibreOffice or MS Office. Either the conversion goes wrong, or most likely the initial file before the conversion was already wrong. To debug further, set the output format to the same format as your template and run your report again. If the output is invalid, follow previous steps (see JSON is valid, but invalid Office file). If the output is ok, click the button "Sent to Support" and send an email to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a> as it means there's a bug in the conversion.</p>
<h1 id="14-local-debugging">14 Local Debugging</h1>
<p>If you receive an error and you need some help of us, do following steps:</p>
<ol>
<li>
<p>Go in your application to Shared Components &gt; Component Settings &gt; APEX Office Print (AOP) [Plug-in] and set Debug to Local.</p>
</li>
<li>
<p>Run your report again. A JSON file will now be downloaded instead of the report. This JSON is what is sent to the AOP server component behind the scenes.</p>
</li>
<li>
<p>Investigate the received JSON:</p>
<p>-) <strong>JSON is valid, and valid output</strong>: this is how it should be.</p>
<p>-) <strong>JSON is invalid</strong>: this is probably due to your version of APEX. If you are below APEX 5.1.2, you need a patch linked to apex_json.</p>
<p>-) <strong>JSON is valid, but invalid Office file (Word, Excel, Powerpoint)</strong>: this means that AOP couldn't merge your data with the template you provided. If the template and requested output is the same format (e.g. your template is in Word and you request a Word document); check your template again if all substitution strings are correct. If you believe everything is ok, contact <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a>.</p>
<p>-) <strong>JSON is valid, but invalid PDF (or other output format)</strong>: if the template and output format are different, a conversion is going on handled by LibreOffice or MS Office. Either the conversion goes wrong, or most likely the initial file before the conversion was already wrong. To debug further, set the output format to the same format as your template and run your report again. If the output is invalid, follow previous steps (see JSON is valid, but invalid Office file). If the output is ok, send an email to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;">&#115;&#117;&#112;&#112;&#111;&#114;&#116;&#64;&#97;&#112;&#101;&#120;&#111;&#102;&#102;&#105;&#99;&#101;&#112;&#114;&#105;&#110;&#116;&#46;&#99;&#111;&#109;</a> as it means there's a bug in the conversion.</p>
</li>
<li>
<p>If you didn't find a solution yourself, please send the JSON file to support@apexofficeprint.com</p>
</li>
</ol>
<h1 id="15-debugging-connections-to-aop-server">15 Debugging connections to AOP Server</h1>
<p>Open a first command prompt or shell and run AOP in verbose mode:</p>
<pre><code class="bash">./APEXOfficePrintLinux64 —-verbose
</code></pre>

<p>Copy the <a href="./media/test.json">test.json</a> file to your server where AOP is running in /tmp folder</p>
<p>In another command prompt or shell go to /tmp folder and run (If you are in windows environment you can download curl from <a href="https://curl.haxx.se/download.html#Win64">https://curl.haxx.se/download.html#Win64</a>):</p>
<pre><code class="bash">curl -X POST -H 'Content-Type: application/json' -d @test.json http://127.0.0.1:8010/ &gt; output.docx
</code></pre>

<p>This should show the below output and have created an output.docx file</p>
<pre><code class="bash">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  164k  100 68310  100   97k   335k   492k --:--:-- --:--:-- --:--:--  494k
</code></pre>

<p>Check the first shell, AOP should have printed:</p>
<pre><code>Prinjob received.
Sending back response.
Prinjob completed.
</code></pre>
<p>Try to run the same curl command but with your server name</p>
<pre><code class="bash">curl -X POST -H 'Content-Type: application/json' -d @test.json http://&lt;your server name&gt;:8010/ &gt; output.docx
</code></pre>

<p>Same as before for output.</p>
<p>Go to the database server copy the test.json in the /tmp folder and run the curl command again</p>
<pre><code class="bash">curl -X POST -H 'Content-Type: application/json' -d @test.json http://&lt;your server name&gt;:8010/ &gt; output.docx
</code></pre>

<p>This should do the same as before.</p>
<p>Instead of using curl you can also use a RESTClient like Postman. You will have to add the header 'Content-Type: application/json' and give the data from the test.json into the body section. </p>
<p>Go into APEX &gt; SQL Workshop, and try to connect to the AOP server</p>
<pre><code class="sql">select apex_web_service.make_rest_request('http://&lt;your server name&gt;:8010/', 'GET') from dual
</code></pre>

<p>Try to generate a first document, adjust the below script to your settings and run</p>
<pre><code class="sql">declare
  l_return          blob;
  l_output_filename varchar2(100) := 'output';

begin
  aop_api_pkg.g_proxy_override := null; -- set the proxy if you use that

  l_return := aop_api_pkg.plsql_call_to_aop (
                p_data_type       =&gt; 'SQL',
                p_data_source     =&gt; q'[
                  select
                    'file1' as &quot;filename&quot;,
                    cursor(
                      select 'hello world' as &quot;string&quot;
                        from dual
                    ) as &quot;data&quot;
                  from dual
                ]',
                p_template_type   =&gt; null,
                p_template_source =&gt; null,
                p_output_type     =&gt; 'docx',
                p_output_filename =&gt; l_output_filename,
                p_aop_url         =&gt; 'http://&lt;your server name&gt;:8010/', -- change to the AOP server
                p_api_key         =&gt; '',
                p_app_id          =&gt; 232); -- change to the AOP sample app number
  sys.htp.p(dbms_lob.getlength(l_return));
end;
</code></pre>

<p>In the shell where AOP is running you should see the incoming connection.</p>
<p>Hopefully the below steps give you more insight where your connection is failing so you can correct accordingly.</p>
<h1 id="16-faq">16 FAQ</h1>
<p>-) <strong>Does AOP have to go on its own server, the database server or the application (ORDS) server?</strong></p>
<p>You can choose. Having AOP on the same server as the database machine is most performant and easiest as you don’t have network connections to other servers. If you install AOP on it’s own server you can size and monitor that server better. AOP on the Application server is another option, as long as the database can connect to the AOP server component, the AOP server doesn't need to be accessible from the outside (clients).
So it’s whatever you are most comfortable with.</p>
<p>-) <strong>Is there anything special we have to do with AOP to get it to work with SSL?</strong></p>
<p>You can add a reverse proxy for the SSL or you can specify the https certificate when starting the AOP server itself.
Most people don’t do SSL as it’s only the database that needs to access the AOP server component, so typically you don’t even pass the network where others are. However AOP can start in SSL mode if the SSL certificate and its key are provided via --https_key and --https_cert argument.</p>
<p>-) <strong>Where do I get the SSL certificate of API server?</strong></p>
<p>If you are using HTTPS (we always recommend you to do this) for connecting with the API server, you might get a SSL certification validation error:</p>
<p><code>ORA-29273: HTTP request failed ORA-06512: at "SYS.UTL_HTTP", line 1130 ORA-29024: Certificate validation failure</code> 
In this case you will have to load the SSL certificate of the root certification authority, in our case that of GoDaddy, into your oracle wallet. You can get this certificate by visiting https://apexofficeprint.com/ and looking at the certificate infomation. Example firefox:
<img alt=" " src="./media/ssl_certificate_export.png" /></p>
<p>It could be that you will have to change the url to https://www.apexrnd.be/aop/</p>
<p>-) <strong>How resource intensive is it?  Does it eat up a lot of CPU, RAM, or hard drive space?</strong></p>
<p>It depends how many prints you do… AOP initially consumes about 400MB RAM, but depending the prints it can go up to 4GB (a limit we put). In case you have larger documents, we recommend downloading the high memory version which can consume up to 16GB.
CPU is not much compared to the specs these days and hard drive space is about 500MB.
The executable is about 500MB and we might create some temporary files (during pdf conversion) and a log and error file.</p>
<p>-) <strong>Do I have to install LibreOffice when we need Word and Excel output only?</strong></p>
<p>No - LibreOffice or MS Office is only used when you want to convert from one format to another.
So Word-Word or Excel-Excel is working without. But if you want to do for example Word-&gt;PDF you need LibreOffice or MS Office or another converter you prefer.</p>
<p>-) <strong>Can AOP print directly to a printer</strong></p>
<p>AOP 3.1 and above includes the ability to print directly to an IP Printer, as long as it's available from the server AOP is running on. If you want to print to a local printer, check the Sample app how to print to an inline region, by adding a little bit of JavaScript to the dynamic action you can let the browser come up with a print window automatically.</p>
<p>-) <strong>Can you repeat the Table header in Word and Excel?</strong></p>
<p>Yes, this is a setting in Office.
When you right click on your header row in Word, you can go to Table Properties - Row and check the "Repeat as header row at the top of every page". An example is given on page 113 of sample application.</p>
<p>-) <strong>Does AOP support Pivots in Excel</strong></p>
<p>Yes, you can use the transpose function in Excel to pivot your data. AOP can also loop vertically by using the {:tag}.</p>
<p>-) <strong>why is there a difference between an output in Word and PDF</strong></p>
<p>When going from Word to PDF, we use an external converter: MS Office or LibreOffice. It might be that if your template was build on your desktop in MS Office (Word), but your server is using LibreOffice (Linux) a font is different or there are minimal changes. The easiest way to find out what the difference is, is to open the template in LibreOffice on your Desktop and see why LibreOffice is treating it different. In most use cases it works just fine going from one to the other, but sometimes it's in the details.</p>
<p>-) <strong>Can I install the APEX Plug-in somewhere so all my apps have access ot it?</strong></p>
<p>You can make the aop_api_pkg a public synonym for aop_api18_pkg PL/SQL package in case you only want the package in a global schema. The Oracle APEX plug-in itself you would still need to import in every APEX application you want to use it in, but the plug-in can point to the public package.</p>
<p>-) <strong>Can I use dynamic page break in Word?</strong></p>
<p>Yes. In some cases you might want to start a new page for every record for example for certificates. You can put the page break inside a conditional expression. You can use the rownum function to generate the id for every record and check if that is equals to the record length. An example is shown in page 119 of our sample application. Given the data:</p>
<pre><code class="sql">select
  'file1' as &quot;filename&quot;,
  cursor(
    select
      cursor(
          select
          rownum as &quot;customerIndex&quot;,
          c.cust_first_name as &quot;cust_first_name&quot;,
          c.cust_last_name as &quot;cust_last_name&quot;
          from demo_customers c
      ) as &quot;customers&quot;
      from dual
) as &quot;data&quot;
from dual
</code></pre>

<p>You can use the following tag to insert page break for every record except for the last.</p>
<pre><code>{#customerIndex!=customers.length}
 -------------page break ------------
{/customerIndex!=customers.length}
</code></pre>

<p>Please note that if you wish to output to pdf, the same can be achieved by using the Powerpoint template and {!slides_loop} tag. In this case there is no need to use the rownum function.</p>
<p>-) <strong>Can I adjust the width and height of interactive report/grid export in Word?</strong></p>
<p>If you are exporting interacitve grid, you can adjust the columns width as you like (due to meta data issue you will also have to change the width a bit for all columns.). The ratio is then automatically taken into account. </p>
<p>In interactive report, you can use the following in html expression. </p>
<pre><code>&lt;span data-aop-width-weight=&quot;2&quot;&gt;&lt;/span&gt;#COLUMN_NAME#
</code></pre>

<p>The default weight for each column is 1. Lets say you have 4 columns and you provide this html expression in the first colum. This will double the size of the first column in comparision to the remaining 3.</p>
<p>The following formula is used to calculate the percentage of width a column gets: </p>
<pre><code>(weight of column)/(total weight provided for all the columns) * 100.
</code></pre>

<h1 id="17-example-templates">17 Example Templates</h1>
<p>Below we illustrate some example templates and the generated output.</p>
<h2 id="example-1">Example 1</h2>
<p>This is the input template:</p>
<p><img alt=" " src="./media/case1before.png" /></p>
<p>This is the result after AOP has processed the template and the given data:</p>
<p><img alt=" " src="./media/case1after.png" /></p>
<h2 id="example-2">Example 2</h2>
<p>This is the input template:</p>
<p><img alt=" " src="./media/case2before.png" /></p>
<p>This is the result after AOP has processed the template and the given data:</p>
<p><img alt=" " src="./media/case2after.png" /></p>
<h2 id="example-3">Example 3</h2>
<p>This is the input template:</p>
<p><img alt=" " src="./media/interactiveBefore.png" /></p>
<p>This is the result after AOP has processed the template and the given data:</p>
<p><img alt=" " src="./media/case3after.png" /></p>
<h2 id="example-4">Example 4</h2>
<p>This is the input template:</p>
<p><img alt=" " src="./media/LadingBefore.png" /></p>
<p>This is the result after AOP has processed the template and the given data:</p>
<p><img alt=" " src="./media/LadingAfter.png" /></p>
<h1 id="copyright">Copyright</h1>
<p>Copyright © 2015-2018, <a href="https://www.apexrnd.be">APEX R&amp;D</a></p>
<p>All rights reserved.</p>
<p>Authors: Dimitri Gielis, Sunil Tandan and Lino Schildenfeld</p>
<p>This software and related documentation are provided under a license agreement containing restrictions on use and disclosure that are protected by intellectual property laws. Except as expressly permitted in your license agreement or allowed by law, you may not use, copy, reproduce, translate, broadcast, modify, license, transmit, distribute, exhibit, perform, publish, or display any part, in any form, or by any means. Reverse engineering, disassembly, or de-compilation of this software, unless required by law for interoperability, is prohibited. The information contained herein is subject to change without notice and is not warranted to be error-free. If you find any errors, please report them to us in writing.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>APEX R&D - 2015-2018</p>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '.';</script>
        <script data-main="./mkdocs/js/search.js" src="./mkdocs/js/require.js"></script>
        <script src="./js/base.js"></script><div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 0.16.3
Build Date UTC : 2018-10-15 20:16:22
-->
